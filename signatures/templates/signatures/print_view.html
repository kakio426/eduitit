<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연수등록부 - {{ session.title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css');

        body {
            font-family: 'NanumSquareRound', 'Malgun Gothic', sans-serif;
            background-color: white;
            color: black;
            line-height: 1.4;
        }

        @media print {
            @page {
                size: A4;
                margin: 20mm 15mm;
            }

            body {
                padding: 0 !important;
                margin: 0 !important;
            }

            .no-print {
                display: none !important;
            }

            .print-container {
                width: 100% !important;
            }

            /* Page break for multi-page support */
            .page-break-before {
                page-break-before: always;
            }

            /* Ensure table borders are sharp in print */
            table {
                border-collapse: collapse !important;
                width: 100% !important;
            }

            th,
            td {
                border: 0.5pt solid black !important;
            }
        }

        .official-title {
            font-size: 32pt;
            font-weight: 800;
            text-align: center;
            letter-spacing: 0.5em;
            margin-bottom: 40px;
            text-decoration: underline;
            text-underline-offset: 10px;
        }

        .info-section {
            margin-bottom: 25px;
            font-size: 13pt;
        }

        .info-row {
            display: flex;
            margin-bottom: 8px;
        }

        .info-label {
            font-weight: bold;
            min-width: 140px;
        }

        .attendance-table {
            width: 100%;
            border: 1.5pt solid black;
            border-collapse: collapse;
        }

        .attendance-table th {
            background-color: #f3f4f6;
            font-weight: bold;
            height: 40px;
            border: 0.5pt solid black;
            font-size: 11pt;
        }

        .attendance-table td {
            height: 45px;
            border: 0.5pt solid black;
            text-align: center;
            font-size: 11pt;
        }

        .sig-img {
            max-height: 35px;
            max-width: 100px;
            margin: 0 auto;
        }
    </style>
</head>

<body class="p-10">
    <!-- Print Controls -->
    <div class="no-print fixed top-5 right-5 flex gap-3 z-50">
        <button onclick="window.print()"
            class="px-6 py-2 bg-slate-800 text-white font-bold rounded-full shadow-lg hover:bg-black transition flex items-center gap-2">
            <i class="fa-solid fa-print"></i> 인쇄하기
        </button>
        <a href="{% url 'signatures:detail' uuid=session.uuid %}"
            class="px-6 py-2 bg-white border border-gray-300 text-gray-700 font-bold rounded-full shadow-md hover:bg-gray-50 transition flex items-center gap-2">
            <i class="fa-solid fa-arrow-left"></i> 돌아가기
        </a>
    </div>

    {% for page in pages %}
    <div class="print-container max-w-[210mm] mx-auto bg-white {% if not forloop.first %}page-break-before{% endif %}">
        <!-- Title -->
        <h1 class="official-title">
            {% now "Y" %} 연수등록부{% if total_pages > 1 %} ({{ page.page_number }}/{{ total_pages }}){% endif %}
        </h1>

        <!-- Header Info Table Style -->
        <div class="info-section">
            <div class="info-row">
                <span class="info-label">가. 일시 및 장소 :</span>
                <span>{{ session.datetime|date:"Y년 n월 j일 H시 i분" }}, {{ session.location }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">나. 강&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;사 :</span>
                <span>{{ session.instructor }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">다. 내&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;용 :</span>
                <span class="font-bold">{{ session.title }}</span>
            </div>
        </div>

        <!-- Tables Container -->
        <div class="flex gap-0">
            <!-- Left Half -->
            <table class="attendance-table" style="width: 50%;">
                <thead>
                    <tr>
                        <th style="width: 12%;">순번</th>
                        <th style="width: 30%;">직위/학년반</th>
                        <th style="width: 28%;">성명</th>
                        <th style="width: 30%;">확인서명</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in page.left_items %}
                    <tr>
                        <td>{{ forloop.counter|add:page.left_start_index|add:-1 }}</td>
                        <td>{{ item.affiliation|default:"-" }}</td>
                        <td class="font-bold">{{ item.name }}</td>
                        <td>
                            {% if item.signature_data %}
                            <img src="{{ item.signature_data }}" class="sig-img" alt="서명">
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}

                    {% for i in page.left_padding %}
                    <tr>
                        <td>{{ i|add:page.left_start_index|add:page.left_items|length }}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- Right Half -->
            <table class="attendance-table" style="width: 50%; border-left: none;">
                <thead>
                    <tr>
                        <th style="width: 12%;">순번</th>
                        <th style="width: 30%;">직위/학년반</th>
                        <th style="width: 28%;">성명</th>
                        <th style="width: 30%;">확인서명</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in page.right_items %}
                    <tr>
                        <td>{{ forloop.counter|add:page.right_start_index|add:-1 }}</td>
                        <td>{{ item.affiliation|default:"-" }}</td>
                        <td class="font-bold">{{ item.name }}</td>
                        <td>
                            {% if item.signature_data %}
                            <img src="{{ item.signature_data }}" class="sig-img" alt="서명">
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}

                    {% for i in page.right_padding %}
                    <tr>
                        <td>{{ i|add:page.right_start_index|add:page.right_items|length }}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <div class="mt-4 flex justify-between text-sm text-gray-600">
            <span>
                참석인원 : 총 {{ total_count }}명
                {% if unsigned_count > 0 %}
                (서명 {{ signed_count }}명, 미서명 {{ unsigned_count }}명)
                {% endif %}
            </span>
            <span>출력일시 : {% now "Y. m. d. H:i" %}</span>
        </div>
    </div>
    {% endfor %}

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</body>

</html>