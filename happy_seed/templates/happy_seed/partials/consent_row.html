<tr class="border-t border-gray-100" id="consent-row-{{ student.id }}">
    <td class="px-4 py-3 text-sm text-gray-700">{{ student.number }}</td>
    <td class="px-4 py-3 font-bold text-gray-800">{{ student.name }}</td>
    <td class="px-4 py-3">
        {% if student.consent.status == 'approved' %}
        <span class="text-xs px-2 py-1 bg-green-100 text-green-700 rounded-full">동의완료</span>
        {% elif student.consent.status == 'pending' %}
        <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full">대기중</span>
        {% elif student.consent.status == 'rejected' %}
        <span class="text-xs px-2 py-1 bg-red-100 text-red-700 rounded-full">거부</span>
        {% elif student.consent.status == 'expired' %}
        <span class="text-xs px-2 py-1 bg-orange-100 text-orange-700 rounded-full">만료</span>
        {% elif student.consent.status == 'withdrawn' %}
        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-500 rounded-full">철회</span>
        {% else %}
        <span class="text-xs px-2 py-1 bg-gray-100 text-gray-500 rounded-full">{{ student.consent.get_status_display }}</span>
        {% endif %}
    </td>
    <td class="px-4 py-3 text-xs text-gray-500">
        {% if student.consent.requested_at %}
        {{ student.consent.requested_at|date:"Y-m-d H:i" }}
        {% else %}
        -
        {% endif %}
    </td>
    <td class="px-4 py-3 text-sm">
        {% if student.consent.external_url %}
        <a href="{{ student.consent.external_url }}" target="_blank" rel="noopener noreferrer" class="text-green-700 hover:underline">열기 (새 탭)</a>
        {% else %}
        <span class="text-gray-400">-</span>
        {% endif %}
    </td>
    <td class="px-4 py-3">
        <div class="flex gap-1">
            <form hx-post="{% url 'happy_seed:consent_update' student_id=student.id %}" hx-target="#consent-row-{{ student.id }}"
                hx-swap="outerHTML" hx-indicator="find .js-consent-approved-loading"
                hx-disabled-elt="find button[type='submit']"
                hx-on::response-error="alert('동의 상태 변경 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.')">
                {% csrf_token %}
                <input type="hidden" name="status" value="approved">
                <button type="submit" class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-bold hover:bg-green-200 inline-flex items-center gap-1" style="min-height: 44px;">
                    <span class="js-consent-approved-loading htmx-indicator">
                        <i class="fas fa-circle-notch fa-spin text-[10px]"></i>
                    </span>
                    <span>동의</span>
                </button>
            </form>
            <form hx-post="{% url 'happy_seed:consent_update' student_id=student.id %}" hx-target="#consent-row-{{ student.id }}"
                hx-swap="outerHTML" hx-indicator="find .js-consent-pending-loading"
                hx-disabled-elt="find button[type='submit']"
                hx-on::response-error="alert('동의 상태 변경 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.')">
                {% csrf_token %}
                <input type="hidden" name="status" value="pending">
                <button type="submit" class="px-2 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-bold hover:bg-yellow-200 inline-flex items-center gap-1" style="min-height: 44px;">
                    <span class="js-consent-pending-loading htmx-indicator">
                        <i class="fas fa-circle-notch fa-spin text-[10px]"></i>
                    </span>
                    <span>대기</span>
                </button>
            </form>
            <form method="post" action="{% url 'happy_seed:consent_resend' student_id=student.id %}">
                {% csrf_token %}
                <button type="submit" class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-bold hover:bg-blue-200" style="min-height: 44px;">재안내</button>
            </form>
            <form method="post" action="{% url 'happy_seed:consent_regenerate_link' student_id=student.id %}">
                {% csrf_token %}
                <button type="submit" class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-bold hover:bg-indigo-200" style="min-height: 44px;">링크재발급</button>
            </form>
            <form hx-post="{% url 'happy_seed:consent_update' student_id=student.id %}" hx-target="#consent-row-{{ student.id }}"
                hx-swap="outerHTML" hx-indicator="find .js-consent-withdrawn-loading"
                hx-disabled-elt="find button[type='submit']"
                hx-on::response-error="alert('동의 상태 변경 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.')">
                {% csrf_token %}
                <input type="hidden" name="status" value="withdrawn">
                <button type="submit" class="px-2 py-1 bg-red-100 text-red-700 rounded text-xs font-bold hover:bg-red-200 inline-flex items-center gap-1" style="min-height: 44px;">
                    <span class="js-consent-withdrawn-loading htmx-indicator">
                        <i class="fas fa-circle-notch fa-spin text-[10px]"></i>
                    </span>
                    <span>철회</span>
                </button>
            </form>
        </div>
    </td>
</tr>

