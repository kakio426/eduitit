<div class="clay-card p-4 rounded-xl text-center" x-data="{ showActions: false }">
    <!-- Consent badge -->
    {% if student.consent.status == 'approved' %}
    <div class="text-2xl mb-1">{% include 'happy_seed/partials/seed_badge.html' %}</div>
    {% else %}
    <div class="text-2xl mb-1">â³</div>
    <div class="text-[10px] text-yellow-600 mb-1">ëŒ€ê¸°ì¤‘</div>
    {% endif %}

    <div class="font-bold text-sm text-gray-800 truncate">{{ student.name }}</div>
    <div class="text-xs text-gray-400">{{ student.number }}ë²ˆ</div>

    {% if student.consent.status == 'approved' %}
    <div class="flex items-center justify-center gap-1 mt-2 text-xs">
        <span class="px-1.5 py-0.5 bg-green-100 text-green-700 rounded">ğŸŒ°{{ student.seed_count }}</span>
        <span class="px-1.5 py-0.5 bg-pink-100 text-pink-700 rounded">ğŸŒ¸{{ student.ticket_count }}</span>
    </div>

    <button @click="showActions = !showActions" class="mt-2 text-xs text-gray-400 hover:text-gray-600">
        <span x-text="showActions ? 'ì ‘ê¸°' : 'ê´€ë¦¬'"></span>
    </button>

    <div x-show="showActions" x-transition class="mt-2 space-y-1.5">
        <!-- Seed grant -->
        <form hx-post="{% url 'happy_seed:seed_grant' student_id=student.id %}" hx-target="#student-grid"
            hx-swap="innerHTML" hx-indicator="find .js-seed-grant-loading"
            hx-disabled-elt="find button[type='submit']"
            hx-on::response-error="alert('ì”¨ì•— ì§€ê¸‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.')"
            class="flex gap-1">
            {% csrf_token %}
            <input type="hidden" name="amount" value="1">
            <input type="hidden" name="detail" value="êµì‚¬ ë¶€ì—¬">
            <button type="submit" class="flex-1 py-1.5 bg-green-100 text-green-700 rounded-lg text-xs font-bold hover:bg-green-200 transition-colors inline-flex items-center justify-center gap-1" style="min-height: 44px;">
                <span class="js-seed-grant-loading htmx-indicator">
                    <i class="fas fa-circle-notch fa-spin text-[10px]"></i>
                </span>
                <span>ğŸŒ°+1</span>
            </button>
        </form>
        <!-- Bloom grant -->
        <form method="post" action="{% url 'happy_seed:bloom_grant' classroom_id=classroom.id %}" class="flex gap-1">
            {% csrf_token %}
            <input type="hidden" name="student_id" value="{{ student.id }}">
            <input type="hidden" name="source" value="participation">
            <input type="hidden" name="amount" value="1">
            <button type="submit" class="flex-1 py-1.5 bg-pink-100 text-pink-700 rounded-lg text-xs font-bold hover:bg-pink-200 transition-colors" style="min-height: 44px;">ğŸŒ¸+1</button>
        </form>
    </div>
    {% endif %}
</div>
