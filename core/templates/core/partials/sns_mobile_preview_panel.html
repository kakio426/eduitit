<div x-data="{ snsOpen: false }" class="{{ root_class|default:'block xl:hidden mt-4 px-1' }}"{% if data_aos %} data-aos="{{ data_aos }}"{% endif %}>
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2">
            <i class="ph-fill ph-chat-circle-text text-indigo-600 text-xl"></i>
            실시간 소통
        </h3>
        <button type="button" @click="snsOpen = true" x-show="!snsOpen" class="text-sm font-bold text-indigo-600 flex items-center gap-1 hover:text-indigo-800 transition-colors">
            더보기 <i class="fa-solid fa-chevron-down text-xs"></i>
        </button>
    </div>

    <div x-show="!snsOpen" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
    {% for post in posts|slice:":2" %}
    <div class="sns-preview-card p-4 mb-3">
        <div class="flex items-start gap-3">
            <div class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">{% if post.author.userprofile and post.author.userprofile.nickname %}{{ post.author.userprofile.nickname|truncatechars:1 }}{% else %}{{ post.author.username|truncatechars:1 }}{% endif %}</div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-1">
                    <span class="font-bold text-sm text-slate-800">{% if post.author.userprofile and post.author.userprofile.nickname %}{{ post.author.userprofile.nickname }}{% else %}{{ post.author.username }}{% endif %}</span>
                    {% if post.author.is_staff %}<i class="ph-fill ph-seal-check text-indigo-500 text-sm"></i>{% endif %}
                    <span class="text-xs text-slate-400">{{ post.created_at|timesince }} 전</span>
                </div>
                <p class="text-sm text-slate-600 line-clamp-2 leading-relaxed">{{ post.content }}</p>
                <div class="flex items-center gap-4 mt-2 text-xs text-slate-400">
                    <span class="flex items-center gap-1"><i class="ph ph-heart"></i> {{ post.likes_count_annotated|default:"0" }}</span>
                    <span class="flex items-center gap-1"><i class="ph ph-chat-circle"></i> {{ post.comments_count_annotated|default:"0" }}</span>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="sns-preview-card p-6 text-center">
        <p class="text-sm text-slate-400">아직 게시글이 없습니다. 첫 글을 남겨보세요!</p>
    </div>
    {% endfor %}
    </div>

    <div id="{{ section_id|default:'sns-full-section-v2' }}">
        <button @click="snsOpen = !snsOpen" class="w-full py-3 mt-2 rounded-2xl font-bold text-sm transition-all flex items-center justify-center gap-2" :class="snsOpen ? 'bg-indigo-100 text-indigo-700' : 'bg-white text-slate-500 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600'">
            <i class="ph-fill ph-chat-circle-text"></i>
            <span x-text="snsOpen ? '소통창 접기' : '소통창 열기'"></span>
            <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300" :class="snsOpen && 'rotate-180'"></i>
        </button>
        <div x-show="snsOpen" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 -translate-y-4" x-transition:enter-end="opacity-100 translate-y-0" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 translate-y-0" x-transition:leave-end="opacity-0 -translate-y-4" class="mt-4">
            {% include 'core/partials/sns_widget_mobile.html' with hide_header=True expand_all_mobile=True %}
        </div>
    </div>
</div>
