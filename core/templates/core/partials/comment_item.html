<div data-comment-root class="group flex gap-2 text-sm">
    <div
        class="w-7 h-7 shrink-0 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-500">
        {% if comment.author.userprofile.nickname %}{{ comment.author.userprofile.nickname|slice:":1" }}{% else %}{{comment.author.username|slice:":1" }}{% endif %}
    </div>
    <div class="flex-1">
        <div class="flex items-baseline gap-2">
            <span class="font-bold text-slate-700 text-xs">
                {% if comment.author.userprofile.nickname %}{{ comment.author.userprofile.nickname }}{% else %}{{comment.author.username }}{% endif %}
                {% if comment.author.is_staff %}
                <span class="text-xs text-indigo-500 ml-0.5" title="관리자"><i class="ph-fill ph-shield-check"></i></span>
                {% endif %}
            </span>
            {% if comment.is_hidden %}
            <span class="text-[10px] text-red-500 font-semibold">숨김됨</span>
            {% endif %}
            <span class="text-[10px] text-slate-400">
                {{ comment.created_at|timesince }} 전
                {% if comment.updated_at|date:"YmdHi" != comment.created_at|date:"YmdHi" %}
                <span class="text-slate-400/80">(수정됨)</span>
                {% endif %}
            </span>

            <!-- Actions (Edit/Delete) -->
            <div class="ml-auto opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity flex items-center gap-1">
                {% if user.is_authenticated and user != comment.author %}
                <button hx-post="{% url 'comment_report' comment.id %}" hx-target="closest [data-comment-root]"
                    hx-swap="outerHTML" hx-vals='{"reason":"other"}' title="신고하기"
                    hx-indicator="find .js-comment-report-loading" hx-disabled-elt="this"
                    hx-on::response-error="alert('댓글 신고 처리 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.')"
                    class="text-slate-400 hover:text-amber-600 p-1 md:p-0.5 inline-flex items-center gap-1">
                    <span class="js-comment-report-loading htmx-indicator">
                        <i class="ph ph-spinner-gap animate-spin text-xs"></i>
                    </span>
                    <i class="ph ph-flag"></i>
                </button>
                {% endif %}
                {% if user == comment.author %}
                <button hx-get="{% url 'comment_edit' comment.id %}" hx-target="closest [data-comment-root]"
                    hx-swap="outerHTML" class="text-slate-400 hover:text-indigo-500 p-1 md:p-0.5">
                    <i class="ph ph-pencil-simple"></i>
                </button>
                {% endif %}

                {% if user == comment.author or user.is_staff %}
                <button hx-delete="{% url 'comment_delete' comment.id %}" hx-target="closest [data-comment-root]"
                    hx-swap="outerHTML" hx-confirm="댓글을 삭제하시겠습니까?" class="text-slate-400 hover:text-red-500 p-1 md:p-0.5">
                    <i class="ph ph-trash"></i>
                </button>
                {% endif %}
            </div>
        </div>
        <p class="text-slate-600 leading-snug mt-0.5 text-xs whitespace-pre-wrap break-words">{{ comment.content }}</p>
    </div>
</div>
