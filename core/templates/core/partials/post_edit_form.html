<form data-post-root hx-post="{% url 'post_edit' post.id %}" hx-target="closest [data-post-root]"
    hx-encoding="multipart/form-data" hx-swap="outerHTML"
    hx-indicator="find .js-post-edit-loading" hx-disabled-elt="find button[type='submit']"
    hx-on::response-error="alert('게시글 수정 중 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.')"
    class="bg-white p-4 rounded-2xl border border-indigo-200 shadow-md transition-all">

    <div class="mb-3">
        <label class="block text-xs font-bold text-slate-500 mb-1">내용 수정</label>
        <textarea name="content" rows="4" required
            class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-sm focus:ring-2 focus:ring-indigo-100 outline-none resize-none">{{ post.content }}</textarea>
    </div>

    <!-- Image handling -->
    <div class="mb-3">
        <label class="block text-xs font-bold text-slate-500 mb-2">이미지 수정</label>
        
        <input type="hidden" name="remove_image" id="remove-image-input-{{ post.id }}" value="false">
        
        <div id="edit-image-preview-container-{{ post.id }}" class="{% if not post.image %}hidden{% endif %} mb-3 relative group">
            <img id="edit-image-preview-{{ post.id }}" src="{% if post.image %}{{ post.image.url }}{% endif %}" 
                 alt="게시물 이미지"
                 class="h-32 w-full object-cover rounded-xl border border-slate-100 shadow-sm">
            <button type="button" 
                onclick="document.getElementById('edit-post-image-input-{{ post.id }}').value=''; document.getElementById('edit-image-preview-container-{{ post.id }}').classList.add('hidden'); document.getElementById('remove-image-input-{{ post.id }}').value='true';"
                class="absolute top-2 right-2 bg-red-500/80 text-white w-7 h-7 rounded-full hover:bg-red-600 transition flex items-center justify-center backdrop-blur-sm opacity-0 group-hover:opacity-100">
                <i class="ph ph-x"></i>
            </button>
        </div>

        <input type="file" name="image" id="edit-post-image-input-{{ post.id }}" class="hidden" accept="image/*"
            onchange="const file = this.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => { const preview = document.getElementById('edit-image-preview-{{ post.id }}'); preview.src = e.target.result; document.getElementById('edit-image-preview-container-{{ post.id }}').classList.remove('hidden'); document.getElementById('remove-image-input-{{ post.id }}').value='false'; }; reader.readAsDataURL(file); }">
        
        <button type="button" onclick="document.getElementById('edit-post-image-input-{{ post.id }}').click()"
            class="w-full flex items-center justify-center gap-2 py-2.5 px-4 bg-slate-50 text-slate-600 rounded-xl border-2 border-dashed border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/30 hover:text-indigo-600 transition-all text-sm font-medium">
            <i class="ph ph-image text-lg"></i>
            <span>이미지 {% if post.image %}변경{% else %}추가{% endif %}하기</span>
        </button>
    </input>

    <div class="flex justify-end gap-2 pt-2 border-t border-slate-100">
        <button type="button" hx-get="{% url 'post_detail_partial' post.id %}" hx-target="closest form"
            hx-swap="outerHTML"
            class="px-3 py-1.5 text-sm text-slate-500 hover:bg-slate-50 rounded-lg transition-colors font-medium">
            취소
        </button>
        <button type="submit"
            class="px-4 py-1.5 text-sm bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-bold shadow-sm inline-flex items-center gap-2">
            <span class="js-post-edit-loading htmx-indicator">
                <i class="ph ph-spinner-gap animate-spin"></i>
            </span>
            <span>수정 완료</span>
        </button>
    </div>
</form>
