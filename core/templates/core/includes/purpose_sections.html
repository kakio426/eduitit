{# 목적별 4개 섹션 루프 - V2 홈 #}
{# 사용: {% include 'core/includes/purpose_sections.html' with sections=sections %} #}
<div x-data="{ openSection: null }" class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
{% for section in sections %}
    <div class="bg-white/70 backdrop-blur-sm rounded-3xl p-5 md:p-6 border border-slate-100 shadow-sm">
        <!-- 섹션 헤더 -->
        <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white text-lg {% if section.color == 'blue' %}bg-gradient-to-br from-blue-500 to-blue-600{% elif section.color == 'emerald' %}bg-gradient-to-br from-emerald-500 to-emerald-600{% elif section.color == 'violet' %}bg-gradient-to-br from-violet-500 to-violet-600{% elif section.color == 'cyan' %}bg-gradient-to-br from-cyan-500 to-cyan-600{% endif %} shadow-sm">
                <i class="{{ section.icon }}"></i>
            </div>
            <div>
                <h3 class="font-bold text-base text-slate-800">{{ section.title }}</h3>
                <p class="text-xs text-slate-400">{{ section.subtitle }}</p>
            </div>
        </div>

        <!-- 데스크톱: 전체 서비스 노출 -->
        <div class="hidden md:block space-y-2">
            {% for product in section.products %}
            {% include 'core/includes/mini_card.html' with product=product %}
            {% endfor %}
            {% for product in section.overflow_products %}
            {% include 'core/includes/mini_card.html' with product=product %}
            {% endfor %}
        </div>

        <!-- 모바일: 미리보기 + 더보기 아코디언 -->
        <div class="md:hidden space-y-2">
            {% for product in section.products %}
            {% include 'core/includes/mini_card.html' with product=product %}
            {% endfor %}
        </div>

        {% if section.has_more %}
        <div class="mt-3 md:hidden">
            <button
                type="button"
                @click="openSection = openSection === '{{ section.key }}' ? null : '{{ section.key }}'"
                class="w-full px-3.5 py-2.5 rounded-xl border border-slate-200 bg-white text-slate-600 font-bold text-xs flex items-center justify-between hover:border-indigo-300 hover:text-indigo-600 transition-all"
                :aria-expanded="openSection === '{{ section.key }}'"
                data-track="section_more_toggle"
                data-track-label="{{ section.key }}"
            >
                <span x-text="openSection === '{{ section.key }}' ? '접기' : '더보기 {{ section.remaining_count }}개'"></span>
                <i class="fa-solid fa-chevron-down text-[10px] transition-transform duration-300" :class="openSection === '{{ section.key }}' ? 'rotate-180' : ''"></i>
            </button>

            <div
                x-show="openSection === '{{ section.key }}'"
                x-transition:enter="transition ease-out duration-250"
                x-transition:enter-start="opacity-0 -translate-y-2"
                x-transition:enter-end="opacity-100 translate-y-0"
                x-transition:leave="transition ease-in duration-180"
                x-transition:leave-start="opacity-100 translate-y-0"
                x-transition:leave-end="opacity-0 -translate-y-2"
                class="mt-2 space-y-2"
            >
                {% for product in section.overflow_products %}
                {% include 'core/includes/mini_card.html' with product=product %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
{% endfor %}
</div>
