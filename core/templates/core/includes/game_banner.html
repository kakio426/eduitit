{# ì‰¬ëŠ” ì‹œê°„ ê²Œì„ ë°°ë„ˆ - V2 í™ˆ #}
{# ì‚¬ìš©: {% include 'core/includes/game_banner.html' with games=games %} #}
{% if games %}
<div class="bg-gradient-to-r from-rose-50 to-orange-50 rounded-3xl p-5 md:p-6 border border-rose-100">
    <div class="flex items-center justify-between gap-3 mb-4">
        <div class="flex items-center gap-2">
            <span class="text-2xl">ğŸ®</span>
            <h3 class="font-bold text-base text-slate-800">ì‰¬ëŠ” ì‹œê°„</h3>
            <span class="text-xs text-slate-400">ì ê¹ ì‰¬ì–´ê°€ìš”</span>
        </div>
        {% if request.user.is_authenticated and student_games_launch_url and student_games_qr_data_url %}
        <button type="button"
            onclick="openHomeStudentGamesQrModal()"
            class="inline-flex items-center gap-2 px-3 py-2 text-xs font-bold rounded-xl border border-indigo-200 bg-white text-indigo-700 hover:bg-indigo-50 transition"
            title="í•™ìƒ ê²Œì„ QR ì—´ê¸°">
            <i class="fa-solid fa-qrcode"></i>
            í•™ìƒìš© QR
        </button>
        {% endif %}
    </div>
    <div class="flex gap-3 overflow-x-auto pb-1" style="-ms-overflow-style:none;scrollbar-width:none;">
        {% for game in games %}
        <a href="{% if game.external_url %}{{ game.external_url }}{% else %}#{% endif %}"
            class="flex-shrink-0 flex items-center gap-2.5 bg-white rounded-xl px-4 py-3 shadow-sm border border-slate-100 hover:shadow-md hover:border-rose-200 transition-all group"
            data-track="game_banner" data-track-label="{{ game.title }}"
            onclick="{% if not game.external_url %}event.preventDefault(); if(window.openModal) openModal({{ game.id }});{% endif %}">
            <span class="text-xl">{% if "fa-" in game.icon %}<i class="{{ game.icon }} text-red-400"></i>{% else %}{{ game.icon }}{% endif %}</span>
            <span class="font-bold text-sm text-slate-700 group-hover:text-rose-600 transition-colors">{{ game.title }}</span>
        </a>
        {% endfor %}
    </div>
</div>
{% if request.user.is_authenticated and student_games_launch_url and student_games_qr_data_url %}
<div id="homeStudentGamesQrModal"
    class="fixed inset-0 z-[220] hidden items-center justify-center bg-black/75 backdrop-blur-sm transition-opacity duration-200 opacity-0">
    <div
        class="bg-white rounded-3xl shadow-2xl w-[min(92vw,28rem)] border border-slate-200 p-6 transform scale-95 transition-transform">
        <div class="flex items-start justify-between mb-4">
            <div>
                <h3 class="text-xl font-black text-slate-800">í•™ìƒ ê²Œì„ ì…ì¥ QR</h3>
                <p class="text-xs text-slate-500 mt-1">ìœ íš¨ì‹œê°„: {{ student_games_expires_hours }}ì‹œê°„</p>
            </div>
            <button type="button" onclick="closeHomeStudentGamesQrModal()"
                class="w-9 h-9 inline-flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-100 hover:text-slate-700 transition">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>

        <div class="bg-white rounded-2xl border border-slate-200 p-3 flex justify-center mb-4">
            <img src="{{ student_games_qr_data_url }}" alt="í•™ìƒ ê²Œì„ ì…ì¥ QR ì½”ë“œ" class="w-56 h-56 max-w-full">
        </div>

        <label for="homeStudentGamesLaunchUrl" class="block text-xs font-bold text-slate-500 mb-1">í•™ìƒìš© ë§í¬</label>
        <input id="homeStudentGamesLaunchUrl" type="text" readonly value="{{ student_games_launch_url }}"
            class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 text-slate-700 text-sm mb-4">

        <div class="grid grid-cols-2 gap-2">
            <button type="button" onclick="copyHomeStudentGamesLink()"
                class="py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-bold text-sm transition">
                ë§í¬ ë³µì‚¬
            </button>
            <a href="{{ student_games_launch_url }}" target="_blank" rel="noopener noreferrer"
                class="py-2.5 rounded-xl bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold text-sm text-center transition">
                ìƒˆ ì°½ ë¯¸ë¦¬ë³´ê¸°
            </a>
        </div>
    </div>
</div>
<script>
    function openHomeStudentGamesQrModal() {
        const modal = document.getElementById('homeStudentGamesQrModal');
        if (!modal) return;
        modal.classList.remove('hidden');
        requestAnimationFrame(() => {
            modal.classList.remove('opacity-0');
            const panel = modal.firstElementChild;
            if (panel) panel.classList.remove('scale-95');
        });
    }

    function closeHomeStudentGamesQrModal() {
        const modal = document.getElementById('homeStudentGamesQrModal');
        if (!modal) return;
        modal.classList.add('opacity-0');
        const panel = modal.firstElementChild;
        if (panel) panel.classList.add('scale-95');
        setTimeout(() => modal.classList.add('hidden'), 180);
    }

    async function copyHomeStudentGamesLink() {
        const input = document.getElementById('homeStudentGamesLaunchUrl');
        if (!input) return;
        try {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                await navigator.clipboard.writeText(input.value);
            } else {
                input.select();
                document.execCommand('copy');
                window.getSelection().removeAllRanges();
            }
            alert('í•™ìƒìš© ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.');
        } catch (error) {
            alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì§ì ‘ ì„ íƒí•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');
        }
    }
</script>
{% endif %}
{% endif %}
