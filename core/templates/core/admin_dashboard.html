{% extends "base.html" %}

{% block title %}관리자 대시보드 - Eduitit{% endblock %}

{% block content %}
<div class="pt-32 pb-20 px-6 max-w-7xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-800 mb-2">
        <i class="fa-solid fa-chart-line text-purple-500 mr-2"></i>관리자 대시보드
    </h1>
    <p class="text-gray-500 font-medium mb-8">방문자 통계 및 사이트 현황</p>

    <!-- Summary Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
        <div class="clay-card p-5 text-center">
            <div class="text-3xl font-bold text-orange-500">{{ today_human_count }} <span
                    class="text-xs text-gray-400">({{ today_bot_count }})</span></div>
            <div class="text-sm font-bold text-gray-500 mt-1">오늘 방문자</div>
        </div>
        <div class="clay-card p-5 text-center">
            <div class="text-3xl font-bold text-blue-500">{{ week_human_count }} <span class="text-xs text-gray-400">봇
                    포함: {{ week_count }}</span></div>
            <div class="text-sm font-bold text-gray-500 mt-1">이번 주 (사람)</div>
        </div>
        <div class="clay-card p-5 text-center">
            <div class="text-3xl font-bold text-green-500">{{ month_human_count }} <span class="text-xs text-gray-400">봇
                    포함: {{ month_count }}</span></div>
            <div class="text-sm font-bold text-gray-500 mt-1">이번 달 (사람)</div>
        </div>
        <div class="clay-card p-5 text-center">
            <div class="text-3xl font-bold text-purple-600">{{ human_total_count }} <span
                    class="text-xs text-gray-400">({{ bot_total_count }})</span></div>
            <div class="text-sm font-bold text-gray-500 mt-1">전체 누적 (봇)</div>
        </div>
    </div>

    <!-- Daily Chart (last 30 days) -->
    <div class="clay-card p-6 mb-10">
        <h2 class="text-xl font-bold text-gray-700 mb-4">
            <i class="fa-solid fa-calendar-days text-purple-400 mr-2"></i>일별 방문자 (최근 30일)
        </h2>
        <div class="flex items-end gap-1 overflow-x-auto pb-4" style="min-height: 200px;">
            {% for stat in daily_stats %}
            <div class="flex flex-col items-center flex-shrink-0" style="width: 28px;">
                <div class="text-[10px] font-bold text-gray-400 mb-1">{{ stat.count }}</div>
                <div class="w-5 rounded-t-lg transition-all duration-300"
                    style="height: {% widthratio stat.count max_daily 160 %}px; min-height: 4px; background: linear-gradient(to top, #7c3aed, #a78bfa);">
                </div>
                {% if forloop.counter|divisibleby:5 or forloop.last %}
                <div class="text-[9px] text-gray-400 mt-1 whitespace-nowrap">{{ stat.date|date:"m/d" }}</div>
                {% else %}
                <div class="text-[9px] text-transparent mt-1">&nbsp;</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Weekly Stats Table -->
    <div class="clay-card p-6">
        <h2 class="text-xl font-bold text-gray-700 mb-4">
            <i class="fa-solid fa-chart-bar text-blue-400 mr-2"></i>주간 방문자 (최근 8주)
        </h2>
        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-gray-500 font-bold border-b border-gray-200">
                        <th class="py-3 px-4">주차 시작일</th>
                        <th class="py-3 px-4">방문자 수</th>
                        <th class="py-3 px-4">바 차트</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in weekly_stats %}
                    <tr class="border-b border-gray-100 hover:bg-white/50 transition">
                        <td class="py-3 px-4 font-medium text-gray-700">{{ stat.week|date:"Y-m-d" }}</td>
                        <td class="py-3 px-4 font-bold text-purple-600">{{ stat.count }}</td>
                        <td class="py-3 px-4">
                            <div class="h-4 rounded-full"
                                style="width: {% widthratio stat.count total_count 200 %}px; min-width: 8px; background: linear-gradient(to right, #3b82f6, #7c3aed);">
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3" class="py-6 text-center text-gray-400">데이터가 없습니다.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}