{% extends 'base.html' %}

{% block title %}Eduitit - 선생님의 스마트한 하루{% endblock %}

{% block extra_css %}
<style>
    /* Custom Scrollbar for Feed */
    .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

    .custom-scrollbar {
        scrollbar-width: thin;
        scrollbar-color: #cbd5e1 transparent;
    }

    /* 카테고리 탭 공통 */
    .category-tab {
        white-space: nowrap;
        padding: 0.5rem 1.25rem;
        border-radius: 9999px;
        font-size: 0.875rem;
        font-weight: 700;
        transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid transparent;
        cursor: pointer;
        flex-shrink: 0;
    }

    .category-tab:not(.active) {
        background: white;
        color: #64748b;
        border-color: #e2e8f0;
    }

    /* 카테고리별 고유 색상 */
    .cat-all.active {
        background: linear-gradient(135deg, #1e293b, #334155);
        color: #fff;
        box-shadow: 0 4px 14px rgba(30, 41, 59, 0.3);
    }

    .cat-all:not(.active):hover {
        border-color: #94a3b8;
        color: #334155;
        background: #f8fafc;
    }

    .cat-classroom.active {
        background: linear-gradient(135deg, #2563eb, #3b82f6);
        color: #fff;
        box-shadow: 0 4px 14px rgba(37, 99, 235, 0.35);
    }

    .cat-classroom:not(.active):hover {
        border-color: #93c5fd;
        color: #2563eb;
        background: #eff6ff;
    }

    .cat-work.active {
        background: linear-gradient(135deg, #059669, #10b981);
        color: #fff;
        box-shadow: 0 4px 14px rgba(5, 150, 105, 0.35);
    }

    .cat-work:not(.active):hover {
        border-color: #6ee7b7;
        color: #059669;
        background: #ecfdf5;
    }

    .cat-game.active {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        color: #fff;
        box-shadow: 0 4px 14px rgba(220, 38, 38, 0.35);
    }

    .cat-game:not(.active):hover {
        border-color: #fca5a5;
        color: #dc2626;
        background: #fef2f2;
    }

    .cat-counsel.active {
        background: linear-gradient(135deg, #7c3aed, #a78bfa);
        color: #fff;
        box-shadow: 0 4px 14px rgba(124, 58, 237, 0.35);
    }

    .cat-counsel:not(.active):hover {
        border-color: #c4b5fd;
        color: #7c3aed;
        background: #f5f3ff;
    }

    .cat-edutech.active {
        background: linear-gradient(135deg, #0891b2, #06b6d4);
        color: #fff;
        box-shadow: 0 4px 14px rgba(8, 145, 178, 0.35);
    }

    .cat-edutech:not(.active):hover {
        border-color: #67e8f9;
        color: #0891b2;
        background: #ecfeff;
    }

    .cat-etc.active {
        background: linear-gradient(135deg, #6b7280, #9ca3af);
        color: #fff;
        box-shadow: 0 4px 14px rgba(107, 114, 128, 0.3);
    }

    .cat-etc:not(.active):hover {
        border-color: #d1d5db;
        color: #6b7280;
        background: #f9fafb;
    }

    /* SNS 미리보기 카드 */
    .sns-preview-card {
        background: white;
        border-radius: 1.5rem;
        border: 1px solid #e2e8f0;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
    }

    .sns-preview-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    /* 카테고리 탭 스크롤 영역 */
    .category-scroll {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .category-scroll::-webkit-scrollbar {
        display: none;
    }
</style>
{% endblock %}

{% block extra_js %}
<!-- HTMX -->
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<script>
    document.body.addEventListener('htmx:configRequest', (event) => {
        event.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    });
</script>
<!-- Phosphor Icons -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Product Cards Modal Logic
        document.querySelectorAll('.product-card').forEach(card => {
            card.addEventListener('click', function (e) {
                const id = this.getAttribute('data-product-id');
                if (window.openModal) {
                    window.openModal(id);
                }
            });

            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    card.click();
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<!-- URL Definitions -->
{% url 'yut_game' as yut_url %}
{% url 'prompt_lab' as prompt_lab_url %}
{% url 'tool_guide' as tool_guide_url %}

<div x-data="{ activeCategory: 'all' }" class="min-h-screen bg-[#E0E5EC]">

    <!-- PC: Flex Row / Mobile: Column -->
    <div class="flex flex-col md:flex-row pt-40 md:pt-48 max-w-[1920px] mx-auto">

        <!-- ========== PC 전용 SNS 사이드바 (md 이상) ========== -->
        <div class="hidden md:block flex-shrink-0">
            {% include 'core/partials/sns_widget.html' %}
        </div>

        <!-- ========== 메인 콘텐츠 ========== -->
        <main class="flex-1 pb-8 md:pb-12 px-3 md:px-8 pt-0">

            <!-- Hero Section -->
            <div class="flex flex-col justify-center text-center mb-5 md:mb-12" data-aos="fade-up">
                <h1
                    class="text-2xl md:text-5xl lg:text-6xl font-extrabold text-gray-800 tracking-tight leading-tight mb-2 md:mb-4">
                    선생님의 <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-blue-600">스마트한
                        하루</span>
                </h1>
                <p
                    class="text-sm md:text-lg lg:text-xl text-gray-500 max-w-3xl mx-auto leading-relaxed break-keep font-bold px-4">
                    AI로 더 똑똑하게, 더 즐겁게<span class="hidden md:inline">. 수업 준비부터 행정 업무까지</span>
                </p>
            </div>

            <!-- 카테고리 탭 -->
            <div class="mb-5 md:mb-8" data-aos="fade-up" data-aos-delay="50">
                <div class="flex gap-2 overflow-x-auto category-scroll pb-2 px-1">
                    <button class="category-tab cat-all" :class="activeCategory === 'all' ? 'active' : ''"
                        @click="activeCategory = 'all'">
                        <i class="fa-solid fa-border-all mr-1.5"></i>전체
                    </button>
                    <button class="category-tab cat-classroom" :class="activeCategory === 'classroom' ? 'active' : ''"
                        @click="activeCategory = 'classroom'">
                        <i class="fa-solid fa-chalkboard-user mr-1.5"></i>운영과 수업
                    </button>
                    <button class="category-tab cat-work" :class="activeCategory === 'work' ? 'active' : ''"
                        @click="activeCategory = 'work'">
                        <i class="fa-solid fa-bolt mr-1.5"></i>업무경감
                    </button>
                    <button class="category-tab cat-game" :class="activeCategory === 'game' ? 'active' : ''"
                        @click="activeCategory = 'game'">
                        <i class="fa-solid fa-gamepad mr-1.5"></i>게임모음
                    </button>
                    <button class="category-tab cat-counsel" :class="activeCategory === 'counsel' ? 'active' : ''"
                        @click="activeCategory = 'counsel'">
                        <i class="fa-solid fa-hand-holding-heart mr-1.5"></i>상담·운세
                    </button>
                    <button class="category-tab cat-edutech" :class="activeCategory === 'edutech' ? 'active' : ''"
                        @click="activeCategory = 'edutech'">
                        <i class="fa-solid fa-microchip mr-1.5"></i>에듀테크
                    </button>
                    <button class="category-tab cat-etc" :class="activeCategory === 'etc' ? 'active' : ''"
                        @click="activeCategory = 'etc'">
                        <i class="fa-solid fa-ellipsis mr-1.5"></i>기타
                    </button>
                </div>
            </div>

            <!-- BENTO GRID -->
            <div class="bento-grid">
                <!-- 1. Featured Hero Card -->
                {% if featured_product %}
                <div x-show="activeCategory === 'all' || activeCategory === '{{ featured_product.service_type }}'"
                    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                    x-transition:enter-end="opacity-100 scale-100"
                    class="{% if featured_product.card_size == 'hero' and featured_product.description|length > 100 %}col-span-2 md:col-span-2 md:row-span-2{% elif featured_product.card_size == 'wide' %}col-span-2 md:col-span-2{% elif featured_product.card_size == 'tall' %}md:row-span-2{% endif %}">
                    {% include 'core/includes/card_product.html' with product=featured_product delay='100' is_filtered=True %}
                </div>
                {% endif %}

                <!-- 2. Dynamic Product Cards -->
                {% for product in products %}
                {% if not featured_product or product.id != featured_product.id %}
                <div x-show="activeCategory === 'all' || activeCategory === '{{ product.service_type }}'"
                    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 scale-95"
                    x-transition:enter-end="opacity-100 scale-100"
                    class="{% if product.card_size == 'hero' and product.description|length > 100 %}col-span-2 md:col-span-2 md:row-span-2{% elif product.card_size == 'wide' %}col-span-2 md:col-span-2{% elif product.card_size == 'tall' %}md:row-span-2{% endif %}">
                    {% include 'core/includes/card_product.html' with product=product delay='200' is_filtered=True %}
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- ========== 모바일 전용 SNS 미리보기 (md 미만) ========== -->
            <div class="block md:hidden mt-8 px-1" data-aos="fade-up">
                <!-- 헤더 -->
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-bold text-slate-700 flex items-center gap-2">
                        <i class="ph-fill ph-chat-circle-text text-indigo-600 text-xl"></i>
                        실시간 소통
                    </h3>
                    <a href="#sns-full-section"
                        class="text-sm font-bold text-indigo-600 flex items-center gap-1 hover:text-indigo-800 transition-colors">
                        더보기 <i class="fa-solid fa-chevron-down text-xs"></i>
                    </a>
                </div>

                <!-- 최신 글 미리보기 (최대 2개) -->
                {% for post in posts|slice:":2" %}
                <div class="sns-preview-card p-4 mb-3">
                    <div class="flex items-start gap-3">
                        <!-- 아바타 -->
                        <div
                            class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                            {% if post.author.userprofile and post.author.userprofile.nickname %}
                            {{ post.author.userprofile.nickname|truncatechars:1 }}
                            {% else %}
                            {{ post.author.username|truncatechars:1 }}
                            {% endif %}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="font-bold text-sm text-slate-800">
                                    {% if post.author.userprofile and post.author.userprofile.nickname %}
                                    {{ post.author.userprofile.nickname }}
                                    {% else %}
                                    {{ post.author.username }}
                                    {% endif %}
                                </span>
                                {% if post.author.is_staff %}
                                <i class="ph-fill ph-seal-check text-indigo-500 text-sm"></i>
                                {% endif %}
                                <span class="text-xs text-slate-400">{{ post.created_at|timesince }} 전</span>
                            </div>
                            <p class="text-sm text-slate-600 line-clamp-2 leading-relaxed">{{ post.content }}</p>
                            <div class="flex items-center gap-4 mt-2 text-xs text-slate-400">
                                <span class="flex items-center gap-1">
                                    <i class="ph ph-heart"></i> {{ post.likes_count_annotated|default:"0" }}
                                </span>
                                <span class="flex items-center gap-1">
                                    <i class="ph ph-chat-circle"></i> {{ post.comments_count_annotated|default:"0" }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="sns-preview-card p-6 text-center">
                    <p class="text-sm text-slate-400">아직 게시글이 없습니다. 첫 글을 남겨보세요!</p>
                </div>
                {% endfor %}

                <!-- 전체 SNS 펼치기 (아코디언) -->
                <div x-data="{ snsOpen: false }" id="sns-full-section">
                    <button @click="snsOpen = !snsOpen"
                        class="w-full py-3 mt-2 rounded-2xl font-bold text-sm transition-all flex items-center justify-center gap-2"
                        :class="snsOpen ? 'bg-indigo-100 text-indigo-700' : 'bg-white text-slate-500 border border-slate-200 hover:border-indigo-300 hover:text-indigo-600'">
                        <i class="ph-fill ph-chat-circle-text"></i>
                        <span x-text="snsOpen ? '소통창 접기' : '소통창 열기'"></span>
                        <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300"
                            :class="snsOpen && 'rotate-180'"></i>
                    </button>

                    <div x-show="snsOpen" x-transition:enter="transition ease-out duration-300"
                        x-transition:enter-start="opacity-0 -translate-y-4"
                        x-transition:enter-end="opacity-100 translate-y-0"
                        x-transition:leave="transition ease-in duration-200"
                        x-transition:leave-start="opacity-100 translate-y-0"
                        x-transition:leave-end="opacity-0 -translate-y-4" class="mt-4">
                        {% include 'core/partials/sns_widget_mobile.html' %}
                    </div>
                </div>
            </div>

        </main>

    </div>
</div>

<script>
    // Product Cards Logic
    document.querySelectorAll('.product-card').forEach(card => {
        card.addEventListener('click', () => {
            const id = card.getAttribute('data-product-id');
            if (window.openModal) window.openModal(id);
        });

        card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                card.click();
            }
        });
    });
</script>
{% endblock %}