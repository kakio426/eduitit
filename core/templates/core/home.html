{% extends 'base.html' %}

{% block title %}Eduitit - 선생님의 스마트한 하루{% endblock %}

{% block content %}
<!-- URL Definitions -->
{% url 'yut_game' as yut_url %}
{% url 'prompt_lab' as prompt_lab_url %}
{% url 'tool_guide' as tool_guide_url %}

<!-- Main Content -->
<main class="pt-32 pb-20 px-4 md:px-8 min-h-screen max-w-7xl mx-auto">

    <!-- Header -->
    <div class="mb-16 text-center" data-aos="fade-down" data-aos-duration="1000">
        <div class="inline-flex items-center gap-2 px-6 py-2 rounded-full bg-[#E0E5EC] shadow-clay-inner mb-6">
            <span class="w-3 h-3 rounded-full bg-green-400 animate-pulse"></span>
            <span class="text-gray-500 font-bold text-2xl pt-1">v2.0 Updated</span>
        </div>
        <h1 class="text-7xl md:text-9xl font-bold text-gray-700 mb-2 tracking-tight leading-none text-shadow">
            선생님의 <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-blue-500">디지털 비서</span>
        </h1>
        <p class="text-3xl md:text-4xl text-gray-400 font-hand max-w-3xl mx-auto mt-4 leading-relaxed">
            설치 없이, 로그인 없이. 수업 준비부터 행정 업무까지<br>
            가장 스마트한 도구들을 만나보세요.
        </p>
    </div>

    <!-- BENTO GRID -->
    <div class="bento-grid">

        <!-- 1. [Hero Card] Dynamic Featured Product -->
        <div class="col-span-4 md:col-span-2 row-span-2 clay-card p-10 relative overflow-hidden group cursor-pointer bg-[#E0E5EC]"
            data-url="{% if featured_product.external_url %}{{ featured_product.external_url }}{% else %}{% url 'product_detail' featured_product.id %}{% endif %}"
            onclick="location.href=this.dataset.url" data-aos="fade-up" data-aos-delay="100">

            <!-- Quick View Button (Stop Propagation) -->
            <button onclick="event.stopPropagation(); openQuickView('{{ featured_product.id }}')"
                class="absolute top-6 right-6 z-20 w-12 h-12 rounded-full bg-white/50 backdrop-blur-sm text-gray-500 hover:text-purple-600 hover:bg-white shadow-sm flex items-center justify-center transition-all hover:scale-110"
                title="미리보기">
                <i class="fa-solid fa-magnifying-glass-plus text-xl"></i>
            </button>

            <!-- Background decoration -->
            <div
                class="absolute top-0 right-0 w-80 h-80 bg-purple-100 rounded-bl-full -mr-20 -mt-20 transition-transform duration-500 group-hover:scale-125 z-0">
            </div>

            <div class="relative z-10 h-full flex flex-col justify-between">
                <div>
                    <span
                        class="px-4 py-1 bg-purple-200 text-purple-700 rounded-full text-xl font-bold shadow-sm mb-6 inline-block">BEST
                        Popular</span>
                    <h2 class="text-6xl font-bold text-gray-700 mb-2 group-hover:text-purple-600 transition-colors">
                        {{ featured_product.title }}
                    </h2>
                    <p class="text-3xl text-gray-500 font-hand leading-tight">
                        {{ featured_product.description|truncatechars:80 }}
                    </p>
                </div>

                <div class="flex justify-between items-end mt-8">
                    <div class="text-8xl float-icon">
                        {% if "fa-" in featured_product.icon %}
                        <i class="{{ featured_product.icon }}"></i>
                        {% else %}
                        {{ featured_product.icon }}
                        {% endif %}
                    </div>
                    <div
                        class="w-16 h-16 rounded-full bg-purple-500 text-white shadow-lg flex items-center justify-center text-3xl group-hover:rotate-45 transition-transform duration-300">
                        <i class="fa-solid fa-arrow-right"></i>
                    </div>
                </div>
            </div>
        </div>


        <!-- 2. [Dynamic Product Cards] All Active Products -->
        {% for product in products %}
        {% if product.id != featured_product.id %}

        <div class="relative group-container">
            <!-- Added wrapper for positioning context if needed, but card works too -->

            {% if product.card_size == "wide" %}
            <!-- Wide Card (2 columns) -->
            <div class="col-span-4 md:col-span-2 clay-card p-10 relative overflow-hidden group cursor-pointer bg-[#E0E5EC]"
                data-url="{% if product.external_url %}{{ product.external_url }}{% else %}{% url 'product_detail' product.id %}{% endif %}"
                onclick="location.href=this.dataset.url" data-aos="fade-up"
                data-aos-delay="{% widthratio forloop.counter 1 100 %}">

                <!-- Quick View Button -->
                <button onclick="event.stopPropagation(); openQuickView('{{ product.id }}')"
                    class="absolute top-6 right-6 z-20 w-10 h-10 rounded-full bg-white/50 backdrop-blur-sm text-gray-500 hover:text-purple-600 hover:bg-white shadow-sm flex items-center justify-center transition-all hover:scale-110 opacity-0 group-hover:opacity-100"
                    title="미리보기">
                    <i class="fa-solid fa-magnifying-glass-plus"></i>
                </button>

                <div class="flex items-center justify-between h-full relative z-10">
                    <div>
                        <div class="flex items-center gap-3 mb-2">
                            {% if "fa-" in product.icon %}
                            <i class="{{ product.icon }} text-purple-500 text-3xl"></i>
                            {% else %}
                            <span class="text-3xl">{{ product.icon }}</span>
                            {% endif %}
                            <h3 class="text-4xl font-bold text-gray-700 mt-1">{{ product.title }}</h3>
                        </div>
                        <p class="text-2xl text-gray-500 font-hand leading-tight">{{ product.description }}</p>
                    </div>
                    <div
                        class="text-7xl text-purple-200/50 group-hover:text-purple-300/50 transition-colors absolute right-0 bottom-0">
                        {% if "fa-" in product.icon %}
                        <i class="{{ product.icon }}"></i>
                        {% else %}
                        <span>{{ product.icon }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% elif product.card_size == "tall" %}
            <!-- Tall Card (1 column, 2 rows) -->
            <div class="col-span-2 md:col-span-1 row-span-2 clay-card p-8 {% if product.color_theme == 'dark' %}bg-gray-800 text-white{% else %}bg-[#E0E5EC]{% endif %} group cursor-pointer relative overflow-hidden"
                data-url="{% if product.external_url %}{{ product.external_url }}{% else %}{% url 'product_detail' product.id %}{% endif %}"
                onclick="location.href=this.dataset.url" data-aos="fade-up"
                data-aos-delay="{% widthratio forloop.counter 1 100 %}">

                <!-- Quick View Button -->
                <button onclick="event.stopPropagation(); openQuickView('{{ product.id }}')"
                    class="absolute top-6 right-6 z-20 w-10 h-10 rounded-full {% if product.color_theme == 'dark' %}bg-gray-700 text-gray-300 hover:bg-gray-600{% else %}bg-white/50 text-gray-500 hover:bg-white{% endif %} backdrop-blur-sm shadow-sm flex items-center justify-center transition-all hover:scale-110 opacity-0 group-hover:opacity-100"
                    title="미리보기">
                    <i class="fa-solid fa-magnifying-glass-plus"></i>
                </button>

                <div
                    class="absolute top-0 right-0 p-4 opacity-10 text-9xl group-hover:rotate-12 transition-transform duration-500">
                    {% if "fa-" in product.icon %}
                    <i class="{{ product.icon }}"></i>
                    {% else %}
                    <span>{{ product.icon }}</span>
                    {% endif %}
                </div>
                <div class="relative z-10 flex flex-col h-full justify-between">
                    <div>
                        <span
                            class="{% if product.color_theme == 'dark' %}text-blue-300{% else %}text-purple-600{% endif %} font-bold text-lg tracking-wider uppercase mb-2 block">
                            {{ product.service_type|title }}
                        </span>
                        <h3 class="text-5xl font-bold mb-4 leading-tight mt-2">{{ product.title }}</h3>
                        <p
                            class="{% if product.color_theme == 'dark' %}text-gray-400{% else %}text-gray-600{% endif %} text-2xl leading-tight">
                            {{ product.description }}
                        </p>
                    </div>
                    <div class="mt-4">
                        <span
                            class="inline-block border {% if product.color_theme == 'dark' %}border-gray-600 hover:bg-gray-700{% else %}border-gray-300 hover:bg-gray-100{% endif %} rounded-full px-5 py-2 text-lg transition-colors">
                            보러가기 &rarr;
                        </span>
                    </div>
                </div>
            </div>

            {% else %}
            <!-- Small Card (default) -->
            <div class="col-span-2 md:col-span-1 clay-card p-8 flex flex-col justify-between group cursor-pointer hover:bg-purple-50 transition-colors relative"
                data-url="{% if product.external_url %}{{ product.external_url }}{% else %}{% url 'product_detail' product.id %}{% endif %}"
                onclick="location.href=this.dataset.url" data-aos="fade-up"
                data-aos-delay="{% widthratio forloop.counter 1 100 %}">

                <!-- Quick View Button -->
                <button onclick="event.stopPropagation(); openQuickView('{{ product.id }}')"
                    class="absolute top-4 right-4 z-20 w-8 h-8 rounded-full bg-white/50 backdrop-blur-sm text-gray-400 hover:text-purple-600 hover:bg-white shadow-sm flex items-center justify-center transition-all hover:scale-110 opacity-0 group-hover:opacity-100"
                    title="미리보기">
                    <i class="fa-solid fa-magnifying-glass-plus text-sm"></i>
                </button>

                <div
                    class="w-16 h-16 rounded-3xl bg-purple-100 flex items-center justify-center text-purple-500 text-3xl mb-4 shadow-sm">
                    {% if "fa-" in product.icon %}
                    <i class="{{ product.icon }}"></i>
                    {% else %}
                    {{ product.icon }}
                    {% endif %}
                </div>
                <div>
                    <h3 class="text-3xl font-bold text-gray-700 mb-1">{{ product.title }}</h3>
                    <p class="text-xl text-gray-500 leading-tight">{{ product.description|truncatechars:100 }}</p>
                </div>
            </div>
            {% endif %}

        </div> <!-- End wrapper -->

        {% endif %}
        {% endfor %}

        <!-- 7. [Info Card] Why Eduitit? -->
        <div class="col-span-4 md:col-span-2 clay-card p-8 bg-gradient-to-br from-blue-50 to-purple-50"
            data-aos="fade-up" data-aos-delay="700">
            <h3 class="text-3xl font-bold text-gray-700 mb-6">왜 EDUITIT인가요?</h3>
            <div class="grid grid-cols-2 gap-4">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-check-circle text-green-500 text-2xl"></i>
                    <span class="text-gray-600 font-bold text-2xl pt-1">100% 무료</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-bolt text-yellow-500 text-2xl"></i>
                    <span class="text-gray-600 font-bold text-2xl pt-1">설치 불필요</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-user-shield text-purple-500 text-2xl"></i>
                    <span class="text-gray-600 font-bold text-2xl pt-1">로그인 불필요</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-heart text-pink-500 text-2xl"></i>
                    <span class="text-gray-600 font-bold text-2xl pt-1">현직 교사 제작</span>
                </div>
            </div>
        </div>

        <!-- 8. [Contact Card] Feedback -->
        <div class="col-span-4 md:col-span-2 clay-card p-8 flex items-center justify-between group bg-[#E0E5EC]"
            data-aos="fade-up" data-aos-delay="800">
            <div>
                <h3 class="text-3xl font-bold text-gray-700 mb-1">아이디어 제안하기</h3>
                <p class="text-gray-500 font-hand text-2xl">선생님께 필요한 도구를 만들어드려요.</p>
            </div>
            <a href="mailto:kakio@naver.com"
                class="clay-card px-8 py-3 text-purple-600 font-bold text-2xl hover:text-purple-700 transition-all flex items-center gap-2 shadow-clay hover:shadow-clay-hover">
                <i class="fa-regular fa-envelope"></i> <span class="hidden sm:inline">보내기</span>
            </a>
        </div>

    </div> <!-- End Bento Grid -->
</main>

<!-- Quick View Modal Container -->
<div id="quickViewModal"
    class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50 p-4 backdrop-blur-sm transition-all duration-300 opacity-0"
    onclick="if(event.target === this) closeQuickView();">
    <div class="clay-card p-0 max-w-lg w-full mx-auto relative transform scale-95 transition-all duration-300 bg-[#E0E5EC] overflow-hidden min-h-[400px]"
        id="modalPanel">
        <!-- Loading Spinner -->
        <div id="modalLoading" class="absolute inset-0 flex items-center justify-center bg-white/50 z-20 hidden">
            <i class="fa-solid fa-circle-notch fa-spin text-4xl text-purple-500"></i>
        </div>

        <!-- Content Injected via AJAX -->
        <div id="modalContent" class="p-10 relative">
            <!-- Content Loads Here -->
        </div>
    </div>
</div>

<script>
    function openQuickView(productId) {
        const modal = document.getElementById('quickViewModal');
        const panel = document.getElementById('modalPanel');
        const loading = document.getElementById('modalLoading');
        const content = document.getElementById('modalContent');

        // Show Modal Wrapper
        modal.classList.remove('hidden');
        loading.classList.remove('hidden'); // Show spinner

        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.classList.add('flex');
            panel.classList.remove('scale-95');
            panel.classList.add('scale-100');
        }, 10);

        document.body.style.overflow = 'hidden';

        // Fetch Data via AJAX
        fetch(`/products/preview/${productId}/`)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.text();
            })
            .then(html => {
                content.innerHTML = html;
                loading.classList.add('hidden'); // Hide spinner
            })
            .catch(error => {
                console.error('Error:', error);
                content.innerHTML = `<div class="text-center py-10"><p class="text-gray-500">정보를 불러오는데 실패했습니다.</p></div>`;
                loading.classList.add('hidden');
            });
    }

    function closeQuickView() {
        const modal = document.getElementById('quickViewModal');
        const panel = document.getElementById('modalPanel');

        modal.classList.add('opacity-0');
        panel.classList.remove('scale-100');
        panel.classList.add('scale-95');

        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = 'auto';
            document.getElementById('modalContent').innerHTML = ''; // Clear content
        }, 300);
    }
</script>
{% endblock %}