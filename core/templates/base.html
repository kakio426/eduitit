<!DOCTYPE html>
{% load static %}
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta name="description" content="Eduitit - 선생님의 업무 효율을 높여주는 스마트한 AI 도구 모음">
    <meta property="og:title" content="Eduitit - 선생님의 스마트한 하루">
    <meta property="og:description" content="AI 프롬프트 레시피, 도구 가이드, 교육용 게임까지. 교실에서의 혁신을 지금 시작하세요.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://eduitit.site">
    <meta property="og:image" content="https://eduitit.site/static/images/eduitit_og.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/png" href="{% static 'images/favicon.png' %}">
    <title>{% block title %}Eduitit - 선생님의 스마트한 하루{% endblock %}</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Dongle:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@800;900&display=swap" rel="stylesheet">
    <!-- Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bg-soft': '#E0E5EC',
                        'clay-text': '#495057',
                    },
                    fontFamily: {
                        'sans': ['NanumSquareRound', 'Inter', 'sans-serif'],
                        'round': ['NanumSquareRound', 'sans-serif'],
                        'hand': ['Dongle', 'sans-serif'],
                    },
                    boxShadow: {
                        'clay': '9px 9px 16px rgb(163,177,198,0.6), -9px -9px 16px rgba(255,255,255, 0.5)',
                        'clay-inner': 'inset 6px 6px 10px 0 rgba(163, 177, 198, 0.7), inset -6px -6px 10px 0 rgba(255, 255, 255, 0.8)',
                        'clay-hover': '12px 12px 24px rgba(163, 177, 198, 0.8), -12px -12px 24px rgba(255, 255, 255, 0.7)',
                    },
                    borderRadius: {
                        'clay': '30px',
                    }
                }
            }
        }
    </script>


    <style>
        body {
            background-color: #E0E5EC;
            color: #4A5568;
            font-family: 'NanumSquareRound', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        h1,
        h2,
        h3,
        h4,
        .font-title {
            font-weight: 800;
            line-height: 1.3;
            letter-spacing: -0.02em;
        }

        /* Bento Grid Layout - Expert Refinement */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: minmax(200px, auto);
            gap: 1.5rem;
            grid-auto-flow: dense;
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .bento-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: minmax(180px, auto);
                gap: 1.25rem;
            }
        }

        @media (max-width: 640px) {
            .bento-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: minmax(140px, auto);
                gap: 0.75rem;
            }
        }



        /* Spans */
        .col-span-2 {
            grid-column: span 2;
        }

        .col-span-4 {
            grid-column: span 4;
        }

        .row-span-2 {
            grid-row: span 2;
        }

        /* Card Styles - Modern Soft Clay */
        .clay-card {
            background-color: #E0E5EC;
            border-radius: 24px;
            /* Slightly tighter radius */
            box-shadow: 8px 8px 16px rgb(163, 177, 198, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.6);
            /* Softer shadow opacity */
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 1px solid rgba(255, 255, 255, 0.4);
            /* Glassy border */
        }

        .clay-card:hover {
            transform: translateY(-4px) scale(1.005);
            box-shadow: 12px 12px 20px rgba(163, 177, 198, 0.6), -12px -12px 20px rgba(255, 255, 255, 0.7);
            z-index: 10;
        }

        .shadow-clay-inner {
            box-shadow: inset 4px 4px 8px 0 rgba(163, 177, 198, 0.6), inset -4px -4px 8px 0 rgba(255, 255, 255, 0.8);
        }

        /* Animations */
        .float-icon {
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* PREMIUM LOGO STYLING */
        .logo-text {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            font-size: 2.2rem;
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.04em;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: inline-block;
            margin-top: 4px;
        }

        .nav-logo-group:hover .logo-text {
            transform: scale(1.08) rotate(-2deg);
            filter: drop-shadow(0 4px 10px rgba(124, 58, 237, 0.3));
        }

        .logo-icon-box {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .nav-logo-group:hover .logo-icon-box {
            transform: scale(1.15) rotate(10deg);
            background: #ffffff;
            box-shadow: 0 10px 20px rgba(124, 58, 237, 0.2);
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>

<body class="selection:bg-purple-200">

    <!-- Navbar -->
    {% if not hide_navbar %}
    <nav class="fixed w-full z-50 top-0 left-0 px-6 py-4">
        <div
            class="max-w-7xl mx-auto clay-card px-6 py-3 flex justify-between items-center bg-[#E0E5EC]/90 backdrop-blur-sm">
            <div class="flex items-center gap-3">
                <a href="/" class="flex items-center gap-3 group nav-logo-group">
                    <div
                        class="w-12 h-12 rounded-2xl shadow-clay-inner flex items-center justify-center text-purple-600 text-2xl bg-white logo-icon-box">
                        <i class="fa-solid fa-cloud"></i>
                    </div>
                    <span class="logo-text">EDUITIT</span>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex gap-8 mt-2 text-2xl font-bold text-gray-500 items-center">
                <a href="{% url 'settings' %}" class="hover:text-purple-600 transition">이용방법</a>
                <a href="{% url 'portfolio:list' %}" class="hover:text-purple-600 transition">포트폴리오</a>

                <!-- Visitor Count (Desktop) -->
                <div class="hidden lg:flex items-center gap-3 px-4 py-2 rounded-full bg-white/60 shadow-clay-inner text-sm transition hover:scale-105 cursor-help select-none"
                    title="오늘 방문자 / 전체 방문자">
                    <span class="text-orange-500 font-extrabold flex items-center gap-1.5"><i
                            class="fa-solid fa-user-clock"></i> {{ today_visitor_count|default:"0" }}</span>
                    <span class="text-gray-300 font-light">|</span>
                    <span class="text-purple-600 font-extrabold flex items-center gap-1.5"><i
                            class="fa-solid fa-users-line"></i> {{ total_visitor_count|default:"0" }}</span>
                </div>
                {% if user.is_authenticated %}
                <a href="{% url 'sso_schoolit' %}"
                    class="hover:text-blue-600 transition flex items-center gap-2 px-4 py-1.5 rounded-full shadow-clay text-blue-600 font-bold bg-[#E0E5EC] hover:shadow-clay-hover">
                    <i class="fa-solid fa-graduation-cap text-xl"></i> 스쿨잇 이동
                </a>

                <!-- User Dropdown -->
                <div class="relative group">
                    <button id="userMenuBtn"
                        class="flex items-center gap-3 px-5 py-2 rounded-full shadow-clay-inner bg-[#E0E5EC]/50 hover:bg-white/50 transition-all font-bold text-gray-700">
                        <div
                            class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center text-purple-500 text-sm shadow-sm">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <span class="text-xl">
                            {% if user.userprofile.nickname %}{{ user.userprofile.nickname }}{% elif user.username %}{{
                            user.username }}{% else %}사용자{% endif %}님
                        </span>
                        <i class="fa-solid fa-chevron-down text-sm transition-transform group-hover:rotate-180"></i>
                    </button>
                    <!-- Dropdown Menu -->
                    <div
                        class="absolute right-0 top-full mt-4 w-56 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2 z-[60]">
                        <div class="clay-card p-3 bg-white/90 backdrop-blur-xl border border-white/50">
                            <a href="{% url 'dashboard' %}"
                                class="flex items-center gap-3 px-4 py-3 rounded-2xl hover:bg-purple-50 text-gray-600 hover:text-purple-600 transition-all">
                                <i class="fa-solid fa-gauge-high"></i>
                                <span>내 홈페이지</span>
                            </a>
                            <a href="{% url 'fortune:history' %}"
                                class="flex items-center gap-3 px-4 py-3 rounded-2xl hover:bg-purple-50 text-gray-600 hover:text-purple-600 transition-all">
                                <i class="fa-solid fa-box-archive"></i>
                                <span>사주 보관함</span>
                            </a>
                            <a href="{% url 'settings' %}"
                                class="flex items-center gap-3 px-4 py-3 rounded-2xl hover:bg-purple-50 text-gray-600 hover:text-purple-600 transition-all">
                                <i class="fa-solid fa-gear"></i>
                                <span>내 설정</span>
                            </a>
                            <div class="h-px bg-gray-100 my-2"></div>
                            <form action="{% url 'account_logout' %}" method="post" class="block">
                                {% csrf_token %}
                                <button type="submit"
                                    class="w-full flex items-center gap-3 px-4 py-3 rounded-2xl hover:bg-red-50 text-red-400 hover:text-red-500 transition-all text-left">
                                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                                    <span>로그아웃</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% else %}
                <a href="{% url 'account_login' %}"
                    class="hover:text-purple-600 transition px-5 py-1.5 rounded-full shadow-clay text-purple-600 font-bold bg-[#E0E5EC] hover:shadow-clay-hover">
                    <i class="fa-solid fa-user-lock mr-1"></i> 로그인
                </a>
                {% endif %}
            </div>

            <!-- Mobile Hamburger Button -->
            <button id="mobileMenuBtn" onclick="toggleMobileMenu()"
                class="md:hidden w-12 h-12 rounded-full shadow-clay-inner flex items-center justify-center text-gray-500 hover:text-purple-600 transition"
                aria-label="메뉴 열기" aria-expanded="false" aria-controls="mobileMenu">
                <i class="fa-solid fa-bars text-xl" id="menuIcon"></i>
            </button>
        </div>
    </nav>
    {% endif %}

    <!-- Mobile Menu Panel -->
    <div id="mobileMenu"
        class="fixed inset-x-0 top-[88px] z-40 md:hidden transform -translate-y-full opacity-0 transition-all duration-300 ease-in-out pointer-events-none"
        aria-hidden="true">
        <div class="mx-4 clay-card p-6 bg-[#E0E5EC]/95 backdrop-blur-sm">
            <div class="flex flex-col gap-4 text-2xl font-bold text-gray-600">
                <a href="{% url 'settings' %}"
                    class="hover:text-purple-600 transition py-2 border-b border-gray-200/50">
                    <i class="fa-solid fa-circle-info mr-3 text-purple-400"></i> 이용방법
                </a>
                <a href="{% url 'portfolio:list' %}"
                    class="hover:text-purple-600 transition py-2 border-b border-gray-200/50">
                    <i class="fa-solid fa-briefcase mr-3 text-blue-400"></i> 포트폴리오
                </a>

                <!-- Visitor Count (Mobile) -->
                <div
                    class="flex md:hidden items-center gap-4 px-4 py-3 rounded-2xl bg-white/60 shadow-inner text-gray-500 font-bold text-sm justify-center mb-2">
                    <span class="text-orange-500 flex items-center gap-2"><i class="fa-solid fa-user-clock"></i> Today:
                        {{ today_visitor_count|default:"0" }}</span>
                    <span class="text-gray-400">|</span>
                    <span class="text-purple-600 flex items-center gap-2"><i class="fa-solid fa-users-line"></i> Total:
                        {{ total_visitor_count|default:"0" }}</span>
                </div>

                {% if user.is_authenticated %}
                <div class="py-2 border-b border-gray-200/50 flex items-center gap-3 text-purple-500">
                    <i class="fa-solid fa-user-circle text-2xl"></i>
                    <span>{% if user.userprofile.nickname %}{{ user.userprofile.nickname }}{% elif user.username %}{{
                        user.username }}{% else %}사용자{% endif %}님</span>
                </div>
                <a href="{% url 'sso_schoolit' %}"
                    class="hover:text-blue-600 transition py-2 border-b border-gray-200/50">
                    <i class="fa-solid fa-graduation-cap mr-3 text-blue-400"></i> 스쿨잇 이동 (SSO)
                </a>
                <a href="{% url 'fortune:history' %}"
                    class="hover:text-purple-600 transition py-2 border-b border-gray-200/50">
                    <i class="fa-solid fa-box-archive mr-3 text-purple-400"></i> 사주 보관함
                </a>
                <a href="{% url 'settings' %}"
                    class="hover:text-purple-600 transition py-2 border-b border-gray-200/50">
                    <i class="fa-solid fa-gear mr-3 text-gray-400"></i> 내 설정
                </a>
                <form action="{% url 'account_logout' %}" method="post" class="py-2">
                    {% csrf_token %}
                    <button type="submit" class="w-full text-left text-red-500 hover:text-red-600 transition">
                        <i class="fa-solid fa-arrow-right-from-bracket mr-3"></i> 로그아웃
                    </button>
                </form>
                {% else %}
                <a href="{% url 'account_login' %}"
                    class="py-3 mt-2 text-center rounded-full shadow-clay text-purple-600 hover:shadow-clay-hover transition">
                    <i class="fa-solid fa-user-lock mr-2"></i> 로그인
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    {% block content %}{% endblock %}

    <!-- Footer -->
    <footer class="py-16 px-6 bg-white/30 backdrop-blur-md mt-20 border-t border-white/20">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-10">
            <div class="text-center md:text-left space-y-4">
                <div class="flex items-center justify-center md:justify-start gap-3">
                    <div
                        class="w-10 h-10 rounded-xl bg-white shadow-clay flex items-center justify-center text-purple-600">
                        <i class="fa-solid fa-cloud"></i>
                    </div>
                    <span class="text-2xl font-black tracking-tighter text-gray-700">EDUITIT</span>
                </div>
                <p class="text-2xl font-hand text-gray-500">선생님의 칼퇴를 응원합니다.</p>
                <div class="text-sm text-gray-400 font-medium">
                    대표 유병주 | <a href="mailto:kakio@korea.kr"
                        class="hover:text-purple-600 transition">kakio@korea.kr</a><br>
                    © 2026 Eduitit. All rights reserved.
                </div>
            </div>

            <div class="flex flex-wrap justify-center gap-8 text-sm font-bold text-gray-500">
                <a href="{% url 'policy' %}#terms" class="hover:text-purple-600 transition">이용약관</a>
                <a href="{% url 'policy' %}#privacy" class="hover:text-purple-600 transition">개인정보처리방침</a>
                <a href="{% url 'settings' %}" class="hover:text-purple-600 transition">이용가이드</a>
                <a href="mailto:kakio@korea.kr" class="hover:text-purple-600 transition">의견 보내기</a>
            </div>
        </div>
    </footer>

    <!-- Auto Logout Warning Modal -->
    <div id="autoLogoutModal" class="fixed inset-0 z-[110] hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-gray-500/20 backdrop-blur-md transition-opacity duration-300"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-[2.5rem] bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-md border-2 border-purple-100 p-8">
                    <div class="flex flex-col items-center text-center space-y-6">
                        <div
                            class="w-20 h-20 rounded-full bg-purple-50 flex items-center justify-center text-purple-500 text-3xl shadow-clay-inner">
                            <i class="fa-solid fa-clock-rotate-left float-icon"></i>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">자동 로그아웃 안내</h3>
                            <p class="text-gray-500 font-medium">보안을 위해 장기간 활동이 없어<br><span id="logoutTimer"
                                    class="text-purple-600 font-bold">60</span>초 후 자동으로 로그아웃됩니다.</p>
                        </div>
                        <div class="flex flex-col w-full gap-3">
                            <button onclick="extendSession()"
                                class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold shadow-clay hover:bg-purple-700 transition transform hover:scale-[1.02] active:scale-[0.98]">
                                로그인 연장하기
                            </button>
                            <form action="{% url 'account_logout' %}" method="post" class="w-full">
                                {% csrf_token %}
                                <button type="submit"
                                    class="w-full py-4 text-gray-400 font-bold hover:text-gray-600 transition">
                                    지금 로그아웃
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified Modal for All Product Previews -->
    <div id="unifiedModal" class="fixed inset-0 z-[100] hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-gray-500/20 backdrop-blur-md transition-opacity duration-300 opacity-0"
            id="modalBackdrop" aria-hidden="true" onclick="closeModal()"></div>

        <div class="fixed inset-0 z-10 overflow-hidden">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform rounded-2xl md:rounded-[2.5rem] bg-white/95 backdrop-blur-2xl text-left shadow-2xl transition-all w-full max-w-2xl border-2 border-white/50 scale-95 opacity-0 duration-300 flex flex-col max-h-[90vh] md:max-h-[85vh]"
                    id="modalPanel">

                    <!-- Loading Spinner Overlay -->
                    <div id="modalLoading"
                        class="absolute inset-0 z-20 flex items-center justify-center bg-white/50 hidden">
                        <div class="flex flex-col items-center gap-4">
                            <i class="fa-solid fa-circle-notch fa-spin text-5xl text-purple-500"></i>
                            <p class="text-xl font-bold text-gray-500">정보를 가져오는 중...</p>
                        </div>
                    </div>

                    <!-- Close Button (Top Right Inside) -->
                    <button onclick="closeModal()"
                        class="absolute top-6 right-6 z-30 w-12 h-12 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-500 transition-colors shadow-sm"
                        aria-label="Close modal">
                        <i class="fa-solid fa-xmark text-xl"></i>
                    </button>

                    <div id="modalContent" class="flex-1 overflow-hidden relative h-full flex flex-col">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile Menu Toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const btn = document.getElementById('mobileMenuBtn');
            const icon = document.getElementById('menuIcon');
            const isOpen = menu.classList.contains('translate-y-0');

            if (isOpen) {
                // Close menu
                menu.classList.remove('translate-y-0', 'opacity-100', 'pointer-events-auto');
                menu.classList.add('-translate-y-full', 'opacity-0', 'pointer-events-none');
                menu.setAttribute('aria-hidden', 'true');
                btn.setAttribute('aria-expanded', 'false');
                btn.setAttribute('aria-label', '메뉴 열기');
                icon.classList.remove('fa-xmark');
                icon.classList.add('fa-bars');
                document.body.style.overflow = 'auto';
            } else {
                // Open menu
                menu.classList.remove('-translate-y-full', 'opacity-0', 'pointer-events-none');
                menu.classList.add('translate-y-0', 'opacity-100', 'pointer-events-auto');
                menu.setAttribute('aria-hidden', 'false');
                btn.setAttribute('aria-expanded', 'true');
                btn.setAttribute('aria-label', '메뉴 닫기');
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-xmark');
                document.body.style.overflow = 'hidden';
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function (e) {
            const menu = document.getElementById('mobileMenu');
            const btn = document.getElementById('mobileMenuBtn');
            if (menu && !menu.contains(e.target) && !btn.contains(e.target)) {
                if (menu.classList.contains('translate-y-0')) {
                    toggleMobileMenu();
                }
            }
        });

        // Close mobile menu on resize to desktop
        window.addEventListener('resize', function () {
            const menu = document.getElementById('mobileMenu');
            if (window.innerWidth >= 768 && menu && menu.classList.contains('translate-y-0')) {
                toggleMobileMenu();
            }
        });

        function openUnifiedModal() {
            const modal = document.getElementById('unifiedModal');
            const backdrop = document.getElementById('modalBackdrop');
            const panel = document.getElementById('modalPanel');
            const body = document.body;

            // Show modal and prevent scroll
            modal.classList.remove('hidden');
            body.style.overflow = 'hidden';

            // Reset scale for animation
            panel.classList.add('scale-95', 'opacity-0');

            // Animate in
            requestAnimationFrame(() => {
                backdrop.classList.remove('opacity-0');
                panel.classList.remove('scale-95', 'opacity-0');
                panel.classList.add('scale-100', 'opacity-100');
            });
        }

        function openModal(productId) {
            openUnifiedModal();

            const content = document.getElementById('modalContent');
            const loading = document.getElementById('modalLoading');

            // Show loading
            loading.classList.remove('hidden');
            content.innerHTML = '';

            // Load content
            fetch(`/products/preview/${productId}/?t=${Date.now()}`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.text();
                })
                .then(html => {
                    content.innerHTML = html;
                    loading.classList.add('hidden');
                })
                .catch(error => {
                    console.error('Error loading modal content:', error);
                    content.innerHTML = `
                        <div class="flex flex-col items-center justify-center py-20 text-center space-y-6">
                            <i class="fa-solid fa-triangle-exclamation text-7xl text-gray-200"></i>
                            <h3 class="text-3xl font-bold text-gray-700">정보를 불러오지 못했습니다</h3>
                            <p class="text-xl text-gray-400 font-hand">잠시 후 다시 시도해 주세요.</p>
                            <button onclick="openModal(${productId})" class="px-8 py-3 bg-purple-500 text-white rounded-full font-bold shadow-clay hover:scale-105 transition">다시 시도</button>
                        </div>
                    `;
                    loading.classList.add('hidden');
                });
        }

        function closeModal() {
            const modal = document.getElementById('unifiedModal');
            const backdrop = document.getElementById('modalBackdrop');
            const panel = document.getElementById('modalPanel');
            const body = document.body;

            // Animate out
            backdrop.classList.add('opacity-0');
            panel.classList.remove('scale-100', 'opacity-100');
            panel.classList.add('scale-95', 'opacity-0');

            setTimeout(() => {
                modal.classList.add('hidden');
                body.style.overflow = 'auto';
            }, 300);
        }

        // Close on escape key
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && !document.getElementById('unifiedModal').classList.contains('hidden')) {
                closeModal();
            }
        });

        // Prevent clicks inside modal from closing it
        document.addEventListener('DOMContentLoaded', function () {
            const panel = document.getElementById('modalPanel');
            if (panel) {
                panel.addEventListener('click', function (e) {
                    e.stopPropagation();
                });
            }
        });
    </script>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js" defer></script>
    <script>
        // Initialize Animate On Scroll
        document.addEventListener('DOMContentLoaded', function () {
            AOS.init({
                once: true,
                offset: 50,
                duration: 800,
            });
        });
    </script>
    {% if user.is_authenticated %}
    <script>
        // Auto Logout Logic
        (function () {
            let timeoutMinutes = 60; // SESSION_COOKIE_AGE와 동일하게 설정 (1시간)
            let warningMinutes = 59; // 59분에 경고 표시
            let logoutTimer;
            let warningTimer;
            let countdownInterval;
            let secondsLeft = 60;

            function startTimers() {
                clearTimeout(logoutTimer);
                clearTimeout(warningTimer);
                clearInterval(countdownInterval);
                document.getElementById('autoLogoutModal').classList.add('hidden');

                // 경고창 표시 타이머
                warningTimer = setTimeout(showWarning, warningMinutes * 60 * 1000);

                // 실제 로그아웃 타이머 (실제 세션 만료보다 약간 먼저 로그아웃 처리)
                logoutTimer = setTimeout(autoLogout, timeoutMinutes * 60 * 1000);
            }

            function showWarning() {
                document.getElementById('autoLogoutModal').classList.remove('hidden');
                secondsLeft = 60;
                updateCountdown();
                countdownInterval = setInterval(updateCountdown, 1000);
            }

            function updateCountdown() {
                const timerEl = document.getElementById('logoutTimer');
                if (timerEl) {
                    timerEl.textContent = secondsLeft;
                    if (secondsLeft <= 0) {
                        clearInterval(countdownInterval);
                    }
                    secondsLeft--;
                }
            }

            function autoLogout() {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'account_logout' %}";
                const csrf = document.createElement('input');
                csrf.type = 'hidden';
                csrf.name = 'csrfmiddlewaretoken';
                csrf.value = '{{ csrf_token }}';
                form.appendChild(csrf);
                document.body.appendChild(form);
                form.submit();
            }

            window.extendSession = function () {
                // 단순히 아무 API나 호출하여 세션을 갱신 (CSRF 필요 없음, 세션 쿠키만 전송되면 됨)
                fetch(window.location.href, { method: 'HEAD' })
                    .then(() => {
                        startTimers();
                        console.log('Session extended');
                    })
                    .catch(err => console.error('Failed to extend session', err));
            };

            // 사용자 활동 감지 (클릭, 키보드 입력 등)
            const activities = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
            let throttleTimer;

            function handleActivity() {
                if (throttleTimer) return;

                throttleTimer = setTimeout(() => {
                    // 경고창이 보이지 않을 때만 타이머 리셋
                    if (document.getElementById('autoLogoutModal').classList.contains('hidden')) {
                        startTimers();
                    }
                    throttleTimer = null;
                }, 10000); // 10초마다 체크 (성능 최적화)
            }

            activities.forEach(activity => {
                window.addEventListener(activity, handleActivity, true);
            });

            // 초기 타이머 시작
            startTimers();
        })();
    </script>
    {% endif %}
    {% block extra_js %}{% endblock %}
</body>

</html>