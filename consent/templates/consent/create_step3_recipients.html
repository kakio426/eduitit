{% extends "base.html" %}

{% block title %}동의서 생성 2단계{% endblock %}

{% block content %}
<main class="pt-32 pb-16 px-4 min-h-screen bg-[#E0E5EC]">
  <div class="max-w-6xl mx-auto">
    <div class="mb-6">
      <a href="{% url 'consent:create_step1' %}" class="text-sm text-gray-500 hover:text-purple-600">이전 단계로</a>
      <h1 class="text-3xl font-bold text-gray-800 mt-2">2단계. 수신자 등록</h1>
      <p class="text-sm text-gray-500 mt-1">학생명, 학부모명(선택: 연락처)을 직접 입력하거나 CSV로 한번에 등록하세요.</p>
    </div>

    <div class="grid lg:grid-cols-2 gap-4">
      <section class="clay-card p-5">
        <h2 class="text-lg font-bold mb-3">수신자 일괄 등록</h2>
        <form method="post" enctype="multipart/form-data" class="space-y-4">
          {% csrf_token %}
          <div>
            <div class="flex items-center justify-between mb-2">
              <label class="text-sm font-semibold text-gray-700">CSV 업로드</label>
              <a href="{% url 'consent:recipients_csv_template' %}" class="text-xs font-semibold text-indigo-600 hover:underline">예시 CSV 다운로드</a>
            </div>
            {{ form.recipients_csv }}
            <p class="text-xs text-gray-500 mt-1">헤더 포함 가능: 학생명, 학부모명, 연락처</p>
            {{ form.recipients_csv.errors }}
          </div>

          <div>
            <label class="text-sm font-semibold text-gray-700">직접 입력</label>
            <p class="text-xs text-gray-500 mt-1 mb-2">한 줄에 1명씩 <code>학생명,학부모명,연락처</code> 형식으로 입력하세요.</p>
            {{ form.recipients_text }}
            {{ form.recipients_text.errors }}
          </div>

          {{ form.non_field_errors }}
          <div>
            <button type="submit" class="px-4 py-2 rounded-xl bg-purple-600 text-white font-semibold hover:bg-purple-700">등록</button>
            <a href="{% url 'consent:detail' request_id=consent_request.request_id %}" class="ml-2 px-4 py-2 rounded-xl shadow-clay-inner bg-bg-soft text-sm">상세로 이동</a>
          </div>
        </form>
      </section>

      <section class="clay-card p-5">
        <h2 class="text-lg font-bold mb-3">현재 등록 목록</h2>
        <div class="max-h-80 overflow-auto border rounded-xl border-gray-200">
          <table class="w-full text-sm">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-3 py-2 text-left">학생명</th>
                <th class="px-3 py-2 text-left">학부모명</th>
              </tr>
            </thead>
            <tbody>
              {% for r in recipients %}
              <tr class="border-t">
                <td class="px-3 py-2">{{ r.student_name }}</td>
                <td class="px-3 py-2">{{ r.parent_name }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="2" class="px-3 py-8 text-center text-gray-400">아직 수신자가 없습니다.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
</main>
{% endblock %}
