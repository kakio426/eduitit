{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
<meta property="og:title" content="ê°„í¸ ìˆ˜í•© - ëŒ€ì‹œë³´ë“œ" />
<meta property="og:description" content="íŒŒì¼Â·ë§í¬Â·í…ìŠ¤íŠ¸ ìˆ˜í•© ê´€ë¦¬" />
{% endblock %}

{% block extra_css %}
<style>
    .request-card {
        background: linear-gradient(135deg, #E0E5EC 0%, #F5F7FA 100%);
        border-radius: 20px;
        box-shadow: 8px 8px 16px #b8bec5, -8px -8px 16px #ffffff;
        transition: all 0.3s ease;
    }

    .request-card:hover {
        transform: translateY(-4px);
        box-shadow: 12px 12px 24px #b8bec5, -12px -12px 24px #ffffff;
    }

    .status-active {
        background: #DCFCE7;
        color: #15803D;
    }

    .status-closed {
        background: #FEE2E2;
        color: #DC2626;
    }

    .status-archived {
        background: #F3F4F6;
        color: #6B7280;
    }
</style>
{% endblock %}

{% block content %}
<section class="pt-32 pb-20 px-6 min-h-screen bg-[#E0E5EC]">
    <div class="max-w-4xl mx-auto">
        <!-- í—¤ë” -->
        <div class="text-center mb-12" data-aos="fade-up">
            <div class="text-7xl mb-4 float-icon">{{ service.icon|default:"ğŸ“‹" }}</div>
            <h1 class="text-4xl md:text-5xl font-bold text-gray-700 font-title mb-4">
                {{ service.title|default:"ê°„í¸ ìˆ˜í•©" }}
            </h1>
            <p class="text-xl text-gray-500">íŒŒì¼Â·ë§í¬Â·í…ìŠ¤íŠ¸ ìˆ˜í•© ìš”ì²­ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- ìƒˆ ìˆ˜í•© ìš”ì²­ ìƒì„± -->
        <div class="clay-card p-6 mb-8" data-aos="fade-up" x-data="{ open: false }">
            <div class="flex items-center justify-between cursor-pointer" @click="open = !open">
                <h2 class="text-xl font-bold text-gray-700 flex items-center gap-2">
                    <i class="fa-solid fa-plus-circle text-emerald-500"></i>
                    ìƒˆ ìˆ˜í•© ìš”ì²­ ë§Œë“¤ê¸°
                </h2>
                <i class="fa-solid fa-chevron-down text-gray-400 transition-transform"
                    :class="open && 'rotate-180'"></i>
            </div>

            <div x-show="open" x-transition class="mt-6">
                <form action="{% url 'collect:request_create' %}" method="post" enctype="multipart/form-data"
                    class="space-y-4">
                    {% csrf_token %}

                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">{{ form.title.label }}</label>
                        {{ form.title }}
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">{{ form.description.label }}</label>
                        {{ form.description }}
                    </div>

                    <!-- ì œì¶œ ëŒ€ìƒì ëª©ë¡ -->
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">
                            <i class="fa-solid fa-users text-emerald-500 mr-1"></i>
                            {{ form.expected_submitters.label }}
                            <span class="text-xs text-gray-400 font-normal ml-1">(ì„ íƒì‚¬í•­: ë¯¸ì œì¶œì í™•ì¸ìš©)</span>
                        </label>
                        {{ form.expected_submitters }}
                        <p class="text-xs text-gray-400 mt-1">í•œ ì¤„ì— í•œ ëª…ì”© ì…ë ¥í•˜ë©´ ì œì¶œ í˜„í™©ì—ì„œ ëˆ„ê°€ ì•„ì§ ì œì¶œí•˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¹„ì›Œë‘ë©´ ììœ 
                            ì œì¶œì…ë‹ˆë‹¤.</p>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-1">{{ form.deadline.label }}</label>
                            {{ form.deadline }}
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-600 mb-1">{{ form.max_submissions.label }}</label>
                            {{ form.max_submissions }}
                        </div>
                    </div>

                    <!-- ì–‘ì‹ íŒŒì¼ ì—…ë¡œë“œ -->
                    <div>
                        <label class="block text-sm font-bold text-gray-600 mb-1">
                            <i class="fa-solid fa-file-lines text-emerald-500 mr-1"></i>
                            {{ form.template_file.label }}
                            <span class="text-xs text-gray-400 font-normal ml-1">(ì„ íƒì‚¬í•­: ì œì¶œìì—ê²Œ ì œê³µí•  ì–‘ì‹)</span>
                        </label>
                        {{ form.template_file }}
                        <p class="text-xs text-gray-400 mt-1">hwp, xlsx, docx, pdf ë“± ì–‘ì‹ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ì œì¶œìê°€ ë‹¤ìš´ë¡œë“œ í›„ ì‘ì„±í•˜ì—¬ ì œì¶œí•  ìˆ˜
                            ìˆìŠµë‹ˆë‹¤.</p>
                    </div>

                    <!-- í—ˆìš© ìœ í˜• -->
                    <div class="flex flex-wrap gap-6">
                        <label class="flex items-center gap-2 cursor-pointer">
                            {{ form.allow_file }}
                            <span class="text-sm font-medium text-gray-600">íŒŒì¼ ì—…ë¡œë“œ</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            {{ form.allow_link }}
                            <span class="text-sm font-medium text-gray-600">ë§í¬ ì œì¶œ</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            {{ form.allow_text }}
                            <span class="text-sm font-medium text-gray-600">í…ìŠ¤íŠ¸ ì œì¶œ</span>
                        </label>
                    </div>

                    <!-- ì•ˆë‚´ì‚¬í•­ -->
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 text-sm text-blue-700 space-y-1">
                        <p><i class="fa-solid fa-info-circle mr-1"></i><strong>ì•ˆë‚´ì‚¬í•­</strong></p>
                        <p>- íŒŒì¼ì€ 30MB ì´í•˜ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì´ˆê³¼ ì‹œ êµ¬ê¸€ë“œë¼ì´ë¸Œ ë§í¬ë¡œ ì œì¶œì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>
                        <p>- ìˆ˜í•© ì™„ë£Œ(ë§ˆê°) í›„ <strong>7ì¼</strong>ì´ ì§€ë‚˜ë©´ ì œì¶œ íŒŒì¼ì´ ìë™ ì‚­ì œë©ë‹ˆë‹¤.</p>
                        <p>- ìˆ˜í•© ìš”ì²­ì€ ì²« ì œì¶œ í›„ <strong>30ì¼</strong>ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. (ì œì¶œ ì—†ìœ¼ë©´ 60ì¼)</p>
                    </div>

                    {% if form.errors %}
                    <div class="bg-red-100 text-red-700 p-3 rounded-xl text-sm">
                        {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                        {% endfor %}
                    </div>
                    {% endif %}

                    <button type="submit"
                        class="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl transition transform hover:scale-[1.02]">
                        <i class="fa-solid fa-plus mr-2"></i>
                        ìˆ˜í•© ìš”ì²­ ìƒì„±
                    </button>
                </form>
            </div>
        </div>

        <!-- ìˆ˜í•© ëª©ë¡ -->
        <div class="space-y-4">
            <h2 class="text-2xl font-bold text-gray-700 flex items-center gap-2">
                <i class="fa-solid fa-list text-emerald-500"></i>
                ë‚´ ìˆ˜í•© ìš”ì²­ ëª©ë¡
            </h2>

            {% if requests_list %}
            {% for req in requests_list %}
            <div class="request-card p-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter }}00">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-3 mb-2 flex-wrap">
                            <h3 class="text-xl font-bold text-gray-700 truncate">{{ req.title }}</h3>
                            {% if req.status == 'active' %}
                            <span class="status-active px-3 py-1 rounded-full text-xs font-bold">
                                <i class="fa-solid fa-circle-check mr-1"></i>ì§„í–‰ì¤‘
                            </span>
                            {% elif req.status == 'closed' %}
                            <span class="status-closed px-3 py-1 rounded-full text-xs font-bold">
                                <i class="fa-solid fa-circle-xmark mr-1"></i>ë§ˆê°
                            </span>
                            {% else %}
                            <span class="status-archived px-3 py-1 rounded-full text-xs font-bold">
                                <i class="fa-solid fa-box-archive mr-1"></i>ë³´ê´€
                            </span>
                            {% endif %}
                        </div>
                        <div class="text-gray-500 text-sm flex items-center gap-4 flex-wrap">
                            <span><i class="fa-solid fa-paper-plane mr-1"></i>{{ req.num_submissions }}ê±´ ì œì¶œ</span>
                            <span><i class="fa-solid fa-calendar mr-1"></i>{{ req.created_at|date:"Y-m-d H:i" }}</span>
                            {% if req.access_code %}
                            <span class="font-bold text-emerald-600"><i class="fa-solid fa-key mr-1"></i>ì½”ë“œ: {{ req.access_code }}</span>
                            {% endif %}
                            {% if req.deadline %}
                            <span><i class="fa-solid fa-clock mr-1"></i>ë§ˆê°: {{ req.deadline|date:"m/d H:i" }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <a href="{% url 'collect:request_detail' req.id %}"
                            class="px-6 py-3 bg-white rounded-xl font-bold text-gray-700 shadow-md hover:shadow-lg transition flex items-center gap-2">
                            <i class="fa-solid fa-eye"></i>
                            ìƒì„¸ë³´ê¸°
                        </a>
                        <form action="{% url 'collect:request_delete' req.id %}" method="post"
                            onsubmit="return confirm('ì •ë§ë¡œ ì´ ìˆ˜í•© ìš”ì²­ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ì œì¶œë¬¼ì´ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.');">
                            {% csrf_token %}
                            <button type="submit"
                                class="px-4 py-3 bg-red-100 text-red-600 rounded-xl font-bold hover:bg-red-200 transition">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="text-center py-12 text-gray-400">
                <i class="fa-solid fa-folder-open text-5xl mb-4"></i>
                <p class="text-lg">ì•„ì§ ìƒì„±ëœ ìˆ˜í•© ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                <p>ìœ„ì—ì„œ ìƒˆ ìˆ˜í•© ìš”ì²­ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}