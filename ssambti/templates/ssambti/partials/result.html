{% load static %}
<div class="w-full max-w-4xl mx-auto space-y-8 animate-fade-in-up pb-20">

    <!-- 1. í—¤ë” ì¹´ë“œ (ë™ë¬¼ ì´ë¯¸ì§€ & íƒ€ì´í‹€) -->
    <div class="clay-card p-10 text-center relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-300 to-orange-500"></div>

        <div class="inline-block p-4 rounded-full bg-white shadow-clay-inner mb-6 relative z-10">
            <img src="{% static 'fortune/images/zoo/' %}{{ animal_image }}" alt="{{ animal_name }}"
                class="w-80 h-80 object-contain rounded-full">
        </div>

        <h2 class="text-5xl md:text-6xl font-bold text-gray-800 font-title mb-4">
            <span class="text-orange-500 block text-3xl mb-3 font-hand">êµì‹¤ ì† ë‹¹ì‹ ì˜ ë™ë¬¼ì€</span>
            {{ animal_name }}
        </h2>
    </div>

    <!-- 2. AI ë¶„ì„ ë‚´ìš© -->
    <div class="zoo-result-content">
        {{ result_html|safe }}
    </div>

    <!-- 3. ê³µìœ  ì•¡ì…˜ ì¹´ë“œ -->
    <div class="clay-card p-8 bg-white/50 border border-white/60 text-center">

        {% if not user.is_authenticated %}
        <div class="mb-6 p-4 bg-orange-50 rounded-2xl border border-orange-100 animate-pulse">
            <p class="text-orange-700 font-bold font-hand text-xl">
                <i class="fa-solid fa-triangle-exclamation mr-2"></i> ë¡œê·¸ì¸í•˜ì§€ ì•Šìœ¼ë©´ ì´ ê²°ê³¼ëŠ” ì €ì¥ë˜ì§€ ì•Šì•„ìš”!
            </p>
            <a href="{% url 'account_login' %}?next={% url 'fortune:zoo_main' %}"
                class="inline-block mt-2 text-sm text-orange-600 underline font-bold hover:text-orange-800">
                ë¡œê·¸ì¸í•˜ê³  ê²°ê³¼ ì˜êµ¬ ì €ì¥í•˜ê¸°
            </a>
        </div>
        {% endif %}

        <h3 class="text-2xl font-bold text-gray-700 mb-6 font-title">
            ë™ë£Œ ì„ ìƒë‹˜ë“¤ì—ê²Œë„ ì•Œë ¤ì£¼ì„¸ìš”! ğŸ“¢
        </h3>
        <div class="flex flex-col md:flex-row gap-4 justify-center">
            <button onclick="shareToKakao()"
                class="px-8 py-4 rounded-full bg-[#FEE500] text-[#3C1E1E] font-bold hover:scale-105 transition shadow-clay flex items-center justify-center gap-2 text-lg">
                <i class="fa-solid fa-comment"></i> ì¹´ì¹´ì˜¤í†¡ ê³µìœ 
            </button>
            <a href="{% url 'fortune:zoo_main' %}"
                class="px-8 py-4 rounded-full bg-orange-500 text-white font-bold hover:bg-orange-600 transition shadow-clay flex items-center justify-center gap-2 text-lg">
                <i class="fa-solid fa-rotate-right"></i> ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°
            </a>
        </div>
    </div>
</div>

<!-- Kakao SDK -->
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.0/kakao.min.js"></script>
<script>
    // HTMX ë“±ìœ¼ë¡œ ë‚˜ì¤‘ì— ì‚½ì…ë˜ì–´ë„ ì¦‰ì‹œ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜(IIFE) ì‚¬ìš©
    (function () {
        function initKakao() {
            if (typeof Kakao !== 'undefined') {
                if (!Kakao.isInitialized()) {
                    try {
                        Kakao.init('{{ KAKAO_JS_KEY }}');
                        console.log('âœ… Kakao SDK initialized (Direct)');
                    } catch (error) {
                        console.error('âŒ Kakao init error:', error);
                    }
                } else {
                    console.log('âœ… Kakao SDK already initialized');
                }
            } else {
                // ì•„ì§ SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¬ì‹œë„
                console.log('â³ Waiting for Kakao SDK...');
                setTimeout(initKakao, 200);
            }
        }
        initKakao();
    })();

    function shareToKakao() {
        if (typeof Kakao === 'undefined') {
            alert('ì¹´ì¹´ì˜¤í†¡ SDKë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!Kakao.isInitialized()) {
            // í•œë²ˆ ë” ì´ˆê¸°í™” ì‹œë„
            try {
                Kakao.init('{{ KAKAO_JS_KEY }}');
            } catch (e) {
                alert('ì¹´ì¹´ì˜¤í†¡ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.');
                return;
            }
        }

        try {
            Kakao.Share.sendDefault({
                objectType: 'feed',
                content: {
                    title: 'ğŸ¯ ë‚˜ëŠ” [{{ animal_name }}] ì„ ìƒë‹˜!',
                    description: '{{ animal_name }} ì„ ìƒë‹˜ì˜ íŠ¹ì§•: {{ summary }}\n\në‹¹ì‹ ì€ ì–´ë–¤ ì„ ìƒë‹˜ì¸ê°€ìš”? ì§€ê¸ˆ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”! ğŸ«',
                    imageUrl: 'https://{{ request.get_host }}{% static "ssambti/images/animals/" %}{{ animal_image }}',
                    link: {
                        mobileWebUrl: 'https://{{ request.get_host }}{% url "fortune:zoo_main" %}',
                        webUrl: 'https://{{ request.get_host }}{% url "fortune:zoo_main" %}',
                    },
                },
                buttons: [
                    {
                        title: 'ë‚˜ë„ ìŒ¤BTI í…ŒìŠ¤íŠ¸í•˜ê¸° ğŸ¦',
                        link: {
                            mobileWebUrl: 'https://{{ request.get_host }}{% url "fortune:zoo_main" %}',
                            webUrl: 'https://{{ request.get_host }}{% url "fortune:zoo_main" %}',
                        },
                    },
                ],
            });
        } catch (error) {
            console.error('âŒ Kakao share error:', error);
            alert('ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }
</script>