<div class="p-4 rounded-xl border border-indigo-200 bg-indigo-50 text-slate-700 text-sm"
     hx-on::after-settle="document.body.dispatchEvent(new Event('csvHistoryUpdated'));">
    <p class="font-bold text-indigo-700">{{ preview_title|default:"CSV 미리보기 완료" }}</p>
    {% if preview_source %}
    <p class="mt-1 text-xs text-indigo-700/90">입력 형식: {{ preview_source }}</p>
    {% endif %}
    <p class="mt-1">저장 예정 세트: {{ set_count }}개</p>
    <p class="mt-1 text-xs text-slate-600">내용이 맞으면 아래 <strong>문제 만들기</strong> 버튼을 눌러 실제 저장을 완료해 주세요.</p>

    <div class="mt-3 space-y-2 max-h-48 overflow-y-auto pr-1">
        {% for s in parsed_sets %}
        <div class="px-3 py-2 bg-white border border-indigo-100 rounded-lg">
            <div class="font-bold text-slate-800">업로드 세트 {{ forloop.counter }}</div>
            <div class="text-xs text-slate-500 mt-1">
                {% if s.grade == 0 %}학년무관{% else %}{{ s.grade }}학년{% endif %} · {{ s.preset_label|default:s.preset_type }} · {{ s.items|length }}문항
            </div>
        </div>
        {% endfor %}
    </div>

    <form class="mt-4"
          hx-post="{% url 'seed_quiz:htmx_csv_confirm' classroom_id=classroom.id %}"
          hx-target="#csv-upload-result"
          hx-swap="innerHTML">
        {% csrf_token %}
        <input type="hidden" name="preview_token" value="{{ preview_token }}">
        <div class="mt-3 flex gap-2">
            <button type="submit"
                    class="px-4 py-2 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg text-xs font-bold hover:shadow-md transition-all">
                문제 만들기
            </button>
        </div>
    </form>
</div>
