{% extends 'products/dutyticker/base_dutyticker.html' %}
{% load static %}

{% block content %}
<div class="min-h-screen p-10 transition-colors duration-500">
    <!-- Header -->
    <header class="flex justify-between items-end mb-12">
        <div class="space-y-2">
            <h1 class="text-6xl font-black tracking-tighter text-[var(--text-main)]"
                style="text-shadow: 4px 4px 8px rgba(163, 177, 198, 0.4);">DUTYTICKER</h1>
            <p class="text-2xl text-[var(--text-muted)] font-black uppercase tracking-[0.2em] ml-1">Classroom Status
                Board</p>
        </div>
        <div id="digitalClock" class="text-right clay-card px-10 py-6">
            <div class="text-5xl font-black tracking-tighter tabular-nums text-[var(--text-main)]" id="clockTime">
                00:00:00</div>
            <div class="text-lg text-[var(--text-muted)] font-black uppercase tracking-widest mt-1" id="clockDate">0000.
                0. 0. Day</div>
        </div>
    </header>

    <!-- Main Grid -->
    <main class="grid grid-cols-1 lg:grid-cols-12 gap-10 h-[calc(100vh-220px)]">
        <!-- Left Column: Current Role & Timer (7/12) -->
        <div class="lg:col-span-7 flex flex-col gap-6">
            <!-- Current Role Card Placeholder -->
            <div id="currentRoleContainer" class="flex-grow">
                {% include 'products/dutyticker/includes/role_card.html' %}
            </div>

            <!-- Timer Card Placeholder -->
            <div class="h-64">
                {% include 'products/dutyticker/includes/timer_card.html' %}
            </div>
        </div>

        <!-- Right Column: Timeline/List (5/12) -->
        <div class="lg:col-span-5 h-full overflow-hidden">
            {% include 'products/dutyticker/includes/timeline.html' %}
        </div>
    </main>

    <!-- Modals -->
    {% include 'products/dutyticker/includes/modals.html' %}

    <!-- Overlays -->
    <div id="alertOverlayContainer"></div>

    <!-- Floating Action Button -->
    <div class="fixed bottom-10 right-10 z-[100] flex flex-col gap-4 items-center">
        <!-- Admin Link -->
        <a href="{% url 'dashboard' %}"
            class="p-4 bg-[var(--bg-card)] text-[var(--text-muted)] hover:text-[var(--text-main)] rounded-full shadow-lg border border-[var(--border)] transition-colors"
            title="이전으로 돌아가기">
            <i class="fa-solid fa-arrow-left text-xl"></i>
        </a>

        <!-- Broadcast Button -->
        <button id="broadcastBtn"
            class="p-6 rounded-full shadow-2xl transition-all relative overflow-hidden bg-[var(--accent)] text-white hover:scale-105 active:scale-95"
            title="새 방송 알림">
            <div id="broadcastBtnSpin"
                class="absolute inset-0 border-4 border-white/20 rounded-full border-t-white hidden"></div>
            <div class="relative z-10">
                <i id="broadcastIcon" class="fa-solid fa-bullhorn text-4xl"></i>
            </div>
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'products/dutyticker/js/data.js' %}"></script>
<script src="{% static 'products/dutyticker/js/dutyticker.js' %}"></script>
<script>
    // Initialize Clock
    function updateClock() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('ko-KR', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '. ') + '. ' +
            ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'][now.getDay()];

        document.getElementById('clockTime').textContent = timeStr;
        document.getElementById('clockDate').textContent = dateStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Initialize Main App Logic (to be implemented in dutyticker.js)
    document.addEventListener('DOMContentLoaded', () => {
        window.dtApp = new DutyTickerManager();
        window.dtApp.init();
    });
</script>
{% endblock %}