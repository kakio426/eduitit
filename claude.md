## [Canonical Top Summary] 2026-02-17
- Declare UI scope before edits: global/app/page
- Declare `target_app` and `do_not_touch_apps` before edits
- Preserve stable service UI language by default
- Validate behavior parity first (routing, modal close, ESC, focus)
- If Korean text is corrupted: recover encoding/text first, then re-apply feature/style changes
- Run python manage.py check (and node --check for changed JS)
- For form pages: never hide required model fields without making them optional/defaulted, and always render form errors
- For JS confirmation UX (modal/step): keep a non-JS submit fallback so critical actions never become "no response"
- In dirty workspace, commit only request-scoped files after `git diff --cached` review
- Do not change global settings/flags unless explicitly requested

---

## [Canonical Body v2] 2026-02-17
이 문서는 현재 운영 기준의 우선 순위를 정의한다. 기존 본문과 충돌할 경우 본 섹션을 먼저 따른다.

### 1) UI 변경 원칙
- 변경 시작 전에 범위를 명시한다: `global` / `app-level` / `single-page`.
- 범위 외 변경(특히 공용 레이아웃/공용 스크립트)은 금지한다.
- 기존 서비스가 정상 동작하면 시각 통일보다 동작 안정성을 우선한다.

### 2) 한국어 깨짐 사고 원인 분석 (2026-02-17)
- 직접 원인:
  - Windows 터미널 표시 인코딩과 실제 파일 인코딩이 불일치한 상태에서 수정 반복
  - 한글 포함 파일을 넓은 범위 치환/재저장하면서 일부 블록이 재인코딩됨
- 구조적 원인:
  - 기능 수정과 텍스트 정규화를 분리하지 않고 동시에 진행
  - 문서 기준(우선 규칙)이 분산되어 작업자가 즉시 참조하기 어려움
- 재발 방지:
  - 한글 이상 징후 발견 시 기능 수정 중단 -> 텍스트 복구 -> 기능 재적용 순서 고정
  - 대량 치환보다 `apply_patch` 기반의 국소 수정 우선
  - 정책 변경 시 `claude.md`, `SERVICE_INTEGRATION_STANDARD.md`, `codex/SKILL.md` 동시 반영

### 3) 서비스 진화 시 점검 체크리스트
- 기존 핵심 플로우 회귀 점검:
  - 대시보드 진입
  - 모달 열기/닫기(배경 클릭, ESC)
  - 서비스 라우팅
- 신규 기능은 "기능 정확성 -> 사용성 -> 시각 개선" 순서로 적용한다.
- 삭제가 필요한 변경은 사용자 승인 후에만 수행한다.

### 4) 폼/모달 안정성 가드레일 (2026-02-18)
- ModelForm에 포함된 필드를 템플릿에서 숨길 경우:
  - 필드를 `required=False`로 두고 서버 기본값/`clean_*` 정규화를 함께 둔다.
  - 또는 템플릿에 해당 입력 필드를 명시적으로 노출한다.
- POST 폼은 유효성 실패 시 사용자에게 오류를 반드시 노출한다 (`form.errors`, `non_field_errors`).
- 확인 모달/2단계 UX를 쓰더라도 최종 실행은 서버 제출 기반으로 유지한다.
- JS 확인 UX에는 `noscript` 또는 직접 제출 폴백을 반드시 제공한다.
- 모바일 실기기 최소 QA:
  - 제출 버튼 탭 후 실제 데이터 생성/수정 반영 확인
  - 유효성 실패 시 오류 메시지 노출 확인

### 5) 신규 서비스 추가 가드레일 (2026-02-18)
- 라우팅 SSOT를 먼저 정한다. 가능하면 `title` 문자열 분기 대신 명시적 route 필드를 사용한다.
- 당장 `title` 분기를 유지해야 한다면, 최소 2곳을 동시 반영한다:
  - `core/views.py` (`_resolve_product_launch_url`)
  - `products/templates/products/partials/preview_modal.html` 시작하기 링크 분기
- 대화면 전용 서비스는 phone 차단 정책을 사용하되, 다음 2가지를 반드시 제공한다:
  - 롤백 플래그 (`ALLOW_TABLET_ACCESS`)
  - 사용자 우회 경로 (`force_desktop=1`, 안내문 포함)
- 기능 플래그는 목적별로 분리한다. 검색/IA 같은 공통 기능을 `HOME_V2_ENABLED` 같은 화면 플래그에 묶지 않는다.
- 모바일/태블릿에서 핵심 액션은 hover 의존 금지. 터치 상태에서 항상 보이거나 명시적 더보기 메뉴를 둔다.
- 신규 서비스는 등록과 동시에 검색/탐색에 노출 가능해야 한다 (`search_products_json`, 카테고리/설명 필드 확인).
- 테스트 게이트를 통과해야 머지한다:
  - 서비스 진입 라우팅
  - 모달 열기/닫기
  - phone/iPad/desktop 정책
  - 플래그 ON/OFF 시 기대 동작
- 문서 동기화는 같은 커밋에서 처리한다:
  - `CLAUDE.md`
  - `codex/SKILL.md`
  - 필요 시 `docs/plans/PLAN_must_fix_only.md`

### 6) Target Service Lock (2026-02-18)
- 작업 시작 전에 아래를 먼저 선언한다:
  - `target_app`: 이번 작업 대상 앱
  - `do_not_touch_apps`: 이번 작업에서 건드리면 안 되는 앱 목록
- 선언 범위 밖 파일 수정이 감지되면 즉시 중단하고 범위 재확인 후 진행한다.
- 공용 파일(`settings`, `base`, 공통 템플릿) 수정은 "요청 명시"가 있는 경우에만 허용한다.

### 7) 서비스 제거 표준 절차 (2026-02-18)
- 서비스 제거는 아래 순서를 강제한다:
  1. 라우팅 제거 (`urls`)
  2. 앱 등록 제거 (`INSTALLED_APPS`)
  3. 제품/매뉴얼 데이터 제거 (마이그레이션 `RunPython`)
  4. 설정/가이드/설명 흔적 제거
  5. 상태 검증 (`/service-path -> 404`, 관련 헬스체크 통과)
- 데이터 제거는 셸 수작업 대신 마이그레이션으로 남긴다.

### 8) AI Provider Switch Protocol (2026-02-18)
- Gemini/DeepSeek 전환 시 동시 점검 대상:
  - 서버 키 소스(`MASTER_*`, fallback 포함)
  - 사용자 메시지(한도/설정 안내 문구)
  - 설정 화면의 키 입력/가이드 문구
  - 관련 테스트(기본 진입/오류 코드/미설정 처리)
- 제공자 전환 중에는 요청되지 않은 다른 서비스의 AI 경로를 변경하지 않는다.

### 9) Dirty Workspace Commit Guard (2026-02-18)
- 작업트리가 더러우면 선택 커밋만 허용한다:
  - `git add <요청 범위 파일들>`
  - `git diff --cached --name-only`
  - `git diff --cached`
- 위 검토 없이 전체 커밋/푸시 금지.
- 커밋 보고 시 포함/제외 파일을 명시한다.

---
## [Legacy Reference Notice]
- 아래 본문은 과거 운영/분석 기록(레거시)이며 일부 텍스트 깨짐이 포함될 수 있다.
- 실제 작업 기준은 상단 `Canonical Top Summary`, `Canonical Body v2`를 우선 적용한다.
- 레거시 본문은 삭제하지 않고 보존한다.

# Eduitit ?꾨줈?앺듃 - Claude Code ?ㅼ젙

## 媛쒖씤 ?뺣낫
- ?대쫫: ?좊퀝二?(Byungju Yu)
- GitHub: yb941213
- ?뚯궗: SCHOOL

## 湲곗닠 ?ㅽ깮
| ?곸뿭 | 湲곗닠 |
|------|------|
| Backend | Django (Python 3.10+), Django Template Language |
| Frontend | Vanilla JS, Alpine.js, HTMX, Tailwind CSS |
| Infra | Railway, Neon PostgreSQL, Cloudinary |
| Monitoring | Sentry (production only) |

## 肄붾뵫 洹쒖튃
- ?쒓뎅?대줈 二쇱꽍怨?而ㅻ컠 硫붿떆吏 ?묒꽦
- Django ?쒖? 以?? 紐낇솗??URL ?ㅼ씠諛? Service Layer/Utils ?쒖슜
- Frontend: Alpine.js + HTMX ?곗꽑, 媛蹂띻퀬 鍮좊Ⅸ 諛섏쓳??- CSS: Tailwind CSS ?대옒???곗꽑 (而ㅼ뒪? CSS 理쒖냼??
- 而ㅻ컠 ?뺤떇: `[??? ?쒕ぉ` (feat, fix, docs, style, refactor, test, chore)

## 湲덉? ?ы빆
- Production settings 吏곸젒 ?섏젙 湲덉? (settings_production.py???좎쨷??
- `.env` ?뚯씪?대굹 誘쇨컧???뺣낫 而ㅻ컠 湲덉?
- ?섎뱶肄붾뵫??API ???ъ슜 湲덉?
- UI ?ㅻ쾭??NavBar 媛由? 諛⑹튂 湲덉? ??紐⑤뱺 ?섏씠吏 `pt-32` 以??- `ensure_*` management command?먯꽌 ?곗씠??以묐났 ?앹꽦 諛?Admin 愿由??곗씠????뼱?곌린 湲덉? ??`Procfile`??留?諛고룷留덈떎 ?ㅽ뻾?섎?濡?Admin ?섏젙??珥덇린?붾릺嫄곕굹 ?곗씠?곌? 以묐났??- **[Manual]** ?좉퇋 ?쒕퉬??異붽? ??`ServiceManual` ?묒꽦 ?꾨씫 湲덉?. ?띿꽦??3媛??댁긽 ?뱀뀡) ?ъ슜踰뺤씠 ?녿뒗 ?쒕퉬?ㅻ뒗 諛고룷 遺덇?.

## ?묒뾽 ?꾨즺 ??泥댄겕由ъ뒪??- [ ] Django Check ?듦낵 (`python manage.py check`)
- [ ] console.log 諛?debug print ?쒓굅
- [ ] **[Manual]** ?쒕퉬??留ㅻ돱??`ServiceManual`) ?곗씠??諛??덉씠?꾩썐(Rich Content) ?ы븿 ?щ? ?뺤씤
- [ ] 蹂댁븞 寃??(API ?? ?쒗겕由??몄텧 ?щ?)
- [ ] settings.py 蹂寃???settings_production.py???숆린??
---

# ?듭떖 ?꾪궎?띿쿂

## ?쒕퉬???명봽??援ъ“

| 湲곕뒫 | ?뚯씪 | 鍮꾧퀬 |
|------|------|------|
| Toast ?뚮┝ | `core/context_processors.py` ??`toast_messages()` | Django messages + Alpine.js |
| 湲濡쒕쾶 諛곕꼫 | `core/models.py` ??`SiteConfig` (?깃??? | Admin?먯꽌 愿由?|
| SEO 硫뷀??쒓렇 | `core/context_processors.py` ??`seo_meta()` | view context濡?override 媛??|
| ?쇰뱶諛??꾩젽 | `core/models.py` ??`Feedback`, `/feedback/` | HTMX + ?뚮줈??踰꾪듉 |
| 愿由ъ옄 ??쒕낫??| `/admin-dashboard/` | superuser ?꾩슜, 遊??щ엺 援щ텇 |
| DB 諛깆뾽 | `python manage.py backup_db` | dumpdata JSON, Cron 媛??|

**context_processors ?깅줉 ?쒖꽌** (??settings ?뚯씪 紐⑤몢 ?숈씪?댁빞 ??:
```python
'core.context_processors.visitor_counts',
'core.context_processors.toast_messages',
'core.context_processors.site_config',
'core.context_processors.seo_meta',
```

**VisitorLog 紐⑤뜽**: `user_agent`, `is_bot` ?꾨뱶 蹂댁쑀. `get_visitor_stats(days, exclude_bots=True)`濡??꾪꽣留?

## 2. 臾몄꽌 愿由?UI ?⑦꽩 (Mobile-First)

**紐⑸줉 ?붾㈃**: ?곗뒪?ы넲? `<table>`, 紐⑤컮?쇱? `Card Grid`
- **援ы쁽**: `hidden md:block` (?곗뒪?ы넲) / `md:hidden` (紐⑤컮?? ?대옒?ㅻ줈 遺꾧린
- **?꾪꽣**: 紐⑤컮?쇱뿉?쒕뒗 ?몃줈 ?ㅽ깮(`flex-col`), ?곗뒪?ы넲?먯꽌??媛濡?諛곗튂(`flex-row`)

**?곸꽭 ?붾㈃**:
- **紐⑤컮??*: Alpine.js ??UI (`x-data="{ tab: 'history' }"`)
  - ?? [?덉뒪?좊━] [?낅줈?? [?ㅼ젙]
  - ?ㅽ겕濡?理쒖냼??諛?肄섑뀗痢?遺꾨━
- **?곗뒪?ы넲**: 2??而щ읆 ?덉씠?꾩썐 (?ъ씠?쒕컮 + 硫붿씤)
  - ???놁씠 ???붾㈃???쒖떆 (`lg:grid-cols-3`)

**?낅젰 ??*:
- **Touch Target**: 紐⑤컮?쇱뿉??`py-3.5`, `text-base` ?댁긽 ?뺣낫
- **Full Width**: 踰꾪듉 諛?二쇱슂 ?낅젰李쎌? 紐⑤컮?쇱뿉??`w-full`

## UI ?덉씠?꾩썐 ?쒖?

NavBar媛 `fixed` ?ъ??섏씠誘濡?紐⑤뱺 ?섏씠吏?먯꽌 ?곷떒 ?щ갚 ?뺣낫 ?꾩닔.

```html
<!-- ?쒖? ?섏씠吏 援ъ“ -->
{% block content %}
<section class="pt-32 pb-20 px-4 min-h-screen">
    <div class="max-w-7xl mx-auto">
        <!-- 肄섑뀗痢?-->
    </div>
</section>
{% endblock %}
```

- **?쒖?**: `pt-32` (128px) - 紐⑤뱺 ?섏씠吏
- **理쒖냼**: `pt-24` (Banner ?놁쓣 ??
- ?꾩껜 ?붾㈃ 紐⑤뱶 ??`z-index: 50+` ?꾩슂

### 諛섏쓳??釉뚮젅?댄겕?ъ씤??(Tailwind 湲곕낯媛?
| ?묐몢??| 理쒖냼 ?덈퉬 | ?⑸룄 |
|--------|----------|------|
| (?놁쓬) | 0px | 紐⑤컮??湲곕낯 |
| `sm:` | 640px | ??紐⑤컮???뚰삎 ?쒕툝由?|
| `md:` | 768px | ?쒕툝由?|
| `lg:` | 1024px | ?곗뒪?ы넲 (SNS ?ъ씠?쒕컮 ?쒖떆 湲곗?) |
| `xl:` | 1280px | ?볦? ?곗뒪?ы넲 |

---

# 諛섎났 ?ㅼ닔 諛⑹? 洹쒖튃

## 1. Django ?ㅼ젙 ?뚯씪 ?숆린??(CRITICAL)

濡쒖뺄(`settings.py`)怨??꾨줈?뺤뀡(`settings_production.py`)? 諛섎뱶???숆린??

**?뱁엳 二쇱쓽???ㅼ젙**: `MIDDLEWARE`, `INSTALLED_APPS`, `TEMPLATES > context_processors`, `LOGGING`

```bash
diff config/settings.py config/settings_production.py
```

> **?щ? (2026-02-02)**: 諛⑸Ц??移댁슫?곌? 怨꾩냽 0紐? 肄붾뱶???뺤긽?댁뿀?쇰굹 `settings_production.py`??誘몃뱾?⑥뼱/context processor ?꾨씫???먯씤.

## 2. Django views.py ?꾩닔 泥댄겕

500 ?먮윭??3? ?먯씤:

1. **`from django.conf import settings` import ?꾨씫** ??`NameError`
2. **?곸닔瑜??⑥닔蹂대떎 ?꾨옒???뺤쓽** ??`NameError` (?곸닔???뚯씪 ?곷떒??
3. **view ?⑥닔?먯꽌 `return` 臾??꾨씫** ??`None` 諛섑솚 ??500 ?먮윭

> **?щ? (ssambti ??**: ??3媛吏媛 ?숈떆 諛쒖깮. import 異붽? + ?⑥닔 ?쒖꽌 ?щ같移?+ return 臾?異붽?濡??닿껐.

> **?щ? (2026-02-09, fortune ??**: `has_personal_api_key`瑜?`fortune/views.py`?먯꽌 import ?놁씠 `@ratelimit` 肄쒕갚(`fortune_rate_h`, `fortune_rate_d`)?먯꽌 ?ъ슜 ???쇰컲 ?좎? ?붿껌 ??`NameError` ??500 ?먮윭. **superuser??`or` ?⑥텞 ?됯?濡??대떦 ?⑥닔媛 ?몄텧?섏? ?딆븘 ?ы쁽 遺덇?**?덉쓬. 援먰썕: ?곗퐫?덉씠??肄쒕갚 ?덉쓽 import ?꾨씫? ?뱀젙 議곌굔?먯꽌留??곗?誘濡? 肄붾뱶 ?묒꽦 ??**紐⑤뱺 ?⑥닔 李몄“??import ?щ?瑜?諛섎뱶???뺤씤**??寃?

## 3. Railway 諛고룷 ?섍꼍 ?쒖빟

- **`pg_dump` ?놁쓬** ??`dumpdata` JSON 諛깆뾽 ?ъ슜 (`core/management/commands/backup_db.py`)
- **Neon PostgreSQL = PgBouncer** ??`DISABLE_SERVER_SIDE_CURSORS = True` ?ㅼ젙 ?꾩슂
- **Cron Job = 蹂꾨룄 而⑦뀒?대꼫** ??`raise` ???`sys.exit(0/1)` ?ъ슜
- **?⑦궎吏 異붽? ??*: `requirements.txt` 利됱떆 諛섏쁺, ?쒖뒪??諛붿씠?덈━ ?섏〈???뺤씤 ??`nixpacks.toml`??異붽?

## 4. select_related? ?좏깮??愿怨?
```python
# ??UserProfile???녿뒗 User媛 ?덉쑝硫??먮윭
.select_related('author__userprofile')

# ???꾩닔 愿怨꾨쭔 select_related
.select_related('author')
# ?좏깮??愿怨꾨뒗 ?쒗뵆由우뿉?? {% if post.author.userprofile %}
```

> **?щ? (2026-02-04)**: ?꾨줈?뺤뀡?먯꽌 UserProfile ?녿뒗 User 議댁옱 ??500 ?먮윭. 濡쒖뺄?먯꽌???ы쁽 ????

## 5. Alpine.js `<template x-if>` ?덉뿉 HTMX ?ｌ? ?딄린

`<template x-if>`??議곌굔???곕씪 DOM???꾩쟾???쒓굅/異붽??섎?濡? 洹??덉쓽 HTMX ?띿꽦(`hx-trigger`, `hx-get` ?????쒕?濡?珥덇린?붾릺吏 ?딆쓣 ???덈떎.

```html
<!-- ??HTMX ?대쭅???묐룞?섏? ?딆쓬 -->
<template x-if="showFullscreen">
    <div hx-get="/api/data/" hx-trigger="every 5s">...</div>
</template>

<!-- ??HTMX瑜?template 諛뽰뿉 ?먭린 -->
<div x-show="showFullscreen">
    <div hx-get="/api/data/" hx-trigger="every 5s">...</div>
</div>
```

> **?щ? (2026-02-08)**: studentmbti ?몄뀡 ?곸꽭 ?섏씠吏?먯꽌 ?꾩껜?붾㈃ 紐⑤뱶???ㅼ떆媛??숈깮 紐⑸줉????긽 0紐낆쑝濡??쒖떆. `<template x-if>` ?덉쓽 HTMX ?대쭅???묐룞?섏? ?딆븯??

## 6. JSON ?뚯떛 ??HTML ?먮윭 ?섏씠吏 媛먯?

Django媛 ?먮윭瑜?諛섑솚????JSON ???HTML ?먮윭 ?섏씠吏瑜?蹂대궪 ???덈떎. `JSON.parse()`??HTML???섍린硫?`Unexpected token '<'` ?먮윭 諛쒖깮.

```javascript
// ???꾪뿕: HTML ?먮윭 ?섏씠吏 ?뚯떛 ???щ옒??const data = JSON.parse(element.textContent);

// ???덉쟾: HTML 媛먯? 諛?fallback
function safeJSONParse(text, fallback = null) {
    if (!text) return fallback;
    const trimmed = text.trim();
    
    // HTML ?먮윭 ?섏씠吏 媛먯?
    if (trimmed.startsWith('<')) {
        console.error("HTML detected instead of JSON");
        return fallback;
    }
    
    try {
        return JSON.parse(trimmed);
    } catch (e) {
        console.error("JSON parse error:", e);
        return fallback;
    }
}

// ?ъ슜
const data = safeJSONParse(element.textContent, {});
```

**Django ?쒗뵆由우뿉??JSON ?꾨떖 ??二쇱쓽?ы빆**:
```django
{# ??json_script ?꾪꽣 ?ъ슜 #}
{{ chart|json_script:"chart-data" }}

{# ??View?먯꽌 chart媛 None?????덉쑝誘濡???긽 ?앹꽦 #}
chart_data = {...} if chart_context else None
```

> **?щ? (2026-02-08)**: Fortune ?깆뿉??罹먯떛???ъ＜ 寃곌낵 遺덈윭?????쇱쭊 ?뺤씤 ??`Unexpected token '<'` ?먮윭. ?먯씤: 罹먯떛 ??`chart` ?곗씠?곌? ?ъ깮?깅릺吏 ?딆븘 ?쒗뵆由우뿉??`None` ??`json_script`媛 鍮?媛??앹꽦 ??JavaScript?먯꽌 ?뚯떛 ?ㅽ뙣. ?닿껐: (1) View?먯꽌 罹먯떛 ?щ?? 愿怨꾩뾾??`chart_data` ??긽 ?앹꽦, (2) 紐⑤뱺 `JSON.parse()` ??`safeJSONParse()`濡?援먯껜.

## 7. 珥덈벑?숈깮 ???肄섑뀗痢??댄쐶 ?섏?

?숈깮?먭쾶 蹂댁뿬吏???띿뒪?몄뿉???ㅼ쓬怨?媛숈? ?대젮???⑥뼱 ?ъ슜 湲덉?:
- **?쒖옄???꾨Ц?⑹뼱**: ?ъ깋媛, ?듭같?? ?좎씪臾댁씠, 議곕쭩, ?곸옱?곸냼, 移대━?ㅻ쭏, 鍮꾩쟾, 蹂몃뒫?? ?꾨왂?? ?⑥쑉?? ??궛
- **?꾩떎怨?留욎? ?딅뒗 ?쒗쁽**: 湲곕쭚怨좎궗(?쒗뿕??蹂댁? ?딅뒗 ?숆탳媛 留롮쓬)
- **?泥?諛⑹떇**: ?ъ슫 ?곕━留먮줈 ??댁벐湲?(議곕쭩?믫븳?덉뿉 蹂닿린, ?곸옱?곸냼?믩뵳 留욌뒗 ?쒓컙, ??궛?믨굅袁몃줈 怨꾩궛)

> **?щ? (2026-02-08)**: studentmbti 寃곌낵吏?먯꽌 珥덈벑?숈깮???댄빐?섍린 ?대젮???⑥뼱 ?ㅼ닔 諛쒓껄. 12媛??댁긽???댄쐶 ?쒗솕 ?묒뾽 吏꾪뻾.

## 8. SNS Sidebar ?듯빀 ?⑦꽩

?ㅻⅨ ?쒕퉬?ㅼ뿉 SNS sidebar 異붽? ??

**?쒗뵆由?*: `max-w-7xl` ?몃? 而⑦뀒?대꼫 ??`flex flex-col lg:flex-row gap-6 items-start` ??硫붿씤(`flex-1 lg:max-w-3xl`) + ?ъ씠?쒕컮(`hidden lg:block w-[380px] flex-shrink-0`)

**酉?*: `from core.models import Post` import ??`select_related('author')` + `prefetch_related('comments__author', 'likes')` + `annotate(like_count, comment_count)` ??context??`'posts': posts` ?꾨떖

---

# ?깅퀎 ?댁뒋 遺꾩꽍 湲곕줉

## Fortune ??- 500 ?먮윭 遺꾩꽍 (2026-02-04)

### CRITICAL

**1. chart_context None ?묎렐 (鍮덈룄: 40-50%)**
- ?꾩튂: `fortune/views.py:279-282, 389`
- ?먯씤: ?뺤뀛?덈━ ?앹꽦???쇳빆 ?곗궛??`if chart_context`) 泥댄겕蹂대떎 癒쇱? ?됯???- ?섏젙: `if chart_context is not None else None` ?쇰줈 紐낆떆??泥댄겕
```python
# ??dict ?앹꽦??癒쇱? ?됯? ??TypeError
'chart': { chart_context['year']... } if chart_context else None

# ??None 泥댄겕瑜?癒쇱?
if chart_context is not None:
    chart = { ... }
else:
    chart = None
```

**2. ?곗씠??援ъ“ 遺덉씪移?(鍮덈룄: 30-40%)**
- ?꾩튂: `fortune/views.py:206`, `fortune/utils/caching.py:21`
- `get_chart_context()` 諛섑솚媛믨낵 `get_natal_hash()` 湲곕?媛믪씠 ?ㅻⅨ 援ъ“
- 罹먯떆 誘몄뒪, DB ?ㅼ뿼, 以묐났 諛⑹? ?ㅽ뙣 ?좊컻

### HIGH

**3. ?낅젰 寃利??꾨씫 (鍮덈룄: 3-5%)**
- ?꾩튂: `fortune/views.py:152-172`
- ?좎쭨 踰붿쐞 泥댄겕 ?놁쓬 (month 13 ?? ??`ValueError` ??`None` 諛섑솚 ???곗뇙 ?먮윭

**4. API ?먮윭 ?몃뱾留?遺??(鍮덈룄: 5-10%)**
- API ???꾨씫 ??generic exception, 鍮?AI ?묐떟 誘몄쿂由? 503 誘몄쟾?? 臾몄옄???뚯떛 ?섏〈

### MEDIUM

**5. ?쒗뵆由?援щЦ ?먮윭** - `saju_form.html:1319` if/endif 吏?遺덉씪移?**6. 以묐났 ?⑥닔 ?뺤쓽** - `caching.py`??`get_user_context_hash()`, `get_cached_daily_fortune()` 2踰덉뵫 ?뺤쓽
**7. AI ??꾩븘??鍮??묐떟** - ??꾩븘???놁쓬, 鍮??묐떟???좏슚 寃곌낵濡????
### ?먮윭 ?⑦꽩 鍮좊Ⅸ 李몄“

| ?먮윭 | ?꾩튂 | ?먯씤 | ?섏젙 |
|------|------|------|------|
| `TypeError: 'NoneType' not subscriptable` | views.py:279,389 | chart_context None?몃뜲 dict ?묎렐 | None 泥댄겕 ?좏뻾 |
| 鍮?natal_hash ??罹먯떆 誘몄뒪 | views.py:206, caching.py:21 | ?곗씠??援ъ“ 遺덉씪移?| 援ъ“ ?쒖???|
| `ValueError` from invalid date | views.py:156-170 | ?좎쭨 寃利??놁쓬 | 踰붿쐞 寃利?異붽? |
| Generic 500 from AI failure | views.py:395-406 | ?먮윭 ?몃뱾留?遺??| ??낅퀎 ?덉쇅 泥섎━ |

### ?섏젙 ?곗꽑?쒖쐞
1. chart_context null 泥댄겕 ??2. ?곗씠??援ъ“ ?쒖?????3. ?쒗뵆由?援щЦ ??4. ?낅젰 寃利???5. ?먮윭 ?꾪뙆 ??6. 以묐났 ?⑥닔 ?쒓굅 ??7. ??꾩븘??
### 愿???뚯씪
- `fortune/views.py` (779以? - chart_context 踰꾧렇
- `fortune/utils/caching.py` (246以? - 以묐났/援ъ“ 遺덉씪移?- `fortune/api_views.py` (222以? - API ?붾뱶?ъ씤??- `fortune/templates/fortune/saju_form.html` (2788以? - ?쒗뵆由?援щЦ ?먮윭
- `fortune/models.py` (266以?

---

## Fortune ??- ?꾨＼?꾪듃/罹먯떆/UI ?댁뒋 (2026-02-08)

### 9. AI ?꾨＼?꾪듃 SSOT 吏?쒖뿉??諛섎뱶??蹂쇰뱶 ?좎?

?꾨＼?꾪듃 ?ㅼ쓣 遺?쒕읇寃?諛붽씀?붾씪?? **SSOT ?뺤껜??洹쒖튃?먮뒗 `**蹂쇰뱶**`瑜??좎?**?댁빞 AI媛 媛뺥븯寃??곕Ⅸ??

```
# ??蹂쇰뱶 ?쒓굅 ??AI媛 ?쇨컙 ?ㅽ뻾??臾댁떆?섍퀬 ?됰슧??鍮꾩쑀 ?ъ슜
?좎깮?섏쓽 ?뺤껜?깆? 諛섎뱶???곷떒 [SSOT Data]??'Day' 泥?湲?먯엯?덈떎.

# ??蹂쇰뱶 ?좎? ??AI媛 ?뺥솗???쇨컙 湲곗??쇰줈 ?댁꽍
**?뺤껜??怨좎젙**: ?좎깮?섏쓽 ?뺤껜?깆? 諛섎뱶??**[SSOT Data]???쇱＜(Day) 泥?湲??泥쒓컙)**?낅땲??
```

?먰븳 異쒕젰 ?쒗뵆由우뿉??"?먯뿰臾?鍮꾩쑀"?쇨퀬留??곕㈃ AI媛 ?꾨Т ?먯뿰臾쇱씠??留ㅼ묶?쒕떎. **"?쇨컙 ?ㅽ뻾??留욌뒗 ?먯뿰臾?**?대씪怨??쒖빟??嫄몄뼱????

> **?щ?**: ?좉툑(渦쏃뇫)?몃뜲 "留묒? ?섎Ъ"濡?臾섏궗 ??異쒕젰 ?쒗뵆由우뿉 "?쇨컙 ?ㅽ뻾??留욌뒗" ?쒖빟??鍮좎죱湲??뚮Ц. ?ㅽ뻾-?먯뿰臾?留ㅽ븨(`湲?蹂댁꽍/?? ??臾?鍮?)??紐낆떆?섏뿬 ?닿껐.

### 10. detail.html `const` ?ы븷???щ옒??(留덊겕?ㅼ슫 誘몃젋?붾쭅)

```javascript
// ??const 蹂?섏뿉 ?ы븷????TypeError ??留덊겕?ㅼ슫 ?뚮뜑留??꾩껜 ?ㅽ뙣
const rawText = outputArea.innerText;
rawText = rawText.replace(...);  // try/catch 諛뽰씠???щ옒??
// ??escapejs濡??쒖닔 臾몄옄???꾨떖 (saju_form.html怨??숈씪 諛⑹떇)
const rawMarkdown = "{{ item.result_text|escapejs }}";
marked.parse(rawMarkdown);
```

> **?щ?**: 蹂닿????곸꽭 ?섏씠吏?먯꽌 留덊겕?ㅼ슫??raw ?띿뒪?몃줈 蹂댁엫. `const` ?ы븷???먮윭媛 `try/catch` 諛뽰뿉??諛쒖깮?섏뿬 ?ㅽ겕由쏀듃 ?꾩껜 以묐떒.

### 11. 蹂닿?????젣 ??localStorage 罹먯떆 ?숆린???꾩닔

DB?먯꽌 `FortuneResult`瑜???젣?대룄 釉뚮씪?곗? `localStorage`???ъ＜ 罹먯떆???⑥븘?덉뼱?? 媛숈? 議곌굔?쇰줈 遺꾩꽍?섎㈃ ??寃곌낵媛 諛섑솚?쒕떎.

**??젣 ???④퍡 ?쒓굅?댁빞 ??罹먯떆 ???⑦꽩**:
- `saju_result_cache_*`, `saju_result_v2_*`
- `daily_saju_cache_*`, `daily_saju_v2_*`
- `pendingSajuResult`, `lastSajuInput`

> **?щ?**: ?꾨＼?꾪듃瑜?媛쒖꽑?덈뒗??罹먯떆????寃곌낵留?怨꾩냽 ?쒖떆?? 蹂닿?????젣 ??localStorage 罹먯떆???④퍡 ??젣?섎룄濡??섏젙.

### 12. AI ?꾨＼?꾪듃?먯꽌 "?쒕ぉ ?곗? 留덉꽭?? 吏?쒕뒗 `## ` ?ㅻ뜑源뚯? ?앸왂?쒗궡

?꾨＼?꾪듃??"蹂꾨룄 ?쒕ぉ? ?곗? 留덉꽭???쇨퀬 ?곕㈃ AI媛 異쒕젰 ?쒗뵆由우쓽 `## ` ?뱀뀡 ?ㅻ뜑源뚯? 紐⑤몢 ?앸왂?쒕떎. ?쒕줎留?湲덉??섍퀬 ?띠쑝硫?紐낇솗??遺꾨━?댁빞 ??

```
# ??AI媛 ## ?ㅻ뜑瑜?紐⑤몢 ?앸왂 ??寃곌낵 湲??以묎컙 ?쒕ぉ ?놁쓬
?쒕줎?대굹 蹂꾨룄 ?쒕ぉ? ?곗? 留덉꽭??

# ???쒕줎留?湲덉?, ?뱀뀡 ?ㅻ뜑???꾩닔濡?吏???쒕줎???곗? 留덉꽭?? 媛??뱀뀡? 諛섎뱶???꾨옒 異쒕젰 ?쒗뵆由우쓽 `## ` ?쒕ぉ??洹몃?濡??ы븿?섏꽭??
```

> **?щ? (2026-02-08)**: ?쇰컲?ъ＜ 寃곌낵???듭떖 ?붿빟, ?먭뎅 遺꾩꽍, 湲곗쭏/?깃꺽 ??以묎컙 ?쒕ぉ???꾪? ?쒖떆?섏? ?딆쓬. "蹂꾨룄 ?쒕ぉ? ?곗? 留덉꽭?? 吏?쒓? ?먯씤.

### 13. JS `element.className = ...` ?꾩껜 援먯껜 ???덉씠?꾩썐 ?대옒???좎떎

`className`???듭㎏濡?援먯껜?섎㈃ ?먮옒 HTML???덈뜕 `inline-flex`, `items-center`, `gap-1` ???덉씠?꾩썐 ?대옒?ㅺ? ?щ씪吏꾨떎. `classList.add/remove`瑜??곌굅?? ?꾩껜 援먯껜 ???덉씠?꾩썐 ?대옒?ㅻ? 諛섎뱶???ы븿?댁빞 ??

```javascript
// ???덉씠?꾩썐 ?대옒???좎떎 ???띿뒪??以묒븰 ?뺣젹 源⑥쭚
badge.className = `text-sm py-1 px-3 rounded-full ${colorClass}`;

// ???덉씠?꾩썐 ?대옒???ы븿
badge.className = `inline-flex items-center justify-center gap-1 text-sm py-1 px-3 rounded-full ${colorClass}`;
```

> **?щ? (2026-02-08)**: ?좉툑(渦쏃뇫) 諛곗? ?띿뒪?멸? 以묒븰 ?뺣젹?섏? ?딆쓬. JS?먯꽌 `badge.className`??援먯껜?섎㈃??`items-center`, `gap-1` ?깆씠 鍮좎쭊 寃껋씠 ?먯씤.

### 14. Django Admin N+1 荑쇰━ ????紐⑤뜽 異붽? ??諛섎뱶??泥댄겕

`ModelAdmin`?먯꽌 `list_display`??FK ?꾨뱶??`.count()` 硫붿꽌?쒕? ?ｌ쑝硫??됰쭏??荑쇰━媛 諛쒖깮?쒕떎.

```python
# ??list_display??FK ?꾨뱶 ???됰쭏??SELECT
list_display = ['user', 'product', 'created_at']
# 寃곌낵: N+1 荑쇰━ (100?됱씠硫?200+ 荑쇰━)

# ??get_queryset??select_related 異붽?
def get_queryset(self, request):
    return super().get_queryset(request).select_related('user', 'product')
```

```python
# ??.count() 硫붿꽌?????됰쭏??COUNT 荑쇰━
def like_count(self, obj):
    return obj.likes.count()

# ??annotate濡??⑥씪 荑쇰━ 吏묎퀎 + admin_order_field濡??뺣젹 吏??def get_queryset(self, request):
    return super().get_queryset(request).annotate(
        _like_count=Count('likes', distinct=True)
    )

def like_count_display(self, obj):
    return obj._like_count
like_count_display.admin_order_field = '_like_count'
```

**????紐⑤뜽 異붽? ??泥댄겕由ъ뒪??*:
- [ ] `list_display`??FK ?꾨뱶媛 ?덉쑝硫???`get_queryset`??`select_related` 異붽?
- [ ] `list_display`??`.count()` 硫붿꽌?쒓? ?덉쑝硫???`annotate` + `_display` 硫붿꽌?쒕줈 援먯껜
- [ ] User FK?먮뒗 `raw_id_fields` ?ъ슜 (?쒕∼?ㅼ슫 ???ID ?낅젰)
- [ ] 洹쒖튃 4踰?二쇱쓽: `author__userprofile` 媛숈? ?좏깮??愿怨꾨뒗 `select_related` 湲덉?

> **?щ? (2026-02-08)**: 10媛??깆쓽 admin??select_related/annotate ?쇨큵 ?곸슜. Fortune ??11媛?紐⑤뜽 ?좉퇋 ?깅줉 ?쒖뿉???숈씪 ?⑦꽩 ?곸슜.

### 愿???뚯씪
- `fortune/prompts.py` - AI ?꾨＼?꾪듃 (?먮낯: `prompts_backup.py`)
- `fortune/templates/fortune/detail.html` - 蹂닿????곸꽭 (留덊겕?ㅼ슫 ?뚮뜑留? ?대?吏 ???
- `fortune/templates/fortune/history.html` - 蹂닿???紐⑸줉 (??젣 + 罹먯떆)
- `fortune/templates/fortune/saju_form.html` - ?ъ＜ ?낅젰/寃곌낵 ?붾㈃

---

## SNS Sidebar ?듯빀 ?곸꽭 媛?대뱶 (2026-02-04)

### ?щ컮瑜??덉씠?꾩썐 援ъ“

```html
{% block content %}
<section class="pt-32 pb-20 px-6 min-h-screen bg-[#E0E5EC]">
    <div class="max-w-7xl mx-auto">
        <div class="flex flex-col lg:flex-row gap-6 items-start">
            <!-- 硫붿씤 肄섑뀗痢?-->
            <div class="flex-1 w-full lg:max-w-3xl">
                {{ 硫붿씤 肄섑뀗痢?}}
            </div>
            <!-- SNS ?ъ씠?쒕컮 (?곗뒪?ы넲留? -->
            <div class="hidden lg:block w-[380px] flex-shrink-0">
                <div class="relative">
                    {% include 'core/partials/sns_widget.html' %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
```

### ?щ컮瑜?酉?荑쇰━

```python
from core.models import Post
from django.db.models import Count

# ?좏깮??愿怨?UserProfile)??select_related ?쒖쇅
try:
    posts = Post.objects.select_related(
        'author'
    ).prefetch_related(
        'comments__author',
        'likes'
    ).annotate(
        like_count=Count('likes', distinct=True),
        comment_count=Count('comments', distinct=True)
    ).order_by('-created_at')[:20]
except Exception as e:
    posts = []

context['posts'] = posts
```

### ?뷀븳 ?ㅼ닔 5媛吏

1. **Flex 援ъ“ ?놁씠 ?꾩젽留?異붽?** ???덉씠?꾩썐 源⑥쭚 ??Flex 而⑦뀒?대꼫濡?媛먯떥湲?2. **context??`posts` ?꾨씫** ???꾩젽 鍮??붾㈃ ??`'posts': posts` 異붽?
3. **N+1 荑쇰━** ??`Post.objects.all()[:20]` ??select_related/prefetch_related ?ъ슜
4. **`items-start` ?꾨씫** ???ъ씠?쒕컮 stretch ??異붽?
5. **紐⑤컮??諛섏쓳??誘몄쿂由?* ??`hidden lg:block` 異붽?

### 愿???뚯씪
- SNS ?꾩젽: `core/templates/core/partials/sns_widget.html`
- 寃뚯떆湲: `core/templates/core/partials/post_list.html`, `post_item.html`
- 紐⑤뜽/酉? `core/models.py` (Post, Comment), `core/views.py`
- HTMX: ?묒꽦(`hx-post="/post/create/"`), 醫뗭븘??`hx-post="/post/<id>/like/"`), ?볤?(`hx-post="/post/<id>/comment/"`)

### ?곸슜 ?꾪솴
- ?짟TI: ?꾨즺 (而ㅻ컠 3223af2, 92e5f44, hotfix 6b90179)
- Fortune: 誘몄쟻??
### ?ν썑 媛쒖꽑
- Post 紐⑤뜽??`service` ?꾨뱶 異붽? ???쒕퉬?ㅻ퀎 寃뚯떆湲 ?꾪꽣留?- HTMX 臾댄븳 ?ㅽ겕濡??섏씠吏?ㅼ씠??
---

# ?ㅽ궗 & ?뚰겕?뚮줈??
## ?ㅼ튂???ㅽ궗

### Frontend
| ?ㅽ궗 | ?⑸룄 |
|------|------|
| `alpinejs-best-practices` | Alpine.js ?곹깭 愿由?諛?DOM 議곗옉 |
| `htmx-power-usage` | HTMX 鍮꾨룞湲??듭떊 諛?遺遺??뚮뜑留?|
| `vanilla-js-dom-master` | ?쒖닔 JS 湲곗닠 |
| `tailwind-design-system` | Tailwind 而댄룷?뚰듃 ?ㅺ퀎 |
| `ui-ux-pro-max` | UX ?붿옄???먯튃 諛??좊땲硫붿씠??|
| `web-design-guidelines` | UI 媛?대뱶?쇱씤 諛????묎렐??|

### Backend
| ?ㅽ궗 | ?⑸룄 |
|------|------|
| `django-architecture-pro` | Service Layer 諛?Fat Model 遺꾨━ |
| `api-design-principles` | REST/HTMX ???API ?ㅺ퀎 |
| `async-python-django` | 鍮꾨룞湲?View 諛?Celery ?⑦꽩 |
| `python-testing-django` | PyTest-Django ?뚯뒪???⑦꽩 |

## ?먯씠?꾪듃
| ?먯씠?꾪듃 | ?⑸룄 |
|----------|------|
| `planner` | 蹂듭옟??湲곕뒫 怨꾪쉷 (DB 留덉씠洹몃젅?댁뀡 ?? |
| `django-specialist` | Django View, Model, Template ?꾨Ц |
| `frontend-developer` | Alpine.js, HTMX, Tailwind UI |
| `code-reviewer` | 肄붾뱶 ?덉쭏 諛?Django 蹂댁븞 由щ럭 |

## ?뚰겕?뚮줈??```
# ?꾨줎?몄뿏??/frontend [?붿껌?ы빆] ??frontend-developer ??/verify

# 諛깆뿏??/plan [?붿껌?ы빆] ??Django 援ы쁽 ??/verify
```

## 而ㅻ㎤??| 而ㅻ㎤??| ?⑸룄 |
|--------|------|
| `/plan` | ?묒뾽 怨꾪쉷 ?섎┰ |
| `/commit-push-pr` | 而ㅻ컠?믫뫖?쒋넂PR |
| `/verify` | `python manage.py check` 諛?寃利?|
| `/review` | 蹂댁븞 諛?Performance 由щ럭 |
| `/simplify` | 蹂듭옟??濡쒖쭅 ?⑥닚??|
| `/handoff` | ?몄뀡 醫낅즺 ??媛덈Т由?|

---

# ?꾩떆 鍮꾪솢?깊솕 湲곕뒫

## Fortune ??- ?쇰컲 紐⑤뱶(general) (2026-02-09 鍮꾪솢?깊솕 ??2026-02-13 蹂듦뎄)

**?곹깭:** ?쒖꽦??(援먯궗 紐⑤뱶 + ?쇰컲 紐⑤뱶 紐⑤몢 ?몄텧)

**?대젰:**
- 2026-02-09: ?쇰컲 紐⑤뱶 ?꾩떆 鍮꾪솢?깊솕 (而ㅻ컠 15b5737)
- 2026-02-13: ?쇰컲 紐⑤뱶 蹂듦뎄 ?꾨즺 (UI 二쇱꽍 ?댁젣 + views.py 3怨??먮났)

---

## Chess ??- JS 寃뚯엫 濡쒖쭅 二쇱쓽?ы빆 (2026-02-09)

### 15. JS `var` ?몄씠?ㅽ똿 ??媛숈? ?⑥닔 ??蹂???ъ꽑??湲덉?

`var`濡?媛숈? ?대쫫???ъ꽑?명븯硫??몄씠?ㅽ똿???섑빐 ?섎굹??蹂?섎줈 ?⑹퀜?? ?댄썑 遺꾧린?먯꽌 ?덉긽怨??ㅻⅨ 媛믪쓣 李몄“?쒕떎.

```javascript
// ??var piece媛 2踰??좎뼵 ???몄씠?ㅽ똿?쇰줈 ?섎굹濡??⑹퀜吏?function onSquareClick(square) {
    var piece = game.get(square);         // ?대┃??移?    if (selectedSquare) {
        var piece = game.get(selectedSquare); // ?댁쟾 ?좏깮 移몄쑝濡???뼱?
        // move ?ㅽ뙣 ??fall-through...
    }
    // ?ш린??piece??selectedSquare 湲곗? ???섎せ??媛?    if (!piece || piece.color !== game.turn()) { ... }
}

// ???ㅻⅨ ?대쫫 ?ъ슜
var selectedPiece = game.get(selectedSquare);
```

> **?щ? (2026-02-09)**: 泥댁뒪 ?깆뿉??湲곕Ъ ?좏깮 ???섎せ??移??대┃ ????湲곕Ъ ?좏깮?????섎뒗 踰꾧렇. `var piece` ?ъ꽑?몄씠 ?먯씤.

### 16. Undo/Reset ??紐⑤뱺 ?뚯깮 ?곹깭 ?숆린???꾩닔

寃뚯엫?먯꽌 `undo()` ?먮뒗 `reset()` ?몄텧 ?? ?듭떖 ?곹깭肉??꾨땲??**?뚯깮 UI ?곹깭**??諛섎뱶???숆린?뷀빐???쒕떎.

**泥댄겕由ъ뒪??* (泥댁뒪 湲곗?):
- [ ] `capturedPieces` 諛곗뿴?먯꽌 ?섎룎由?湲곕Ъ ?쒓굅 + `renderCapturedPieces()` ?몄텧
- [ ] `lastMove` 媛깆떊 (?⑥? 湲곕줉??留덉?留????먮뒗 null) + `highlightLastMove()` ?몄텧
- [ ] `moveHistory` 諛곗뿴 pop + `updateMoveHistory()` ?몄텧
- [ ] Reset ??`renderCapturedPieces()` ?몄텧 (initGame??諛곗뿴留?鍮꾩슦怨?DOM? ??嫄대뱶由?

> **?щ? (2026-02-09)**: ?섎룎由ш린 ???≪? 湲곕Ъ ?⑤꼸???대? ?뚯븘媛?湲곕Ъ???쒖떆?섍퀬, ?섏씠?쇱씠?멸? ?섎せ??移몄뿉 ?⑥븘?덉뿀??

### 17. Web Audio API ??AudioContext 怨듭쑀 ?꾩닔

`playSound()` ?몄텧留덈떎 `new AudioContext()`瑜??앹꽦?섎㈃ 釉뚮씪?곗? ?쒗븳(蹂댄넻 6媛????꾨떖?섏뿬 ?ъ슫?쒓? 硫덉텣?? ?꾩뿭???섎굹瑜??앹꽦?섍퀬 `suspended` ?곹깭????`resume()` ?몄텧.

```javascript
// ??留ㅻ쾲 ?앹꽦
function playSound() {
    var ctx = new AudioContext();
}

// ???꾩뿭 怨듭쑀
var sharedAudioContext = null;
function getAudioContext() {
    if (!sharedAudioContext) {
        sharedAudioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (sharedAudioContext.state === 'suspended') sharedAudioContext.resume();
    return sharedAudioContext;
}
```

### 愿???뚯씪
- `chess/static/chess/js/chess_logic.js` - 寃뚯엫 濡쒖쭅 ?꾩껜
- `chess/templates/chess/play.html` - 寃뚯엫 UI (紐⑤떖, ?섏씠?쇱씠??CSS)
- `chess/templates/chess/index.html` - 濡쒕퉬 ?섏씠吏

### 18. CSS `transform` 異⑸룎 ???꾩뿭 hover媛 紐⑤떖 centering???뚭눼

`base.html`??`.clay-card:hover { transform: translateY(-4px) scale(1.005) }`泥섎읆 ?꾩뿭 hover ?ㅽ??쇱씠 ?덉쑝硫? `fixed` + `transform: translate(-50%, -50%)`濡?以묒븰 ?뺣젹??紐⑤떖???꾩튂瑜?**?꾩쟾????뼱?대떎**. CSS `transform`? 媛쒕퀎 媛믪씠 ?꾨땶 **?꾩껜媛 援먯껜**?섍린 ?뚮Ц?대떎.

**利앹긽**: 紐⑤떖 ?꾩뿉 留덉슦?ㅻ? ?щ━硫??ㅻⅨ履??꾨옒濡???대굹媛怨? 留덉슦?ㅺ? 踰쀬뼱?섎㈃ ?뚯븘?ㅻ㈃??諛섏쭩嫄곕┝(flicker) 諛쒖깮.

```css
/* ??base.html ?꾩뿭 ?ㅽ??쇱씠 紐⑤떖 centering???뚭눼 */
.clay-card:hover {
    transform: translateY(-4px) scale(1.005);  /* translate(-50%,-50%) ?щ씪吏?*/
}

/* ??紐⑤떖??怨좎쑀 ?대옒??遺????hover transform 怨좎젙 */
.tool-modal.clay-card:hover {
    transform: translate(-50%, -50%) !important;
}
```

**泥댄겕由ъ뒪??* (fixed + transform 以묒븰 ?뺣젹 紐⑤떖 留뚮뱾 ??:
- [ ] 紐⑤떖??`clay-card`, `clay-btn` ???꾩뿭 hover transform???덈뒗 ?대옒?ㅻ? ?ъ슜?섍퀬 ?덈뒗媛?
- [ ] ?ъ슜?쒕떎硫? 紐⑤떖 ?꾩슜 ?대옒?ㅻ줈 hover transform??`translate(-50%, -50%)`濡?怨좎젙?덈뒗媛?

> **?щ? (2026-02-09)**: tools ?섏씠吏 紐⑤떖??`.clay-card:hover`??`translateY(-4px)`???섑빐 centering??源⑥?硫댁꽌 諛섏쭩嫄곕┝ 諛쒖깮. `.tool-modal.clay-card:hover`濡?transform 怨좎젙?섏뿬 ?닿껐.

---

## ?뚯뀥 濡쒓렇??/ Gunicorn / allauth ?댁뒋 (2026-02-10)

### 19. allauth ACCOUNT_SIGNUP_FORM_CLASS vs SOCIALACCOUNT_FORMS 援щ텇 (CRITICAL)

allauth 65.x?먯꽌 而ㅼ뒪? 媛???쇱쓣 留뚮뱾 ?? **`SOCIALACCOUNT_FORMS`瑜??ъ슜?섎㈃ ???쒕떎.**

```python
# ??SOCIALACCOUNT_FORMS濡??쇱쓣 援먯껜?섎㈃ try_save()/save() ?놁뼱??500 ?먮윭
SOCIALACCOUNT_FORMS = {
    'signup': 'core.signup_forms.CustomSignupForm',
}

# ??allauth.socialaccount.forms.SignupForm??吏곸젒 ?곸냽?섎㈃ ?쒗솚 import ???щ옒??from allauth.socialaccount.forms import SignupForm as SocialSignupForm
class CustomSignupForm(SocialSignupForm): ...

# ??ACCOUNT_SIGNUP_FORM_CLASS留??ъ슜 (allauth媛 ?먮룞 ?곸냽 泥댁씤 援ъ꽦)
ACCOUNT_SIGNUP_FORM_CLASS = 'core.signup_forms.CustomSignupForm'
# ??allauth ?대?: SignupForm(BaseSignupForm(CustomSignupForm))
# ??try_save() ??save() ??custom_signup() ??signup() ?뺤긽 ?묐룞
```

**CustomSignupForm? `forms.Form`???곸냽?섍퀬, 異붽? ?꾨뱶 + `signup(request, user)` 硫붿꽌?쒕쭔 ?뺤쓽:**
```python
class CustomSignupForm(forms.Form):
    nickname = forms.CharField(...)
    def signup(self, request, user):
        # 異붽? ?꾨줈?????濡쒖쭅
```

> **?щ?**: `SOCIALACCOUNT_FORMS`濡?`forms.Form` 湲곕컲 ?쇱쓣 吏????allauth媛 `form.try_save()` ?몄텧 ??`AttributeError` ??500. 吏곸젒 ?곸냽?쇰줈 ?고쉶 ?쒕룄 ???쒗솚 import ???쒕쾭 ?щ옒?? `ACCOUNT_SIGNUP_FORM_CLASS`留??ъ슜?섏뿬 ?닿껐.

### 20. Gunicorn sync worker 怨좉컝 ??AI API ?몄텧 ???꾩닔 ?ㅼ젙

湲곕낯 Gunicorn ?ㅼ젙(`gunicorn config.wsgi`)? **worker 1媛?+ sync 紐⑤뱶**. AI API泥섎읆 30~60珥?嫄몃━???숆린 ?몄텧???덉쑝硫?洹??숈븞 **?쒕쾭 ?꾩껜媛 癒뱁넻**.

```bash
# ??湲곕낯 ?ㅼ젙 (worker 1媛? ??AI 1嫄?泥섎━ 以?紐⑤뱺 ?붿껌 499
gunicorn config.wsgi --timeout 120

# ??gthread 紐⑤뱶 (?숈떆 12媛??붿껌 泥섎━)
gunicorn config.wsgi --workers 3 --threads 4 --worker-class gthread --timeout 120
```

**利앹긽**: `/fortune` POST 泥섎━ 以?`/accounts/login/`, `/accounts/kakao/login/callback/` ??紐⑤뱺 寃쎈줈?먯꽌 499 ?먮윭 諛쒖깮.

> **?щ?**: ?ъ＜ 遺꾩꽍 API媛 54珥덇컙 worker瑜??먯쑀 ??媛숈? ?쒓컙? 紐⑤뱺 ?붿껌(濡쒓렇?? 媛?? ?ㅻⅨ ?쒕퉬????499濡??ㅽ뙣.

### 21. OnboardingMiddleware ??OAuth 肄쒕갚 寃쎈줈 ?덉슜 ?꾩닔

`OnboardingMiddleware`??`allowed_paths`??`/accounts/` ?꾩껜瑜??ы븿?댁빞 ?뚯뀥 濡쒓렇??肄쒕갚??李⑤떒?섏? ?딆쓬.

```python
# ??/accounts/logout/ 留??덉슜 ??OAuth 肄쒕갚 李⑤떒
allowed_paths = ['/accounts/logout/', ...]

# ??/accounts/ ?꾩껜 ?덉슜
allowed_paths = ['/accounts/', ...]
```

> **?щ?**: 移댁뭅???ㅼ씠踰?濡쒓렇??肄쒕갚(`/accounts/kakao/login/callback/`)??`allowed_paths`???놁뼱?? ?몄쬆 ?꾨즺 ??`/update-email/`濡?媛뺤젣 由щ떎?대젆????媛???ㅽ뙣.

### 22. 而ㅼ뒪? 媛????widget readonly ???뚯뀥 ?쒓났???대찓??誘몄젣怨????낅젰 遺덇?

```python
# ??湲곕낯 widget??readonly ???대찓???놁쑝硫?鍮?移?+ ?낅젰 遺덇? ??媛??遺덇?
email = forms.EmailField(widget=forms.EmailInput(attrs={'readonly': 'readonly'}))

# ??湲곕낯? ?몄쭛 媛?? ?뚯뀥 ?대찓???덉쓣 ?뚮쭔 __init__?먯꽌 readonly ?ㅼ젙
email = forms.EmailField(widget=forms.EmailInput(attrs={...}))
# __init__?먯꽌:
if self.sociallogin and self.sociallogin.user.email:
    self.fields['email'].widget.attrs['readonly'] = True
```

> **?щ?**: 移댁뭅??濡쒓렇?????대찓??誘몄젣怨???媛?????대찓??移몄씠 readonly + 鍮?媛????꾩닔 ?꾨뱶???쒖텧 遺덇? ??紐⑤뱺 ?좉퇋 媛??李⑤떒.

### 23. settings_production.py ?쒕쾭 ?쒖옉 ??DB 議곗옉 二쇱쓽

`sync_site_domain()` 媛숈? ?쒖옉 ???ㅽ뻾 ?⑥닔?먯꽌 `SocialApp.objects.all().delete()` ??**?꾩껜 ??젣 荑쇰━**瑜??ｌ? ?딄린. 留?諛고룷留덈떎 遺덊븘?뷀븳 DB 議곗옉??諛쒖깮?섍퀬, ?덉씠??而⑤뵒???꾪뿕.

### 24. SESSION_SAVE_EVERY_REQUEST ?깅뒫 ?곹뼢

`SESSION_SAVE_EVERY_REQUEST = True`??**紐⑤뱺 HTTP ?붿껌留덈떎 DB write**瑜?諛쒖깮?쒗궡. ?몃옒?쎌씠 留롮? ?쒕퉬?ㅼ뿉?쒕뒗 `False`濡??ㅼ젙?섍퀬, `SESSION_COOKIE_AGE`瑜?異⑸텇??湲멸쾶(24?쒓컙+) ?ㅼ젙.

### 愿???뚯씪
- `core/signup_forms.py` ???뚯뀥 媛??而ㅼ뒪? ??(nickname + signup)
- `core/middleware.py` ??OnboardingMiddleware (allowed_paths)
- `config/settings_production.py` ??allauth, ?몄뀡, Gunicorn 愿???ㅼ젙
- `Procfile`, `nixpacks.toml` ??Gunicorn worker ?ㅼ젙

---

## ???붾㈃ ?덉씠?꾩썐 & 移댄뀒怨좊━ ?쒖뒪??(2026-02-10)

### 25. Django ?쒗뵆由??쒓렇 `{% %}` ?덉뿉 以꾨컮轅?湲덉?

`{% if ... %}` ?쒓렇??議곌굔??湲몄뼱??**?덈? 以꾨컮轅덊븯硫????쒕떎**. Django ?쒗뵆由??뚯꽌??`{%`? `%}` ?ъ씠??以꾨컮轅덉쓣 ?몄떇?섏? 紐삵빐 `TemplateSyntaxError: Invalid block tag 'endif'`瑜?諛쒖깮?쒗궓??

```html
<!-- ??以꾨컮轅???TemplateSyntaxError -->
{% if user.is_authenticated and
    user.userprofile.nickname %}

<!-- ????以꾨줈 -->
{% if user.is_authenticated and user.userprofile.nickname %}
```

> **?щ? (2026-02-10)**: `base.html` ?쇰뱶諛??꾩젽??`{% if %}` ?쒓렇媛 ??以꾩뿉 嫄몄퀜 ?덉뼱 ???섏씠吏 ?꾩껜媛 500 ?먮윭. git rebase 異⑸룎 ?닿껐 怨쇱젙?먯꽌 湲곗〈???곗뿰???숈옉?섎뜕 以꾨컮轅덉씠 源⑥쭚.

### 26. ???붾㈃ ?덉씠?꾩썐 援ъ“ (紐⑤컮??PC 遺꾨━)

**紐⑤컮??*: ?쒕퉬??移대뱶 above the fold ??SNS 誘몃━蹂닿린(理쒖떊 2媛? ??"?뚰넻李??닿린" ?꾩퐫?붿뼵
**PC**: SNS ?ъ씠?쒕컮(?쇱そ, sticky) + 硫붿씤 肄섑뀗痢??ㅻⅨ履?

```
紐⑤컮???ㅽ겕濡?媛꾩꽠 ?닿껐 ?듭떖:
- SNS瑜?蹂꾨룄 ?ㅽ겕濡?而⑦뀒?대꼫(overflow-auto)???ｌ? ?딄린
- ?섏씠吏 蹂몃Ц ?먮쫫???듯빀 (overflow-visible)
- ?꾩퐫?붿뼵?쇰줈 ?쇱튂湲??묎린 ??x-show + x-transition ?ъ슜
```

**愿???뚯씪:**
- `core/templates/core/home.html` ??鍮꾨줈洹몄씤 ??- `core/templates/core/home_authenticated.html` ??濡쒓렇????- `core/templates/core/partials/sns_widget.html` ??PC ?꾩슜 ?ъ씠?쒕컮
- `core/templates/core/partials/sns_widget_mobile.html` ??紐⑤컮???꾩슜 (?꾩퐫?붿뼵 ?대?)

### 27. ?쒕퉬??移댄뀒怨좊━ ?쒖뒪??
`products/models.py`??`SERVICE_CHOICES`濡?愿由? Django Admin `list_editable`濡?諛붾줈 ?섏젙 媛??

| 肄붾뱶 | ?대쫫 | ???됱긽 | ?꾩씠肄??됱긽 |
|------|------|---------|------------|
| `classroom` | ?댁쁺怨??섏뾽 | ?뚮???| `text-blue-500` |
| `work` | ?낅Т寃쎄컧 | 珥덈줉??| `text-emerald-500` |
| `game` | 寃뚯엫紐⑥쓬 | 鍮④컙??| `text-red-500` |
| `counsel` | ?곷떞쨌?댁꽭 | 蹂대씪??| `text-violet-500` |
| `edutech` | ?먮??뚰겕 | ?쒖븞??| `text-cyan-500` |
| `etc` | 湲고? | ?뚯깋 | `text-slate-500` |

**移댄뀒怨좊━ 異붽?/蹂寃????섏젙 ?꾩슂???뚯씪 (4怨?:**
1. `products/models.py` ??`SERVICE_CHOICES` + 留덉씠洹몃젅?댁뀡
2. `core/templates/core/home.html` ??CSS `.cat-{code}` + ??踰꾪듉
3. `core/templates/core/home_authenticated.html` ???꾩? ?숈씪
4. `core/templates/core/includes/card_product.html` ???꾩씠肄??쇰꺼 ?됱긽 遺꾧린

**移대뱶 而댄룷?뚰듃 `card_product.html`:**
- `is_filtered=True` ?꾨떖 ?? ?몃? `x-show` ?섑띁? ?④퍡 ?ъ슜 (Alpine.js ?꾪꽣留?紐⑤뱶)
- 誘몄쟾???? ?먮옒 援ъ“ ?좎? (?ㅻⅨ ?섏씠吏 ?명솚)
- `{{ product.get_service_type_display }}` ???쒓? 移댄뀒怨좊━紐??쒖떆

### 28. DB ?곗씠??蹂寃???諛섎뱶???곗씠??留덉씠洹몃젅?댁뀡 ?묒꽦

Django shell濡?濡쒖뺄 DB留??섎룞 ?섏젙?섎㈃ **?꾨줈?뺤뀡?먮뒗 諛섏쁺?섏? ?딅뒗??*. DB ?곗씠?곕? 蹂寃쏀븷 ?뚮뒗 諛섎뱶??`RunPython` ?곗씠??留덉씠洹몃젅?댁뀡???④퍡 ?묒꽦?댁빞 ?쒕떎.

```python
# ??Django shell濡쒕쭔 蹂寃????꾨줈?뺤뀡 誘몃컲??Product.objects.filter(id=121).update(service_type='classroom')

# ???곗씠??留덉씠洹몃젅?댁뀡 ?묒꽦
# python manage.py makemigrations products --empty --name update_xxx_data
def update_data(apps, schema_editor):
    Product = apps.get_model('products', 'Product')
    Product.objects.filter(id=121).update(service_type='classroom')

migrations.RunPython(update_data, migrations.RunPython.noop)
```

**?곸슜 ???** 移댄뀒怨좊━ 蹂寃? 湲곕낯媛??쇨큵 蹂寃? ?꾨뱶紐?蹂寃쎌뿉 ?곕Ⅸ 湲곗〈 ?곗씠??留ㅽ븨 ??紐⑤뱺 DB ?덉퐫???섏젙

### 29. git rebase 異⑸룎 ?닿껐 ??二쇱쓽?ы빆

異⑸룎 ?닿껐 ??諛섎뱶??
1. `{% if %}` / `{% endif %}` 諛몃윴???뺤씤
2. 以꾨컮轅덉쑝濡?遺꾨━???쒗뵆由??쒓렇媛 ?녿뒗吏 ?뺤씤
3. `python manage.py check` + ?ㅼ젣 ?섏씠吏 ?뚮뜑留??뚯뒪??
### 30. Procfile ensure_* 紐낅졊????Admin 愿由??꾨뱶 ??뼱?곌린 湲덉? (CRITICAL)

Procfile??`ensure_*` 紐낅졊?대뒗 **留?諛고룷(git push)留덈떎 ?ㅽ뻾**?쒕떎. ??紐낅졊???덉뿉??`service_type`, `display_order`, `color_theme` ??**Admin?먯꽌 ?섎룞 愿由ы븯???꾨뱶瑜?媛뺤젣 蹂寃쏀븯硫? 諛고룷???뚮쭏??Admin ?섏젙 ?댁슜??珥덇린??*?쒕떎.

**?? 珥덇린 媛쒕컻 以??쒕퉬??移댄뀒怨좊━(`service_type`)媛 蹂寃쎈릺嫄곕굹 移섎챸?곸씤 ?ㅻ쪟媛 ?덈뒗 寃쎌슦?먮뒗 議곌굔遺 蹂댁젙 濡쒖쭅???ы븿?댁빞 ?쒕떎.**

```python
# ??留?諛고룷留덈떎 service_type ??뼱? ??Admin ?섏젙 臾댄슚??if ssambti.service_type != 'game':
    ssambti.service_type = 'game'

# ??議곌굔 ?놁씠 臾댁“嫄?save ??Admin 蹂寃??꾨? 由ъ뀑
product.service_type = 'tool'
product.save()

# ??ensure 紐낅졊?대뒗 "議댁옱 蹂댁옣"留??대떦, Admin 愿由??꾨뱶??嫄대뱶由ъ? ?딄린
if not product.is_active:
    product.is_active = True
    needs_update = True
if needs_update:
    product.save()

# ???? 珥덇린 媛쒕컻 以??쒕퉬??移댄뀒怨좊━(service_type)媛 蹂寃쎈릺嫄곕굹 移섎챸?곸씤 ?ㅻ쪟媛 ?덈뒗 寃쎌슦?먮뒗 議곌굔遺 蹂댁젙 濡쒖쭅???ы븿?댁빞 ?쒕떎.
if product.service_type != 'counsel':  # ?섎せ??媛믪씪 ?뚮쭔 ?섏젙
    product.service_type = 'counsel'
    product.save()
```

**ensure_* 紐낅졊???묒꽦 洹쒖튃:**
- ?곹뭹???놁쓣 ??**?앹꽦**?섎뒗 寃껊쭔 ?대떦
- ?대? 議댁옱?섎뒗 ?곹뭹??`service_type`, `display_order`, `color_theme` ?깆? **?덈? ??뼱?곗? ?딄린**
- `is_active`, `external_url` ??湲곕뒫???꾩닔媛믩쭔 議곌굔遺濡?蹂댁젙

**?꾩옱 Procfile ?ㅽ뻾 ?쒖꽌:**
```
migrate --noinput ??ensure_ssambti ??ensure_studentmbti ??ensure_notebooklm ??check_visitors ??gunicorn
```

> **?щ? (2026-02-10)**: `ensure_ssambti`媛 留?諛고룷留덈떎 `service_type='game'`?쇰줈, `ensure_studentmbti`媛 `service_type='tool'`濡?媛뺤젣 蹂寃???Admin?먯꽌 移댄뀒怨좊━瑜??섏젙?대룄 ?ㅼ쓬 push?먯꽌 ?먮났?? service_type 媛뺤젣 蹂寃?濡쒖쭅 ?쒓굅濡??닿껐.

### 31. management command ?곗씠??援ъ꽦 ??`get_or_create` ?꾩닔 (CRITICAL)

`ensure_*` ?뺥깭??愿由?紐낅졊?대뒗 諛고룷 ?쒕쭏???ㅽ뻾?섎?濡? 湲곗〈 ?곗씠?곕? 臾댁“嫄???젣?섍퀬 ?ㅼ떆 ?앹꽦(`delete()` ??`create()`)?섎㈃ ???쒕떎.

**臾몄젣??*:
1.  **?곗씠???좎떎**: 愿由ъ옄 ?섏씠吏(Admin)?먯꽌 ?섎룞?쇰줈 ?섏젙???ㅻ챸?대굹 異붽?????ぉ??諛고룷 ?뚮쭏???щ씪吏?
2.  **?곗씠??以묐났**: ?щ윭 紐낅졊?닿? ?숈떆???ㅽ뻾?섍굅??濡쒖쭅 ?ㅻ쪟 ???묎컳? ??ぉ???щ윭 踰??앹꽦??

```python
# ???덈? 湲덉?: 湲곗〈 ?곗씠????젣 ???ъ깮??product.features.all().delete()
for feat in features:
    ProductFeature.objects.create(product=product, **feat)

# ??沅뚯옣: get_or_create瑜??ъ슜?섏뿬 議댁옱 ?щ? ?뺤씤 ???앹꽦
for feat in features_data:
    obj, created = ProductFeature.objects.get_or_create(
        product=product,
        title=feat['title'],
        defaults=feat
    )
```

> **?щ? (2026-02-13)**: '?숆탳 ?덉빟 ?쒖뒪?? ??二쇱슂 ?쒕퉬?ㅼ쓽 Key Features ??ぉ??諛고룷 ?뚮쭏??以묐났 ?앹꽦?섍굅??Admin ?섏젙蹂몄씠 珥덇린?붾릺??臾몄젣 諛쒖깮. 紐⑤뱺 `ensure_*` 紐낅졊?대? `get_or_create` 濡쒖쭅?쇰줈 ?꾩닔 ?섏젙??

---

## ???쒕퉬???? 異붽? ??泥댄겕由ъ뒪??(2026-02-10)

### 31. ?쒕퉬???쒖옉 踰꾪듉 URL ?쇱슦????preview_modal.html ?섏젙 ?꾩닔

`products/templates/products/partials/preview_modal.html`??"?쒖옉?섍린" 踰꾪듉? **product.title 湲곕컲 議곌굔臾?*?쇰줈 URL??寃곗젙?쒕떎. ???쒕퉬?ㅻ? 異붽??????ш린??`{% elif %}` 遺꾧린瑜?異붽??섏? ?딆쑝硫? ?쒖옉 踰꾪듉???뚮윭???덉쑝濡??뚯븘媛꾨떎.

```html
<!-- preview_modal.html ?쇱씤 86 ????以꾨줈 ?묒꽦?댁빞 ??(洹쒖튃 25) -->
{% if product.external_url %}{{ product.external_url }}{% elif product.title == '?짟TI' %}{% url 'ssambti:main' %}{% elif product.title == '媛꾪렪 ?섑빀' %}{% url 'collect:landing' %}{% elif product.title == '援먯궗 諛깃낵?ъ쟾' %}{% url 'encyclopedia:landing' %}{% else %}{% url 'home' %}{% endif %}
```

**???쒕퉬??異붽? ??**
- [ ] `{% elif product.title == '?쒕퉬?ㅻ챸' %}{% url 'app:landing' %}` 遺꾧린 異붽?
- [ ] `external_url` ?ъ슜?섎뒗 ?몃? ?쒕퉬?ㅻ뒗 遺꾧린 遺덊븘??(泥?踰덉㎏ 議곌굔?먯꽌 泥섎━??

> **?щ? (2026-02-12)**: '媛꾪렪 ?섑빀', '援먯궗 諛깃낵?ъ쟾', '?숆탳 ?덉빟 ?쒖뒪?? ?????쒕퉬?ㅻ? 異붽?????`preview_modal.html`???깅줉???꾨씫?섏뿬 ?쒖옉 踰꾪듉???묐룞?섏? ?딅뒗 ?꾩긽??諛섎났?? ?좉퇋 ???앹꽦 ??泥댄겕由ъ뒪??5踰???ぉ(`preview_modal.html` 遺꾧린 異붽?)??諛섎뱶??以?섑븷 寃? (?꾩옱: '?숆탳 ?덉빟 ?쒖뒪?? -> `reservations:reservation_index`)

### 32. ensure_* 紐낅졊????defaults??service_type? 諛섎뱶??SERVICE_CHOICES 媛??ъ슜

`get_or_create(defaults={...})`?먯꽌 `service_type`??吏?뺥븷 ?? 諛섎뱶??`products/models.py`??`SERVICE_CHOICES`???덈뒗 媛믪쓣 ?ъ슜?댁빞 ?쒕떎.

**?꾩옱 ?좏슚??媛?** `classroom`, `work`, `game`, `counsel`, `edutech`, `etc`

```python
# ??SERVICE_CHOICES???녿뒗 媛???Admin?먯꽌 ?쒖떆 ?댁긽
'service_type': 'guide',    # ???녿뒗 媛?
'service_type': 'tool',     # ???녿뒗 媛?

# ???좏슚??媛믩쭔 ?ъ슜
'service_type': 'edutech',  # ??SERVICE_CHOICES??議댁옱
```

> **?щ? (2026-02-10)**: `ensure_notebooklm`??`service_type='guide'`濡??앹꽦 ??Admin?먯꽌 移댄뀒怨좊━媛 鍮?媛믪쑝濡??쒖떆. ?곗씠??留덉씠洹몃젅?댁뀡?쇰줈 `'edutech'`濡??섏젙.

### 33. ??Django ??異붽? ???꾩껜 泥댄겕由ъ뒪??
| ?④퀎 | ?뚯씪 | ?묒뾽 |
|------|------|------|
| 1 | ???붾젆?좊━ | `models.py`, `views.py`, `urls.py`, `forms.py`, `admin.py`, `apps.py` ?앹꽦 |
| 2 | `config/settings.py` | `INSTALLED_APPS`??異붽? |
| 3 | `config/settings_production.py` | `INSTALLED_APPS`???숈씪?섍쾶 異붽? (洹쒖튃 1) |
| 4 | `config/urls.py` | `path('??', include('??urls', namespace='??))` 異붽? |
| 5 | `preview_modal.html` | ?쒖옉 踰꾪듉 URL 遺꾧린 異붽? (洹쒖튃 31) |
| 6 | `ensure_*` 紐낅졊??| Product ?앹꽦 蹂댁옣, Admin ?꾨뱶 ??뼱?곌린 湲덉? (洹쒖튃 30) |
| 7 | `settings_production.py` | `run_startup_tasks()`??`call_command('ensure_*')` 異붽? |
| 8 | `Procfile` | `ensure_*` 紐낅졊??泥댁씤??異붽? |
| 9 | `nixpacks.toml` | Procfile怨??숆린??|
| 10 | `admin.py` | `select_related` + `annotate` + `raw_id_fields` (洹쒖튃 14) |
| 11 | 留덉씠洹몃젅?댁뀡 | `makemigrations` + `migrate` |
| 12 | 寃利?| `python manage.py check` |

**?꾩옱 Procfile ?ㅽ뻾 ?쒖꽌:**
```
migrate ??ensure_ssambti ??ensure_studentmbti ??ensure_notebooklm ??ensure_collect ??ensure_reservations ??check_visitors ??gunicorn
```

### 34. ?덈줈???쒕퉬??媛쒕컻 ??濡쒖뺄 ?곗씠?곕쿋?댁뒪 ?곗씠???뺤씤

濡쒖뺄 ?섍꼍?먯꽌???곗씠?곕쿋?댁뒪(`db.sqlite3`)媛 鍮꾩뼱 ?덇굅??媛쒕컻 ?섍꼍留덈떎 ?곗씠?곌? ?ㅻ? ???덈떎. ?덈줈???쒕퉬?ㅻ? 媛쒕컻?????뚯뒪 肄붾뱶留??묒꽦?섍퀬 DB ?덉퐫??`Product` 紐⑤뜽 ??瑜??앹꽦?섏? ?딆쑝硫? UI?먯꽌 ?대떦 ?쒕퉬?ㅺ? ?꾩삁 蹂댁씠吏 ?딄굅???ㅻ쪟媛 諛쒖깮?????덈떎.

- **利앹긽**: ??肄붾뱶??議댁옱?섏?留????붾㈃?대굹 ?곸꽭 ?섏씠吏?먯꽌 ?쒕퉬???뺣낫媛 ?쒖떆?섏? ?딆쓬.
- **?먯씤**: `get_collect_service()`? 媛숈? ?⑥닔媛 DB?먯꽌 ?곗씠?곕? 李얠? 紐삵빐 `None`??諛섑솚??
- **?닿껐**: 媛쒕컻 珥덇린 ?④퀎?먯꽌 `create_xxx_data.py` 媛숈? ?꾩떆 ?ㅽ겕由쏀듃瑜??묒꽦?섏뿬 濡쒖뺄 DB???꾩닔 ?곗씠?곕? ?ｊ굅?? `python manage.py ensure_xxx` 紐낅졊?대? ?ㅽ뻾?섏뿬 ?곗씠?곕? ?앹꽦??寃?

### 35. Django ?쒗뵆由우쓽 蹂??紐낅챸 洹쒖튃 ?쒗븳 (CRITICAL)

Django ?쒗뵆由??붿쭊? **?몃뜑諛?`_`)濡??쒖옉?섎뒗 ?띿꽦?대굹 蹂?섏뿉 ???吏곸젒 ?묎렐???덉슜?섏? ?딅뒗??** ?뚯씠?ъ쓽 愿濡??`_`濡??쒖옉?섎뒗 硫ㅻ쾭??Private?쇰줈 媛꾩＜?섍린 ?뚮Ц?대떎.

- **利앹긽**: `TemplateSyntaxError: Variables and attributes may not begin with underscores` 諛쒖깮.
- **?먯씤**: View?먯꽌 `.annotate(_count=Count(...))`? 媛숈씠 ?몃뜑諛붾줈 ?쒖옉?섎뒗 ?대쫫?쇰줈 ?곗씠?곕? ?섍린怨? ?쒗뵆由우뿉??`{{ obj._count }}`濡??묎렐?섎젮 ????諛쒖깮.
- **?닿껐**: ?쒗뵆由우뿉???ъ슜??蹂?섎굹 ?띿꽦 ?대쫫?먮뒗 ?덈? ?몃뜑諛붾? ?묐몢?대줈 ?ъ슜?섏? 留?寃? (?? `_submission_count` ???`num_submissions` ?먮뒗 `submission_count` ?ъ슜)

### 36. Alpine.js ?곹깭 珥덇린?붿? Django ???먮윭 ?곕룞

Alpine.js濡?UI ?곹깭(紐⑤떖, ?꾩퐫?붿뼵 ??瑜?愿由ы븷 ?? ???쒖텧 ???먮윭媛 諛쒖깮?섎㈃ **UI媛 ?대┛ ?곹깭濡??좎?**?섏뼱???ъ슜?먭? ?먮윭瑜??몄??????덈떎.

```html
<!-- ???먮윭媛 ?덉뼱???ロ옒 ???ъ슜?먮뒗 "?????섏??" ?쇰? -->
<div x-data="{ open: false }">

<!-- ???먮윭媛 ?덉쑝硫??대┛ ?곹깭濡?珥덇린??-->
<div x-data="{ open: {% if form.errors %}true{% else %}false{% endif %} }">
```

> **?щ? (2026-02-11)**: ?섑빀 ?붿껌 ?앹꽦 ?쇱씠 ?먮윭 諛쒖깮 ???ロ엺 梨꾨줈 由щ줈?쒕릺?? ?ъ슜?먭? ?붿껌???앹꽦?섏? ?딆? ?댁쑀瑜??????놁뿀??

### 37. ModelForm ?꾩닔 ?꾨뱶 ?꾨씫 二쇱쓽

`forms.py`??`ModelForm`?먯꽌 `fields` 由ъ뒪?몄뿉 ?ы븿???꾨뱶媛 **?쒗뵆由?HTML)?먯꽌 ?뚮뜑留곷릺吏 ?딆쑝硫?*, ?ъ슜?먮뒗 ?낅젰??諛⑸쾿???녿뒗???쒕쾭??`required` ?먮윭瑜??몃떎.

**?닿껐梨?*:
1. ?ъ슜?먯뿉寃??낅젰??諛쏆쓣 ?꾩슂媛 ?녿뒗 ?꾨뱶(?? `max_file_size_mb`)??`fields` 由ъ뒪?몄뿉??**?쒓굅**?섍굅??`exclude` 泥섎━.
2. 諛섎뱶???꾩슂?섏?留??ъ슜???낅젰??遺덊븘?뷀븯硫?`HiddenInput` ?꾩젽 ?ъ슜 ?먮뒗 紐⑤뜽 `default` 媛??쒖슜.

```python
# ?????꾨뱶???덈뒗??HTML???놁쓬 ???좏슚??寃???ㅽ뙣
fields = ['title', 'max_file_size_mb'] 

# ???ъ슜???낅젰 遺덊븘?뷀븯硫??꾨뱶 ?쒓굅 (紐⑤뜽 default ?ъ슜)
fields = ['title']
```

> **?щ? (2026-02-11)**: `max_file_size_mb`媛 ???꾨뱶?먮뒗 ?덉뿀?쇰굹 ?쒗뵆由우뿉 ?놁뼱, "?꾩닔 ??ぉ?낅땲?? ?먮윭? ?④퍡 ?앹꽦 ?ㅽ뙣. ?ъ슜?먯뿉寃?援녹씠 ?낅젰諛쏆쓣 ?꾩슂 ?녿뒗 湲곗닠???ㅼ젙?대씪 ???꾨뱶?먯꽌 ?쒓굅?섏뿬 ?닿껐.

### 38. ?ъ슜?먯뿉寃?湲곗닠???ㅼ젙 媛뺤슂 湲덉? (Sensible Defaults)

?ъ슜???뱁엳 鍮꾧컻諛쒖옄)?먭쾶 "?뚯씪 理쒕? ?ш린(MB)", "泥?겕 ?ъ씠利? 媛숈? 湲곗닠???ㅼ젙??臾살? 留?寃? ?쒖뒪?쒖씠 ?⑸━?곸씤 湲곕낯媛?Sensible Default)???쒓났?섍퀬, 瑗??꾩슂??寃쎌슦?먮쭔 怨좉툒 ?ㅼ젙?쇰줈 ?④꺼???쒓났?쒕떎.

> **?щ? (2026-02-11)**: 援먯궗?ㅼ뿉寃?"?뚯씪??理쒕? ?ш린"瑜??낅젰?섍쾶 ?섎뒗 寃껋? 遺덊븘?뷀븳 ?몄? 遺?? 湲곕낯媛?30MB濡?怨좎젙?섍퀬 ?낅젰? ?쒓굅.

### 39. 紐⑤컮??移대뱶 ?ㅻ쾭?뚮줈????`box-sizing` + 洹몃┝??+ `.clay-card` ?쒖빟 (CRITICAL)

紐⑤컮??釉뚮씪?곗??먯꽌 Tailwind CDN??preflight(`box-sizing: border-box`)媛 誘몄쟻?⑸릺??`padding`怨?`border`媛 ?붿냼 ?ш린??異붽??섍굅?? 源딆? `box-shadow`媛 酉고룷???덈퉬瑜?珥덇낵?섏뿬 ?ㅻ쾭?뚮줈?곕? ?좊컻?????덈떎.

**?닿껐 (`base.html`???곸슜):**

1. **?꾩뿭 `box-sizing: border-box` 紐낆떆** ???곷떒??蹂꾨룄 `<style>`濡??좎뼵
2. **紐⑤컮??洹몃┝??理쒖쟻??* ??紐⑤컮?쇱뿉?쒕뒗 醫뚯슦 洹몃┝???ㅽ봽?뗭쓣 0?쇰줈 ?ㅼ젙(`box-shadow: 0 4px 12px ...`)
3. **`.clay-card`??`max-width: 100%; overflow: hidden;`** ??遺紐??덈퉬瑜??섏? 紐삵븯寃?媛뺤젣

```css
/* base.html */
*, *::before, *::after { box-sizing: border-box; }

.clay-card {
    max-width: 100%;
    overflow: hidden;
    /* 紐⑤컮?? 醫뚯슦 ?ㅽ봽??0?쇰줈 酉고룷???뺤옣 諛⑹? */
    box-shadow: 0 4px 12px rgba(163, 177, 198, 0.4), 0 -2px 8px rgba(255, 255, 255, 0.6);
}

@media (min-width: 768px) {
    .clay-card { box-shadow: 8px 8px 16px rgba(163, 177, 198, 0.5), -8px -8px 16px rgba(255, 255, 255, 0.6); }
}
```

> **?щ? (2026-02-11)**: studentmbti, collect 紐⑤컮???쒕뵫?먯꽌 移대뱶媛 ?ㅻⅨ履쎌쑝濡???대궓. 洹쇰낯 ?먯씤? `content-box` ?숈옉怨??볦? ?섑룊 洹몃┝?먯???

---

## 40. AI 濡쒓퉭 ?쒖? 媛?대뱶 (Monitoring)

?ы썑 異붿쟻 諛?AI ?먯씠?꾪듃???먭? ?섎났???⑹씠?섍쾶 ?섍린 ?꾪빐 紐⑤뱺 二쇱슂 ?≪뀡? ?쒖??붾맂 ?щ㎎?쇰줈 濡쒓퉭?쒕떎.

**?쒖? ?щ㎎:** `[AppName] Action: ACTION_NAME, Status: SUCCESS/FAIL, Key: Value, ...`

```python
# ???덉떆: ?몄뀡 ?앹꽦 濡쒓퉭
logger.info(f"[StudentMBTI] Action: SESSION_CREATE, Status: SUCCESS, SessionID: {session.id}, User: {request.user.username}, Type: {test_type}")
```

## 41. 硫붿씤 而댄룷?뚰듃 ?붿옄??(Claymorphism)

Eduitit??硫붿씤 ?쒕퉬???섏씠吏(?댁쫰, ??쒕낫??硫붿씤 移대뱶 ????**Claymorphism** ?붿옄?몄쓣 湲곕낯?쇰줈 ?쒕떎.

- **?대옒??*: `.clay-card` ?꾩닔 ?곸슜
- **?щ갚**: SIS Rule 8.271???곕씪 紐⑤컮?쇨낵 ?곗뒪?ы넲 ?⑤뵫 援щ텇 (`p-6 md:p-14`)
- **洹몃┝??*: ?꾩뿭 ?쒓렇??hover ?④낵 ?쒖슜 (`.clay-card:hover`)

## 42. Django Template filter? whitespace 二쇱쓽

JavaScript ?덉뿉??Django ?쒗뵆由?蹂?섎? ?ъ슜???? ?꾪꽣(`|`) 二쇱쐞??怨듬갚???ｌ쑝硫??? `{{ var | length }}`) ?쇰? JS 由고꽣???먮뵒?곗뿉??援щЦ ?ㅻ쪟濡??ㅼ씤?????덈떎.

- **沅뚯옣**: `{{ questions|length }}` (怨듬갚 ?놁씠 諛李?
- **?댁쑀**: 臾몄옄??二쇱엯 ??linter??遺덊븘?뷀븳 ?몄씠利??쒓굅 諛?肄붾뱶 媛꾧껐???뺣낫

---

## 43. ?ㅽ겕由쏀듃 以묐났 諛⑹? 諛?JS ?곗씠???꾨떖 ?쒖?

### 43.1 ?쇱씠釉뚮윭由?以묐났 濡쒕뱶 湲덉? (Duplication)
`base.html`?먯꽌 濡쒕뱶???쇱씠釉뚮윭由?HTMX, Alpine.js ??瑜??먯떇 ?쒗뵆由우씠??Partial?먯꽌 ?ㅼ떆 濡쒕뱶?섏? ?딅뒗??
- **利앹긽**: 紐⑤떖 ?댁슜 以묐났, ?대깽??由ъ뒪??以묐났 諛붿씤?? UI ?ㅻ룞??(?? 紐⑤떖????踰??대┝).
- **?닿껐**: 紐⑤뱺 怨듯넻 ?쇱씠釉뚮윭由щ뒗 `base.html` ?곷떒?먯꽌留?愿由ы븳??

### 43.2 JS ?곗씠???꾨떖: `json_script` ?쒖슜
?쒗뵆由??쒓렇(`{% for %}` ??瑜?`<script>` 釉붾줉 ?덉뿉 吏곸젒 ?⑥꽌 ?곗씠?곕? 援ъ꽦?섏? ?딅뒗?? ?대뒗 IDE 由고듃 ?먮윭瑜??좊컻?섍퀬 蹂댁븞??痍⑥빟?????덈떎.
- **?댁꽍**: `{{ data|json_script:"id" }}`瑜??ъ슜?섏뿬 HTML??JSON???ш퀬, JS?먯꽌 `JSON.parse(document.getElementById('id').textContent)`濡?媛?몄삩??

### 43.3 ?몃씪???ㅽ??쇱쓽 ?쒗뵆由??쒓렇 吏??HTML `style` ?띿꽦 ?덉뿉 `{{ var }}`瑜?吏곸젒 ?ｌ쑝硫??먮뵒???뚯꽌媛 臾몃쾿 ?ㅻ쪟濡??몄떇?쒕떎.
- **?닿껐**: Alpine.js??`:style` 諛붿씤?⑹쓣 ?ъ슜?섍굅?? CSS 蹂?섎? ?쒖슜?쒕떎.

```html
<!-- ??沅뚯옣 ?⑦꽩 -->
<div x-data="{ color: '{{ theme_color|escapejs }}' }" :style="{ backgroundColor: color }">...</div>
```

## 44. Django Template Tag Fragmentation 諛?以꾨컮轅?湲덉? (Critical)

?먯씠?꾪듃媛 媛?낆꽦???꾪빐 Django ?쒗뵆由??쒓렇(`{% %}`, `{{ }}`)???욌뮘???대?瑜??꾩쓽濡?以꾨컮轅덊븯??濡쒖쭅??源⑤쑉由щ뒗 ?됱쐞瑜??꾧꺽??湲덉??쒕떎.

- **利앹긽**: `{% if %}`? `{{ var }}` ?ъ씠瑜?以꾨컮轅덊븯???띿뒪?멸? 源⑥?嫄곕굹, HTML ?띿꽦/JavaScript ?대??먯꽌 援щЦ ?ㅻ쪟(500 ?먮윭) ?좊컻.
- **?닿껐**: 蹂듭옟??濡쒖쭅???ы븿???쒗뵆由??쒓렇??媛湲됱쟻 **??以?One-liner)**濡??좎??섎ŉ, ?먮뵒?곗쓽 ?먮룞 以꾨컮轅?湲곕뒫???섏〈?섏? ?딄퀬 ?먮낯???곗냽?깆쓣 蹂댁〈?쒕떎.
- **?덉떆**:
    *   ??(?섏걶 ??:
        ```html
        <span>
          {% if user.nickname %}{{ user.nickname }} {% else %}{{ user.username
           }}{% endif %}
        </span>
        ```
    *   ??(醫뗭? ??:
        ```html
        <span>{% if user.nickname %}{{ user.nickname }}{% else %}{{ user.username }}{% endif %}</span>
        ```

---

---

**留덉?留??낅뜲?댄듃:** 2026-02-12 12:30

## 45. 鍮꾪쉶??愿由??묎렐 沅뚰븳 ???몄뀡 ???UUID(Management ID) ?ъ슜 (CRITICAL)

鍮꾪쉶?먯씠 ?쒖텧???곗씠???? 媛꾪렪 ?섑빀)瑜??섏쨷???ㅼ떆 ?섏젙/??젣?댁빞 ???? **?몄뀡(Session) 湲곕컲 沅뚰븳? 釉뚮씪?곗?瑜??レ쑝硫?利앸컻**?쒕떎.

**?닿껐 ?⑦꽩**:
1. 紐⑤뜽??怨좎쑀??`management_id` (UUID) ?꾨뱶瑜?異붽??쒕떎.
2. 愿由??섏씠吏 URL????UUID瑜??ы븿?쒕떎: `/manage/<uuid:management_id>/`
3. 酉곗뿉?쒕뒗 ?몄뀡 泥댄겕 ?????UUID??議댁옱 ?щ?留뚯쑝濡?沅뚰븳???꾩엫?쒕떎 (URL ?먯껜媛 ?좏겙 ??븷).
4. ?ъ슜?먯뿉寃?**"??二쇱냼瑜?蹂듭궗?대몢硫??섏쨷???ㅼ떆 ???愿由ы븷 ???덈떎"**怨??덈궡?섍퀬 '二쇱냼 蹂듭궗' 踰꾪듉???쒓났?쒕떎.

> **?щ? (2026-02-12)**: 媛꾪렪 ?섑빀(Collect) ?깆뿉??釉뚮씪?곗?瑜??レ쑝硫??섏젙??遺덇??ν븯??臾몄젣瑜??몄뀡?먯꽌 UUID(management_id) 湲곕컲?쇰줈 ?꾪솚?섏뿬 ?닿껐.

## 46. Alpine.js瑜??댁슜??媛꾪렪??UI ?쇰뱶諛?(二쇱냼 蹂듭궗 ??

?띿뒪??蹂듭궗 ??"蹂듭궗??" 硫붿떆吏瑜??좎떆 蹂댁뿬二쇰뒗 ?깆쓽 ?묒? ?쇰뱶諛깆? Alpine.js??`x-data`? `setTimeout`???쒖슜?섎㈃ 媛꾧껐?섍쾶 援ы쁽 媛?ν븯??

```html
<div x-data="{ copied: false }">
    <button @click="navigator.clipboard.writeText(window.location.href); copied = true; setTimeout(() => copied = false, 2000)">
        <span x-show="!copied">二쇱냼 蹂듭궗</span>
        <span x-show="copied">蹂듭궗??</span>
    </button>
</div>
```

> **?щ? (2026-02-12)**: ?쒖텧臾?愿由??섏씠吏?먯꽌 愿由ъ슜 URL 蹂듭궗 湲곕뒫???쒓났?섏뿬 ?ъ슜???몄쓽?깆쓣 ?믪엫.

## 47. Cloudinary 鍮꾩씠誘몄? ?뚯씪 泥섎━ (resource_type='raw') (CRITICAL)

Cloudinary 湲곕낯 ?ㅼ젙? `resource_type='image'`?낅땲?? HWP, XLSX, PDF, ZIP ???대?吏媛 ?꾨땶 ?쇰컲 ?뚯씪???낅줈?쒗븯?ㅻ㈃ **`RawMediaCloudinaryStorage`**瑜??ъ슜?댁빞 ?⑸땲??

```python
# ??Invalid image file ?먮윭 諛쒖깮 (?대?吏濡?泥섎━瑜??쒕룄??
from cloudinary_storage.storage import VideoMediaCloudinaryStorage # ?먮뒗 湲곕낯 Storage
file = models.FileField(storage=VideoMediaCloudinaryStorage())

# ???쇰컲 ?뚯씪???ㅽ넗由ъ? ?ъ슜
from cloudinary_storage.storage import RawMediaCloudinaryStorage
file = models.FileField(storage=RawMediaCloudinaryStorage())
```

> **?щ? (2026-02-11)**: 媛꾪렪 ?섑빀 ?쒕퉬?ㅼ뿉???쒓?(hwp)?대굹 ?묒? ?뚯씪???щ┫ ??"Invalid image file" ?먮윭? ?④퍡 500 ?먮윭 諛쒖깮. `RawMediaCloudinaryStorage`濡?援먯껜?섏뿬 ?닿껐.

## 48. JS ??Django ?쒗뵆由??쒓렇 ?ъ슜 ??怨듬갚/?꾪꽣 二쇱쓽

JavaScript 肄붾뱶 ?덉뿉??`{{ value }}`瑜??ъ슜???? ?꾪꽣??怨듬갚 泥섎━媛 ?섎せ?섎㈃ JS 臾몃쾿 ?먮윭(`SyntaxError`)媛 諛쒖깮?섏뿬 ?대떦 釉붾줉 ?꾩껜媛 ?묐룞?섏? ?딆쓣 ???덉뒿?덈떎.

```javascript
/* ??以꾨컮轅덉씠??怨듬갚??JS 臾몃쾿???뚭눼?????덉쓬 */
var maxSize = {{ req.max_file_size_mb |default: 30 }}; 

/* ??愿꾪샇???곗샂?쒕줈 媛먯떥嫄곕굹, 媛꾨떒???꾪꽣留??ъ슜 */
const maxMB = parseInt('{{ req.max_file_size_mb|default:30 }}');
```

> **?щ? (2026-02-11)**: ?쒖텧 ?섏씠吏?먯꽌 JS 臾몃쾿 ?먮윭濡?Alpine.js 珥덇린?붽? 以묐떒?섏뼱 踰꾪듉??鍮꾪솢?깊솕?섎뒗 踰꾧렇 諛쒖깮. ?쒗뵆由??쒓렇瑜???以꾨줈 ?뺣━?섏뿬 ?닿껐.

---

# ?깅퀎 ?댁뒋 遺꾩꽍 湲곕줉 (怨꾩냽)

## Reservations ??- 而ㅼ뒪? 援먯떆 諛?蹂댁븞 URL (2026-02-12)

### 49. 怨듦났??URL??臾댁옉?꾩꽦 ?뺣낫 (Security/Random Slugs)

?ъ슜??援먯궗)媛 吏곸젒 二쇱냼瑜??뺥븯寃??섎㈃ `hyunam`, `seoul` ??異붿륫?섍린 ?ъ슫 ?⑥뼱瑜??ъ슜?섏뿬 ??몄씠 臾대떒?쇰줈 ?묒냽?섍굅???λ궃??移??곕젮媛 ?덈떎.

- **利앹긽**: ?숆탳 ?대쫫???щ윭洹몃줈 ????? ?숆탳 ?숈깮??二쇱냼瑜?留욏????덉빟???됰쭩?쇰줈 留뚮벀.
- **?닿껐**: `models.py`??`save()` 硫붿꽌?쒖뿉??`uuid.uuid4().hex[:8]`瑜??ъ슜??異붿륫 遺덇??ν븳 ?щ윭洹몃? ?먮룞 ?앹꽦?섍퀬, UI?먯꽌 ?ъ슜?먯쓽 吏곸젒 ?섏젙???쒗븳?쒕떎.
- **Short URL**: 蹂댁븞 URL??湲몄뼱 遺덊렪?섎?濡?`/go/<id>/` ?뺥깭??吏㏃? ?꾩슜 由щ떎?대젆??留곹겕瑜??쒓났?쒕떎.

### 50. 而ㅼ뒪? 援먯떆(Period Labels) 愿由??꾨왂

?숆탳留덈떎 "1援먯떆", "5援먯떆A", "?밴컯?" ???ъ슜?섎뒗 ?대쫫怨?援먯떆 ?섍? ?ㅻⅤ??

- **?⑦꽩**: `SchoolConfig` 紐⑤뜽??`period_labels` (TextField, CSV) ?꾨뱶瑜?異붽?.
- **?묐룞**: 肄ㅻ쭏(`,`)濡?援щ텇??臾몄옄?댁쓣 `get_period_list()` 硫붿꽌?쒕줈 由ъ뒪?명솕?섏뿬, ?덉빟 洹몃━??Row)瑜??숈쟻?쇰줈 ?앹꽦.
- **二쇱쓽**: 洹몃━???뚮뜑留???"紐?踰덉㎏ 援먯떆"?쇰뒗 ?レ옄 ???"Label怨?ID"瑜?留ㅼ묶?섏뿬 ?뚮뜑留곹빐???? (`{% if s.period == p.id %}`)

### 51. allauth v65.x+ ?ㅼ젙 留덉씠洹몃젅?댁뀡 (Monitoring)

?쒕쾭 援щ룞 ???먮뒗 留덉씠洹몃젅?댁뀡 ??Deprecation 寃쎄퀬 諛?Critical Error 諛쒖깮 ???

-   `ACCOUNT_LOGIN_METHODS = {'email', 'username'}`
-   `ACCOUNT_SIGNUP_FIELDS = ['email*', 'username*']` (**?꾩닔 ?꾨뱶??`*`瑜?遺숈뿬????*)
-   ?꾨줈?뺤뀡 `settings_production.py`? 濡쒖뺄 `settings.py` 紐⑤몢 ?숆린???꾩닔.

---

## 52. JS/Alpine ?띿꽦 ??Django ?쒗뵆由??쒓렇 ?곗샂??以묐났 泥섎━ (CRITICAL)

JavaScript ?먮뒗 Alpine.js ?띿꽦(?? `@click`, `:class`) ?대???Django ?쒗뵆由??쒓렇瑜??ъ슜???? ?대? ?꾪꽣 ?몄옄???곗샂?쒓? ?몃? JavaScript 臾몄옄?댁쓽 ?곗샂?쒖? 異⑸룎?섎㈃ 援щЦ ?ㅻ쪟(SyntaxError)媛 諛쒖깮?섏뿬 500 ?먮윭??JS ?ㅽ뻾 以묐떒???좊컻?쒕떎.

```javascript
/* ??500 ?먮윭 ?좊컻: 臾몄옄??由ы꽣??'...') ?대??먯꽌 date ?꾪꽣???묒??곗샂??'...')媛 異⑸룎 */
@click="openBooking(..., '{{ target_date|date:'Y-m-d' }}', ...)"

/* ???닿껐: ?대? ?몄옄?먮뒗 ?띾뵲?댄몴(") ?ъ슜 */
@click="openBooking(..., '{{ target_date|date:"Y-m-d" }}', ...)"
```

**利앹긽**: 釉뚮씪?곗? 肄섏넄?먮뒗 `SyntaxError: Unexpected token`???섑??섎ŉ, ?쒕쾭 濡쒓렇?먮뒗 `TemplateSyntaxError`媛 李랁옄 ???덈떎. ?뱁엳 PC?먯꽌?????섍퀬 紐⑤컮???꾩슜 釉붾줉(`lg:hidden`) ?대??먯꽌留????ㅼ닔媛 ?덉쓣 寃쎌슦 ?먯씤??李얘린 留ㅼ슦 ?대졄??

**?щ? (2026-02-12)**: ?덉빟 ?쒖뒪??紐⑤컮???덉씠?꾩썐 ?묒뾽 以?`@click` ?몃뱾????`date:'Y-m-d'`???묒??곗샂??以묐났 ?ъ슜?쇰줈 ?명빐 紐⑤컮?쇱뿉?쒕쭔 500 ?먮윭 諛쒖깮.

## 53. HTMX ?⑤룆 踰꾪듉???곗씠???꾩넚 (hx-vals ?ъ슜)

HTMX 踰꾪듉??`<form>` ?쒓렇 諛뽰뿉 ?⑤룆?쇰줈 ?덉쓣 ?뚮뒗 ?대???`<input type="hidden">` 媛믪쓣 ?먮룞?쇰줈 ?몄떇?섏? 紐삵븳?? ??寃쎌슦 諛섎뱶??`hx-vals` ?띿꽦???ъ슜?섏뿬 ?곗씠?곕? 紐낆떆?곸쑝濡??꾩넚?댁빞 ?쒕떎.

-   **?녹? ??*: `<button hx-post="..." hx-vals='{"room_id": "{{ room.id }}"}'>`
-   **?섏걶 ??*: `<button hx-post="..."><input type="hidden" name="name" value="..."></button>`

## 54. 遺遺??쒗뵆由?Partial) ?뚮뜑留???而⑦뀓?ㅽ듃 愿由?
HTMX ?붿껌?쇰줈 洹몃━?쒕굹 紐⑸줉留?蹂꾨룄濡??낅뜲?댄듃(?뚮뜑留????? ?대떦 ?쒗뵆由??덉뿉???ъ슜?섎뒗 紐⑤뱺 蹂???? `school`, `config` ??瑜?酉?View)??`render()` ?몄텧 ?쒖젏??諛섎뱶???ы븿?댁빞 ?쒕떎. 蹂?섍? ?꾨씫?섎㈃ URL ?앹꽦 ?ㅻ쪟媛 ?섍굅???붾㈃???쒕?濡?洹몃젮吏吏 ?딅뒗??

## 55. 紐⑤컮???덉씠?꾩썐 寃利?(360px 湲곗?)

UI瑜?援ы쁽???뚮뒗 ??긽 紐⑤컮???쒖? ?덈퉬??360px?먯꽌 ?붾㈃??源⑥?嫄곕굹 ?붿냼媛 寃뱀튂吏 ?딅뒗吏 癒쇱? ?뺤씤?쒕떎. `flex-1`, `min-w-0`, `truncate`? 媛숈? CSS ?대옒?ㅻ? ?곸젅???ъ슜?섏뿬 醫곸? ?붾㈃?먯꽌???덉씠?꾩썐???좎뿰?섍쾶 ??묓븯?꾨줉 ?ㅺ퀎?쒕떎.

## 56. HTMX 蹂댁븞 ?좏겙(CSRF) ?꾩뿭 泥섎━ 諛??댁쨷 寃利?(CRITICAL)

?κ퀬??蹂댁븞 ?뺤콉??紐⑤뱺 `POST` ?붿껌?먮뒗 CSRF ?좏겙???꾩닔?? HTMX ?⑤룆 踰꾪듉 ?깆뿉???좏겙 ?꾨씫?쇰줈 ?명븳 403 Forbidden ?먮윭瑜?諛⑹??섍린 ?꾪빐 ?ㅼ쓬 ?먯튃???꾧꺽??以?섑븳??

1.  **?꾩뿭 泥섎━ (base.html)**: `document.addEventListener('htmx:configRequest', ...)`瑜??ъ슜?섏뿬 紐⑤뱺 HTMX ?붿껌 ?ㅻ뜑??`X-CSRFToken`???먮룞 二쇱엯?쒕떎.
    *   **二쇱쓽**: `document.body`??由ъ뒪?덈? 嫄몃㈃ body媛 濡쒕뱶?섍린 ???쒖젏???먮윭媛 諛쒖깮?섎?濡?諛섎뱶??**`document` ?덈꺼**??嫄몄뼱???쒕떎.
2.  **?댁쨷 寃利?(寃곗젙??議곗튂)**: 釉붾옓?꾩썐 ??젣, ?덉빟 痍⑥냼? 媛숈씠 **?곗씠?곌? ??젣?섎뒗 以묒슂 踰꾪듉**? ?꾩뿭 ?ㅼ젙??100% ?좊ː?섏? 留먭퀬 `hx-vals`??`csrfmiddlewaretoken`??紐낆떆?곸쑝濡??ы븿?섏뿬 "?ㅽ뙣 ?녿뒗 ??젣"瑜?蹂댁옣?쒕떎.
    ```html
    /* ??以묒슂 踰꾪듉 ?덉떆: ?꾩뿭 ?ㅼ젙 ?몄뿉 hx-vals濡???踰????뺤떎?섍쾶 泥섎━ */
    <button hx-post="..." hx-vals='{"item_id": "1", "csrfmiddlewaretoken": "{{ csrf_token }}"}'>
    ```
3.  **而⑦뀒?대꼫 ?꾨왂**: ??쒕낫?쒖? 媛숈씠 HTMX ?묒뾽??留롮? 怨녹? 遺紐?而⑦뀒?대꼫(`div`)??`hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'`瑜?誘몃━ ?좎뼵?섏뿬 ?먯떇 ?붿냼?ㅼ씠 ?먮룞?쇰줈 ?좏겙???곸냽諛쏄쾶 ?ㅺ퀎?쒕떎.

- **?щ? (2026-02-12)**: `document.body` 由ъ뒪?덉쓽 ??대컢 臾몄젣? ?꾩뿭 ?ㅼ젙 ?꾨씫?쇰줈 ?명빐 ??젣 踰꾪듉??臾대컲?묒씠?덈뜕 臾몄젣瑜????쇱쨷 諛⑹뼱(?꾩뿭 + 而⑦뀒?대꼫 + 媛쒕퀎) ?꾨왂?쇰줈 理쒖쥌 ?닿껐.

## 57. ?꾩껜 ?곗씠???앹븷二쇨린(CRUD) ?꾧껐??以??(CRITICAL)

湲곕뒫??援ы쁽???뚮뒗 '?앹꽦'肉먮쭔 ?꾨땲??'?섏젙'怨?'??젣'媛 ?ы븿???꾩껜 ?앹븷二쇨린瑜?諛섎뱶??怨좊젮?쒕떎. "??젣 ???ㅼ떆 ?깅줉?섏꽭??? 媛숈? 諛⑹떇? 吏?묓븯怨? ?대떦 ?섏씠吏 ?댁뿉??利됱떆 ?섏젙/??젣媛 媛?ν븯?꾨줉 ?ㅺ퀎?쒕떎.

- **?먯튃**: 紐⑤뱺 ?곗씠??愿由?湲곕뒫?먮뒗 **[?깅줉 - 議고쉶 - ?섏젙 - ??젣]**媛 ?섎굹???명듃濡?援ы쁽?섏뼱???쒕떎.
- **?섏젙(Update)**: ?뚯씪 ?낅줈???쒕퉬?ㅼ쓽 寃쎌슦, ??젣 ???щ벑濡앹씠 ?꾨땶 **???뚯씪 ?좏깮 ??利됱떆 援먯껜**?섎뒗 濡쒖쭅??吏?먰븳??
- **??젣(Delete)**: ?ъ슜?먭? ?ㅼ닔濡??깅줉?덉쓣 ?뚮? ?鍮꾪빐, ?섏젙 ?붾㈃?대굹 ?곸꽭 ?붾㈃?먮뒗 諛섎뱶??紐낇솗??**??젣 踰꾪듉(?뺤씤 紐⑤떖 ?ы븿)**??諛곗튂?쒕떎.
- **?щ? (2026-02-12)**: `collect` ?깆쓽 ?쒖텧臾??섏젙 ?섏씠吏?먯꽌 ?뚯씪 援먯껜 濡쒖쭅怨???젣 踰꾪듉???꾨씫?섏뼱 ?ъ슜?먭? 遺덊렪??寃れ뿀???щ?瑜?諛뷀깢?쇰줈 ??洹쒖튃??媛뺥솕??

## 58. 珥덇린 ?곗씠???앹꽦 諛??붾㈃ ?뚮뜑留???以묐났 諛⑹? (CRITICAL)

`ensure_` 而ㅻ㎤?쒕굹 珥덇린??濡쒖쭅???듯빐 ?곗씠?곕? ?앹꽦???? 以묐났 ?ㅽ뻾?쇰줈 ?명븳 ?곗씠???꾩쟻???먯쿇 遊됱뇙?댁빞 ?쒕떎. ?먰븳, 酉?View) ?덈꺼?먯꽌???덇린移??딆? 以묐났 ?곗씠?곌? ?욎뿬 ?ㅼ뼱?ㅼ? ?딅룄濡?諛⑹뼱 濡쒖쭅??媛뽰텣??

- **硫깅벑??Idempotency) 蹂댁옣**: 珥덇린 ?곗씠???앹꽦 ?ㅽ겕由쏀듃(`management/commands`)???щ윭 踰??ㅽ뻾?대룄 寃곌낵媛 ?숈씪?댁빞 ?쒕떎. `feature.objects.create(...)` ???諛섎뱶??`get_or_create` ?먮뒗 `update_or_create`瑜??ъ슜?쒕떎. ?꾩슂?섎떎硫?湲곗〈 ?곗씠?곕? `clear()` ?섍퀬 ?ㅼ떆 ?앹꽦?쒕떎.
- **酉??덈꺼 諛⑹뼱**: DB???대? 以묐났 ?곗씠?곌? ?볦???媛?μ꽦???鍮꾪븯?? `landing` ?섏씠吏??紐⑸줉 議고쉶 酉곗뿉?쒕뒗 **以묐났 ?쒓굅(deduplication) 濡쒖쭅**???듯빐 ?붾㈃???숈씪???댁슜??諛섎났 異쒕젰?섎뒗 李몄궗瑜?留됰뒗??
- **?щ? (2026-02-12)**: `Collect` ???쒕뵫 ?섏씠吏??[二쇱슂 湲곕뒫] ?뱀뀡???댁쑀 ?놁씠 2踰덉뵫 諛섎났 異쒕젰?섎뒗 ?꾩긽 諛쒖깮. 酉곗뿉??`title` 湲곕컲 以묐났 ?쒓굅 濡쒖쭅??異붽??섏뿬 ?닿껐??

---

## 59. ?곗씠???섑빀 ??蹂댁븞 諛?梨낆엫 ?덈궡 ?섎Т??(CRITICAL)

?뚯씪, 留곹겕, ?띿뒪?????몃?濡쒕????곗씠?곕? ?섑빀?섎뒗 湲곕뒫??援ы쁽???뚮뒗 媛쒖씤?뺣낫 蹂댄샇肉먮쭔 ?꾨땲??怨듬Ц?? ?대? ?먮즺 ??蹂댁븞???꾩슂???곗씠?곗쓽 ?좎텧??諛⑹??섍린 ?꾪빐 紐낆떆?곸씤 寃쎄퀬? **?쒕퉬??硫댁콉(Disclaimer)** 臾멸뎄瑜?諛섎뱶???ы븿?댁빞 ?쒕떎.

- **?덈궡 諛곗튂**: ?곗씠???쒖텧 ?붾㈃(`submit`) 諛??쒕퉬???뚭컻 ?섏씠吏(`landing`)???덉뿉 ?꾨뒗 ?됱긽(Red 怨꾩뿴)怨?寃쎄퀬 ?꾩씠肄섏쓣 ?ъ슜?섏뿬 諛곗튂?쒕떎.
- **臾멸뎄 ?ы븿**: 
    1. **媛쒖씤?뺣낫**: 二쇰?踰덊샇, ?곕씫泥???誘쇨컧 ?뺣낫 ?ы븿 吏???덈궡.
    2. **蹂댁븞?먮즺**: ?몃? ?좎텧??湲덉???**怨듬Ц?? ?대? ??몃퉬 ?먮즺** ?섑빀 吏??諛?二쇱쓽 珥됯뎄.
    3. **硫댁콉臾멸뎄**: ?곗씠??愿由?諛??좎텧?????梨낆엫? ?뱀궗???붿껌???쒖텧???먭쾶 ?덉쑝硫??쒕퉬?ㅻ뒗 梨낆엫??吏吏 ?딅뒗?ㅻ뒗 ?먯쓣 紐낆떆.
- **?щ? (2026-02-12)**: `Collect` ?깆뿉 媛쒖씤?뺣낫 諛?怨듬Ц???좎텧 二쇱쓽, ?쒕퉬??硫댁콉 ?덈궡瑜?異붽??섏뿬 踰뺤쟻/?댁쁺??由ъ뒪?щ? 理쒖냼?뷀븿.

---

## 60. JS Base64 ?댁떆 罹먯떆 ?????댁떆 湲몄씠? ???쒖꽌???섑븳 異⑸룎 (CRITICAL)

`btoa(encodeURIComponent(rawKey)).substring(0, N)` ?쇰줈 罹먯떆 ?ㅻ? ?앹꽦???? **援щ텇??mode ??媛 ???ㅼそ??諛곗튂?섍퀬 ?댁떆 湲몄씠(N)媛 吏㏃쑝硫?* ?쒕줈 ?ㅻⅨ 紐⑤뱶媛 ?숈씪???댁떆瑜??앹꽦?쒕떎.

Base64??3諛붿씠????4臾몄옄 蹂?섏씠誘濡? `substring(0, 24)`???낅젰??**泥섏쓬 18諛붿씠?몃쭔** 諛섏쁺. ?쒓? ?대쫫(湲?먮떦 3諛붿씠??怨??앸뀈?붿씪???대? 18諛붿씠?몃? ?뚯쭊?섎㈃, ?ㅼそ??mode 李⑥씠(`teacher` vs `general`)媛 ?댁떆??諛섏쁺?섏? ?딅뒗??

```javascript
// ??mode媛 留덉?留?+ ?댁떆 吏㏃쓬 ??紐⑤뱶蹂??숈씪 ?댁떆 ??罹먯떆 異⑸룎
const keyParts = [name, gender, year, month, day, hour, calendar, mode]; // mode媛 ?ㅼそ
const hash = btoa(unescape(encodeURIComponent(keyParts.join('|')))).substring(0, 24); // 18諛붿씠?몃쭔

// ??mode瑜?泥?踰덉㎏濡?+ ?댁떆 湲몄씠 異⑸텇??const keyParts = [mode, name, gender, year, month, day, hour, calendar]; // mode媛 ?욎そ
const hash = btoa(unescape(encodeURIComponent(keyParts.join('|')))).substring(0, 32); // 24諛붿씠??```

**罹먯떆 ??蹂寃???泥댄겕由ъ뒪??**
- [ ] 援щ텇?댁빞 ???꾨뱶(mode, type ??瑜???諛곗뿴??**?욎そ**??諛곗튂
- [ ] ?댁떆 湲몄씠瑜??꾩껜 ?ㅼ쓽 怨좎쑀?깆쓣 蹂댁옣??留뚰겮 異⑸텇???ㅼ젙 (理쒖냼 32??沅뚯옣)
- [ ] 罹먯떆 ???묐몢??prefix)瑜?踰꾩쟾?낇븯??湲곗〈 ?섎せ??罹먯떆 臾댄슚??(`v2_` ??`v3_`)
- [ ] ?섏씠吏 濡쒕뱶 ??援щ쾭??罹먯떆 ?먮룞 ??젣 濡쒖쭅 異붽?

> **?щ? (2026-02-13)**: Fortune ?깆뿉??援먯궗 ?ъ＜(teacher)? ?쇰컲 ?ъ＜(general) 寃곌낵媛 ?숈씪??localStorage 罹먯떆 ?ㅻ줈 ??λ릺?? ?쇰컲 紐⑤뱶瑜??좏깮?대룄 援먯궗 紐⑤뱶 寃곌낵媛 諛섑솚?? mode瑜???泥?踰덉㎏濡??대룞 + ?댁떆 32?먮줈 ?뺤옣 + `v2_` ??`v3_` ?묐몢??蹂寃쎌쑝濡??닿껐.

## 61. Alpine.js CDN ??unpkg ???jsdelivr ?ъ슜

`unpkg.com`??`@3.x.x` 媛숈? semver ??쇰뱶移대뱶??媛꾪뿉?곸쑝濡??댁꽍 ?ㅽ뙣?????덈떎. Alpine.js媛 濡쒕뱶?섏? ?딆쑝硫?`x-data`, `@click`, `x-show` ?깆씠 紐⑤몢 ?묐룞?섏? ?딆븘 UI ?꾩껜媛 癒뱁넻???쒕떎.

```html
<!-- ??unpkg + ??쇰뱶移대뱶 ??媛꾪뿉??濡쒕뵫 ?ㅽ뙣 媛??-->
<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

<!-- ??jsdelivr + ?덉젙?곸씤 踰붿쐞 吏??-->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js"></script>
```

**Alpine.js ?섏〈 UI?????諛⑹뼱 ?꾨왂:**
- ?듭떖 ?ㅻ퉬寃뚯씠??濡쒓렇???쒕∼?ㅼ슫 ??? `onclick` ?띿꽦?쇰줈 vanilla JS fallback 異붽?
- `if(!window.Alpine){ fallbackFunction() }` ?⑦꽩 ?ъ슜

> **?щ? (2026-02-13)**: PC ?곗뒪?ы넲 ?ъ슜???쒕∼?ㅼ슫 硫붾돱媛 Alpine.js 誘몃줈?????대┃ 臾대컲?? jsdelivr CDN 蹂寃?+ vanilla JS fallback 異붽?濡??닿껐.

## 62. Django ?쒗뵆由우뿉 dict vs object ?띿꽦 ?묎렐 二쇱쓽

Django ?쒗뵆由우? `{{ obj.attr }}` 援щЦ?쇰줈 dict???ㅼ? object???띿꽦 紐⑤몢 ?묎렐 媛?ν븯吏留? **`{% if obj.role == 'user' %}` 媛숈? 鍮꾧탳??dict? object 紐⑤몢 ?묐룞?섎뒗 諛섎㈃, `render_to_string`??plain dict瑜??섍린硫?`.created_at` 媛숈? 異붽? ?띿꽦???놁뼱 ?ㅻⅨ 遺遺꾩뿉???먮윭**媛 諛쒖깮?????덈떎.

```python
# ??dict??template?먯꽌 .role? ?묎렐 媛?ν븯吏留?.created_at???놁쑝硫??먮윭
return render(request, 'chat_message.html', {'message': {'role': 'system', 'content': '...'}})

# ??SimpleNamespace濡??띿꽦 ?묎렐 蹂댁옣
from types import SimpleNamespace
msg = SimpleNamespace(role='assistant', content='...', created_at=timezone.now())
return render(request, 'chat_message.html', {'message': msg})
```

> **?щ? (2026-02-13)**: 梨쀫큸 ??珥덇낵 ??dict瑜??섍꺼 template?먯꽌 `message.created_at` ?묎렐 ??鍮?媛??뚮뜑留? SimpleNamespace濡?援먯껜?섏뿬 ?닿껐.

## 63. HTMX 以묐났 濡쒕뱶 湲덉? (base.html怨??먯떇 ?쒗뵆由?

`base.html`?먯꽌 ?대? HTMX瑜?濡쒕뱶?덈뒗?? `{% block extra_js %}`?먯꽌 ?ㅼ떆 `<script src="htmx.org">` 瑜?濡쒕뱶?섎㈃ HTMX媛 ??踰?珥덇린?붾릺???대깽???몃뱾??以묐났, ?덇린移??딆? ?숈옉??諛쒖깮?????덈떎.

> **?щ? (2026-02-13)**: `home.html`?먯꽌 HTMX瑜?以묐났 濡쒕뱶?섏뿬 ?쒓굅.

---

# Fortune 梨쀫큸 ?꾪궎?띿쿂 (2026-02-13)

## 梨쀫큸 而⑦뀓?ㅽ듃 李몄“ 諛⑹떇
- 援먯궗/?쇰컲 紐⑤뱶? **蹂꾧컻** ???꾨줈?꾩쓽 ?ъ＜ ?먭뎅(natal_chart)留?湲곕컲
- `build_system_prompt()` 李몄“ ?곗씠?? person_name, day_gan(?쇨컙), birth_year
- DeepSeek-V3 紐⑤뜽 ?ъ슜, StreamingHttpResponse濡??ㅼ떆媛??묐떟
- ?몄뀡??理쒕? 10??吏덈Ц, 7??留뚮즺

## 愿???뚯씪
- 紐⑤뜽: `fortune/models.py` (ChatSession, ChatMessage)
- 酉? `fortune/views_chat.py`
- AI ?듯빀: `fortune/utils/chat_ai.py` (DeepSeek streaming)
- ?쒖뒪???꾨＼?꾪듃: `fortune/utils/chat_logic.py`
- ?쒗뵆由? `fortune/templates/fortune/chat_main.html`, `partials/chat_room.html`, `partials/chat_message.html`

---

## 64. OneToOneField ?묎렐 ??議댁옱 蹂댁옣 (Safety First)

`OneToOneField` (?? `School` - `SchoolConfig`) 愿怨꾩뿉?????媛앹껜媛 ?대뼡 ?댁쑀濡쒕뱺 ?꾨씫?섏뿀??寃쎌슦, ?띿꽦 ?묎렐(`school.config`) ??`DoesNotExist` ?먮윭媛 諛쒖깮?섏뿬 500 ?먮윭瑜??좊컻?????덈떎.

**?닿껐 ?⑦꽩**:
- 酉?View)?먯꽌 ?띿꽦??吏곸젒 ?묎렐?섍린蹂대떎 `get_or_create()`瑜??ъ슜?섏뿬 議댁옱瑜?蹂댁옣?????ъ슜?쒕떎.

```python
# ???꾪뿕: config媛 ?놁쑝硫?DoesNotExist ?먮윭 諛쒖깮
config = school.config

# ???덉쟾: ?놁쑝硫??앹꽦?섏뿬 諛섑솚
config, created = SchoolConfig.objects.get_or_create(school=school)
```

> **?щ? (2026-02-13)**: ?쒕쾭 諛고룷 ?섍꼍?먯꽌 ?쇰? `School` ?곗씠?곗뿉 `SchoolConfig`媛 留ㅼ묶?섏? ?딆븘 ??쒕낫???묎렐 ??500 ?먮윭 諛쒖깮. 紐⑤뱺 愿??酉곗뿉 `get_or_create` 濡쒖쭅??異붽??섏뿬 ?닿껐.

---

**留덉?留??낅뜲?댄듃:** 2026-02-13

## 65. Enterprise Rollout Baseline (2026-02-15)

This section captures implementation learnings from the full enterprise-grade rollout.
Apply in addition to existing rules.

### A. Platform and Runtime
- Keep ASGI-first production runtime (`uvicorn`) and verify command parity across `Procfile` and `nixpacks.toml`.
- Keep PostgreSQL pooler safety enabled (`DISABLE_SERVER_SIDE_CURSORS = True`) in production.
- Keep startup commands idempotent; startup must be safe on repeated deploys.

### B. Queue and Async Policy (DB Queue Standard)
- Default queue backend is DB queue. Do not assume Redis exists.
- Queue design must include retry budget, dead-letter policy (or failed-job table), and operator-visible failure reason.
- Long-running/expensive jobs must be offloaded to DB queue workers, not synchronous request-response paths.

### C. Reliability Pattern for AI Services
- Use timeout + bounded retry for all external AI calls.
- Circuit breaker must wrap the final consumer boundary for generator/stream patterns (record success/failure at consume point).
- Fallback message must be user-safe and non-technical.

### D. Security and Error Exposure
- Never return raw exception strings to users.
- Health endpoints must not expose internal DB/infra error details.
- Keep detailed error context in server logs only.

### E. Test and Verification Gate
- `python manage.py check` is required before merge/deploy.
- Maintain service health tests aligned with real URL/auth policy (200 or 302 where expected).
- Add pre-deploy and post-deploy smoke checks for health endpoint and critical user journeys.

### F. Observability Baseline
- Log fields: `request_id`, `service`, `endpoint`, `status_code`, `latency_ms`.
- Track AI failure rate and rate-limit hit rate as first-class operational metrics.

---

## 66. ?묎렐??A11y) ?꾩닔 洹쒖튃 (CRITICAL)

### 66.1 紐⑤떖/?쒕∼?ㅼ슫 ?ㅻ낫???묎렐??- [ ] 紐⑤떖 ?대┫ ??泥?踰덉㎏ ?ъ빱??媛?ν븳 ?붿냼???먮룞 ?ъ빱??- [ ] ESC ?ㅻ줈 紐⑤떖/?쒕∼?ㅼ슫 ?リ린 (`@keydown.escape`)
- [ ] 紐⑤떖 ?몃? ?대┃?쇰줈 ?リ린 (`@click.outside`)
- [ ] 紐⑤떖 ?ロ옄 ???몃━嫄??붿냼濡??ъ빱??蹂듦?

### 66.2 ?ъ빱???ㅽ???紐⑤뱺 ?명꽣?숉떚釉??붿냼??`:focus-visible` ?ㅽ????꾩닔.
`outline-none`?????뚮뒗 諛섎뱶???泥??ъ빱???쒖떆瑜??④퍡 ?곸슜.

```css
/* base.html ?꾩뿭 */
:focus-visible {
    outline: 2px solid #8b5cf6;
    outline-offset: 2px;
}
```

### 66.3 ???鍮?理쒖냼 湲곗?
- 蹂몃Ц ?띿뒪?? `text-gray-700` ?댁긽 (諛곌꼍 `#E0E5EC` 湲곗?)
- 蹂댁“ ?띿뒪?? `text-gray-500` ?댁긽
- `text-gray-400`? ?μ떇 ?붿냼(placeholder ???먮쭔 ?덉슜

### 66.4 ?대?吏 alt ?띿뒪???꾩닔
紐⑤뱺 `<img>` ?쒓렇??`alt` ?띿꽦 ?꾩닔. ?μ떇???대?吏??`alt=""`.

### ?묒뾽 ?꾨즺 ??A11y 泥댄겕由ъ뒪??- [ ] 紐⑤떖/?쒕∼?ㅼ슫: ESC ?リ린 + ?ъ빱???몃옪 ?숈옉 ?뺤씤
- [ ] Tab ?ㅻ줈 紐⑤뱺 ?명꽣?숉떚釉??붿냼 ?쒗쉶 媛??- [ ] ???鍮? `text-gray-400` ?댄븯 蹂몃Ц ?띿뒪???놁쓬
- [ ] ?대?吏: alt ?띿꽦 ?꾨씫 ?놁쓬

---

## 67. ?대?吏 理쒖쟻??洹쒖튃

### lazy-load ?꾩닔
酉고룷??諛뽰쓽 ?대?吏??諛섎뱶??`loading="lazy"` ?곸슜.
Above-the-fold(泥??붾㈃) ?대?吏???쒖쇅.

```html
<!-- ??-->
<img src="..." alt="...">

<!-- ??-->
<img src="..." alt="..." loading="lazy">
```

### Cloudinary ?먮룞 理쒖쟻??Cloudinary URL ?ъ슜 ??`f_auto,q_auto` 蹂???곸슜 沅뚯옣.
釉뚮씪?곗???留욌뒗 理쒖쟻 ?щ㎎(WebP/AVIF)怨??덉쭏???먮룞 ?좏깮.

```python
# ???먮낯 URL 洹몃?濡?image_url = "https://res.cloudinary.com/.../upload/v123/image.jpg"

# ???먮룞 理쒖쟻??蹂??異붽?
image_url = "https://res.cloudinary.com/.../upload/f_auto,q_auto/v123/image.jpg"
```

> **李멸퀬**: ?꾨줈?앺듃???대? `core/templatetags/cloudinary_extras.py`??`|optimize` ?꾪꽣媛 議댁옱?섎?濡? ?쒗뵆由우뿉?쒕뒗 `{{ image_url|optimize }}` ?ъ슜 沅뚯옣.

---

## 68. ?뺤쟻 ?뚯씪 罹먯떆 踰꾩뒪??(?ν썑 媛쒖꽑)

?꾩옱: `StaticFilesStorage` (?뚯씪紐??댁떆 ?놁쓬)
紐⑺몴: `WhiteNoise CompressedManifestStaticFilesStorage` ?꾪솚

### ?꾪솚 ??二쇱쓽?ы빆
- collectstatic ?ㅽ뻾 ?꾩닔 (?댁떆 ?뚯씪紐??앹꽦)
- ?쒗뵆由우쓽 `{% static %}` ?쒓렇媛 ?먮룞?쇰줈 ?댁떆 URL ?앹꽦
- Tailwind CDN ?ъ슜 以묒씠??CSS???대떦 ?놁쓬, JS/?대?吏???곸슜

---

## 69. Tailwind CDN ??鍮뚮뱶 ?꾪솚 濡쒕뱶留?(?ν썑)

### Phase 1: 蹂묓뻾 ?댁쁺
- Tailwind CLI濡?鍮뚮뱶??CSS ?뚯씪 ?앹꽦
- base.html?먯꽌 CDN ?ㅽ겕由쏀듃? 鍮뚮뱶 CSS瑜?蹂묓뻾 濡쒕뱶
- 2二쇨컙 ?댁쁺?섎ŉ ?ㅽ???李⑥씠 ?뺤씤

### Phase 2: CDN ?쒓굅
- CDN ?ㅽ겕由쏀듃 ??젣
- `tailwind.config.js`濡??꾩쟾 ?꾪솚
- CSP?먯꽌 `unsafe-eval` ?쒓굅 媛??
### 湲곕? ?④낵
- 珥덇린 濡쒕뱶 ?깅뒫 ?μ긽 (?고???而댄뙆???쒓굅)
- CSP 媛뺥솕 (`unsafe-eval` ?쒓굅)
- 鍮뚮뱶 ?곗텧臾??ш린 異뺤냼 (?ъ슜???대옒?ㅻ쭔 ?ы븿)

---

**留덉?留??낅뜲?댄듃:** 2026-02-15

## [Encoding Incident] Korean Text Corruption Guardrail (2026-02-17)
- Problem pattern:
  - Korean UI strings were partially corrupted during iterative edits.
  - Display encoding and file encoding were confused during terminal-based verification.
- Root cause summary:
  - Terminal mojibake was mistaken for source truth.
  - Broad rewrite operations introduced/propagated corruption.
  - Functional edits were mixed with encoding recovery in the same pass.
- Mandatory procedure:
  1. Freeze feature edits.
  2. Normalize files to UTF-8 (no BOM) first.
  3. Restore Korean UI strings from known-good text.
  4. Re-apply logic/style changes.
  5. Run `node --check` and `python manage.py check`.
- Prevention:
  - Prefer small `apply_patch` diffs over bulk rewrites for Korean-heavy files.
  - Keep one canonical text representation per file (plain UTF-8 or escapes), not mixed.
  - If mojibake appears, recover text first, then continue feature work.

## [UI Change Control] Existing Service Protection Rule (2026-02-17)
- 紐⑹쟻:
  - ?쇰? ?붾㈃ 媛쒖꽑???ㅻⅨ ?쒕퉬??UI源뚯? ?붾뱾吏 ?딅룄濡?蹂寃?踰붿쐞瑜??듭젣?쒕떎.

- ?먯튃:
  1. 蹂寃??쒖옉 ??踰붿쐞瑜?紐낆떆?쒕떎 (`global` / `app` / `page`).
  2. 湲곗〈 ?쒕퉬?ㅼ쓽 ?뺣┰??UI ?몄뼱??議댁쨷?섎ŉ 媛뺤젣 ?듭씪?섏? ?딅뒗??
  3. 怨듭슜 ?ㅽ???base, shared component) ?섏젙? ?꾩슂 理쒖냼濡??쒗븳?쒕떎.
  4. UI 蹂寃???湲곕뒫 ?숈옉 ?뚭?瑜?癒쇱? ?뺤씤?쒕떎 (紐⑤떖 ?ロ옒, ?쇱슦?? ESC, ?ъ빱??.

- 臾몄꽌??
  - 蹂寃????  - 蹂寃??댁쑀
  - 鍮꾨????곹뼢 ?놁쓬) 寃利?寃곌낵

- ?몄퐫???곌퀎 洹쒖튃:
  - ?쒓뎅??源⑥쭚 諛쒓껄 ??UI 媛쒖꽑蹂대떎 ?몄퐫??蹂듦뎄瑜??곗꽑?쒕떎.
  - 蹂듦뎄 ?쒖꽌: ?몄퐫???뺤긽??-> 臾멸뎄 蹂듦뎄 -> 湲곕뒫/?붿옄??諛섏쁺.

## [Canonical Priority] Maintenance Baseline (2026-02-17)
?꾨옒 ??ぉ? 湲곗〈 臾몄꽌 ??援ъ떇/異⑸룎 洹쒖튃蹂대떎 ?곗꽑?⑸땲??

1. UI 蹂寃?踰붿쐞 癒쇱? ?좎뼵
- `global` / `app` / `page` 踰붿쐞瑜?紐낆떆?????묒뾽?쒕떎.
- 踰붿쐞 諛?怨듭슜 ?ㅽ????섏젙? 湲덉??쒕떎.

2. 湲곗〈 ?쒕퉬??UI 蹂댁〈
- ?댁쁺 以묒씤 ?쒕퉬?ㅼ쓽 ?쒓컖 ?몄뼱??湲곕낯?곸쑝濡??좎??쒕떎.
- ?꾨㈃ 媛쒗렪? 紐낆떆 ?붿껌???덉쓣 ?뚮쭔 ?섑뻾?쒕떎.

3. ?숈옉 ?뚭? ?곗꽑 ?먭?
- UI 蹂寃???諛섎뱶???먭?:
  - 留곹겕/?쇱슦??  - 紐⑤떖 ?ロ옒(諛곌꼍 ?대┃, ESC)
  - ?ㅻ낫???ъ빱???먮쫫

4. ?쒓? ?띿뒪??蹂댁쟾
- ?쒓? 源⑥쭚 諛쒓껄 ??湲곕뒫 蹂寃쎈낫???띿뒪??蹂듦뎄瑜??곗꽑?쒕떎.
- 蹂듦뎄 ??湲곕뒫/?붿옄??蹂寃쎌쓣 ?ъ쟻?⑺븳??


## 70. Mobile Board Fit Rule (Game Services)

When implementing or modifying grid-based games (e.g., isolation, breakthrough, chess-like boards), mobile horizontal drag/overflow must be prevented by default.

### Required implementation
- Do not hardcode board cell width in JS (`repeat(cols, 52px)` is forbidden for production UI).
- Use CSS variable based sizing with viewport-aware clamp:
  - `--cell-size: clamp(min, calc((available-width - gaps - paddings)/cols), max)`
- JS renderer must set only board metadata (e.g., `--cols`, `--cell-max`) and use `gridTemplateColumns: repeat(cols, minmax(0, var(--cell-size)))`.
- Board/stage containers must block unintended horizontal page movement on mobile:
  - `overflow-x: clip|hidden`
  - `overscroll-behavior-x: none`
  - `touch-action: pan-y`

### Mobile QA gate (must pass before merge)
- Verify on 320px, 360px, 390px widths (or real devices with similar widths).
- During gameplay, left-right swipe must NOT move the page.
- Board must be fully visible without clipped side columns.
- Check at least: `isolation`, `breakthrough` (and any new board game variant).
