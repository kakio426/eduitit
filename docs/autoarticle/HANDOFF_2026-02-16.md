# AutoArticle Handoff (2026-02-16)

## 1) Scope Completed
- Removed fixed "AI writer average 10 seconds" expectation from UX flow to avoid false-failure perception.
- Added post-save image replacement flow so users can swap photos after article creation.
- Extended audience targeting:
  - Existing scope values (`전교생`, `1~6학년`) 유지
  - `반` 텍스트를 자유 입력 가능하도록 확장 (`예: 3학년 2반`, `풀꽃반`)
- Export layout versioning expanded from `v1~v3` to `v1~v6`.
  - `v4` = A안 (신문형)
  - `v5` = B안 (매거진형)
  - `v6` = C안 (미니멀 브리프형)

## 2) Key Fixes Applied
- CardNews PNG: image-empty issue 대응 (1~4장 그리드 처리 경로 정비).
- PPT download: `unsupported zip file` 대응
  - 기존 저장된 `ppt_file`가 손상 zip인지 검사
  - 손상 시 파일 제거 후 재생성
  - 다운로드 응답을 `FileResponse`로 반환
- PDF: fpdf noisy warning 완화 및 안전 텍스트 처리 강화.

## 3) Files Touched (Main)
- `autoarticle/views.py`
- `autoarticle/templates/autoarticle/detail.html`
- `autoarticle/templates/autoarticle/archive.html`
- `autoarticle/engines/card_engine.py`
- `autoarticle/engines/ppt_engine.py`
- `autoarticle/engines/pdf_engine.py`
- `autoarticle/engines/word_engine.py`
- `docs/AUTOARTICLE_EXPORT_DESIGN_ROLLBACK.md`

## 4) Migrations
- Applied:
  - `autoarticle.0003_generatedarticle_class_name`
  - `autoarticle.0004_alter_generatedarticle_school_name`

## 5) Verification (Executed)
- `python manage.py check` : PASS
- `python manage.py test autoarticle.tests.test_engines -v 2` : PASS
- v1~v6 smoke generation run (PDF/Word/PPT/Card): 생성 확인

## 6) Commits / Push
- `56e77b4` : autoarticle major updates (layout toggle, image/class related flow)
- `fa049ef` : PDF warning hardening
- `c62eef4` : PPT invalid zip cache regeneration fix
- `7bdaa7d` : v4~v6 layout rollout across engines/templates/views/docs
- Remote: `origin/main` pushed

## 7) Operational Notes
- Default layout can remain `v1` for safe rollout.
- Session/user-level switch available via `autoarticle:export_layout`.
- If design dissatisfaction continues:
  - Keep v1 as rollback baseline
  - Iterate v4/v5/v6 contrast (typography, spacing, hierarchy) in separate commits

## 8) Suggested Next Checks (Manual QA)
- Single article detail:
  - change layout v1~v6 -> export all 4 formats
- Archive bulk export:
  - 2~5 selected articles with mixed image counts
- Image count matrix per format:
  - 1, 2, 3, 4 images each for PDF/Word/PPT/CardNews
- Audience label display:
  - `전교생`, `3학년`, `3학년 2반`, `풀꽃반`
